"use strict";(self.webpackChunkwebgi=self.webpackChunkwebgi||[]).push([[335],{7729:function(e,t,i){var n=i(352),s=i.n(n)()((function(e){return e[1]}));s.push([e.id,'.button-bar{background:var(--tp-base-background-color);border:1px solid #8f949c;width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:400;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:#ccc;transition:color .25s}.button-bar-button:hover{color:#eee}.button-bar-selected{color:#fff}.button-bar-selected-box{color:#fff}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:#413762}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:#ccc;transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px}.mode-button{font-weight:400}#webgi-logo{background-image:url("https://webgi.xyz/img/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:2.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.8rem !important;color:#ddd !important}#tweakpaneUiContainer{margin-top:7.5rem}@media only screen and (min-width: 480px){#tweakpaneUiContainer{margin-top:5.5rem}}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{background-color:#d1d4e7}',""]),t.Z=s},9513:function(e,t,i){var n=i(352),s=i.n(n)()((function(e){return e[1]}));s.push([e.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),t.Z=s},8537:function(e,t,i){i.d(t,{P:function(){return d}});var n=i(3995),s=i(4107),r=i(5551),o=i(7663),a=i(5933),l=i(9008),h=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let d=class extends n.Q{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[a.i],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1}connect(){this._connected&&this.disconnect(),this._client=new o.t({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){this.uiConfig?.uiRefresh?.("postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(e){return this.serializeSettings?super.toJSON(e):{type:this.constructor.PluginType}}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(a.i);t.actions.exportFile=async(i,n,s)=>{if(!this._connected)return void await t.defaultActions.exportFile(i,n);const r=(0,l.pathJoin)([this.endpointURL,this.pathPrefix,n]),o=await this._fetch(r,{method:"PUT",body:i},s);if(!o.ok)return e.console.error("Error uploading file",o),void await t.defaultActions.exportFile(i,n);this.dispatchEvent({type:"fileUpload",name:n,blob:i,response:o,path:r}),e.console.log("File uploaded",o)}}async _fetch(e,t,i){if(!this._client)throw new Error("Not connected");for(let i=0;i<=this._client.retries;i++){const n=fetch(await this._client.sign(e,t));if(i===this._client.retries)return n;const s=await n;if(s.status<500&&429!==s.status)return s;await(0,l.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,i))}throw new Error("An unknown error occurred, ensure retries is not negative")}};d.PluginType="AWSClientPlugin1",h([(0,s.qC)(),(0,r.ri)("Access Key ID",(e=>({disabled:()=>!e.enabled||e._connected})))],d.prototype,"accessKeyId",void 0),h([(0,s.qC)(),(0,r.ri)("Access Key Secret",(e=>({disabled:()=>!e.enabled||e._connected})))],d.prototype,"accessKeySecret",void 0),h([(0,s.qC)(),(0,r.ri)("Endpoint URL",(e=>({disabled:()=>!e.enabled||e._connected})))],d.prototype,"endpointURL",void 0),h([(0,s.qC)(),(0,r.ri)("Path Prefix",(e=>({disabled:()=>!e.enabled})))],d.prototype,"pathPrefix",void 0),h([(0,s.qC)(),(0,r.Q7)("Remember",(e=>({disabled:()=>!e.enabled||e._connected})))],d.prototype,"serializeSettings",void 0),h([(0,r.M)(void 0,(e=>({label:()=>e._connected?"Disconnect":"Connect"})))],d.prototype,"toggleConnection",void 0),d=h([(0,r.Sp)("S3 Connection")],d)},3335:function(e,t,i){i.d(t,{N:function(){return Vt},q:function(){return Ht}});var n=i(8015),s=i(9008),r=i(2909),o=i(7398),a=i(4821),l=i(1432),h=i(5509),d=i(5933),c=i(8041),p=i(3995),u=i(3615),g=i(1196),m=i(7282),f=i(5701),v=i.n(f),w=i(8236),y=i.n(w),b=i(6850),_=i.n(b),x=i(7182),C=i.n(x),P=i(9213),S=i.n(P),M=i(9513),O={};M.Z&&M.Z.locals&&(O.locals=M.Z.locals);var j,E=0,k={};k.styleTagTransform=S(),k.setAttributes=_(),k.insert=function(e,t){(t.target||document.head).appendChild(e)},k.domAPI=y(),k.insertStyleElement=C(),O.use=function(e){return k.options=e||{},E++||(j=v()(M.Z,k)),O},O.unuse=function(){E>0&&!--E&&(j(),j=null)};var D=O;class T extends p.Q{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},m.Z.appendToBody=t=>{e.container.appendChild(t)},m.Z.makeIconHTML=e=>"",D.use({target:e.container}),e.alert=async e=>{const t=e?.split(":")[0],i=new u.Z({type:"info",title:t??"&ndsp;",text:e?.replace(t+":","")||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return i.open(),i.getPromise()},e.confirm=async e=>{const t=e?.split(":")[0],i=new u.Z({type:"info",title:t??"&ndsp;",text:e?.replace(t||"","").replace(":","")||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return i.open(),"yes"===await i.getPromise()},e.prompt=async(e,t,i=!0)=>{const n=e?.split(":")[0],s=new g.Z({type:"info",title:n??"&ndsp;",placeholder:t??"",showCancel:i,animation:"overlay",text:e?.replace(n||"","").replace(":","")||""});return s.open(),await s.getPromise().catch((async()=>null))}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}T.PluginType="WindowiseDialogPlugin";var A=i(5343),U=i(3262),L=i(8112),R=i(2095),F=i(7926),B=i(853),z=i(6153),V=i(2988),H=i(4107),I=i(5551),q=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const N=new V.Pa4(0,0,1),W=new V.USm,Q=new V._fP,G=new V._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),$=new V._fP,K={type:"change"};let Y=class extends s.SimpleEventDispatcher{constructor(e){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new V._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new V._fP,this._initQuaternionInvert=new V._fP,this._initQuaternionDest=new V._fP,this._lastTime=-1,!1===window.isSecureContext&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=e,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))})).catch((e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new V._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const e=this.deviceOrientation;if(e){const t=null!==e.alpha?V.M8C.degToRad(e.alpha):0,i=null!==e.beta?V.M8C.degToRad(e.beta):0,n=null!==e.gamma?V.M8C.degToRad(e.gamma):0,s=this.screenOrientation?V.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(t,i,n,s),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(K))}}dispose(){this.disconnect()}setObjectQuaternion(e,t,i,n){const r=(0,s.now)()/1e3;W.set(t,e,-i,"YXZ"),$.setFromEuler(W),$.multiply(G),$.multiply(Q.setFromAxisAngle(N,-n)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy($).invert(),this._initQuaternionDest.__init=!0),$.premultiply(this._initQuaternionDest),this.object.quaternion.slerp($,this.dampingFactor/(Math.min(1,r-this._lastTime)/(1/60))),this._lastTime=r}};q([(0,H.qC)(),(0,I.t8)("Damping",[0,1],.01)],Y.prototype,"dampingFactor",void 0),Y=q([(0,I.BF)("Device Orientation Controls")],Y);class Z extends p.Q{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{e.lastCamera?.removeControlsCtor?.(this.controlsKey),e.camera?.setControlsCtor?.(this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}class X extends Z{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new Y(e)}}X.PluginType="DeviceOrientationControlsPlugin";var J=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const ee=new V.Pa4,te=new V.$V,ie=new V.Pa4,ne={type:"change"};let se=class extends s.SimpleEventDispatcher{constructor(e,t){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new V.Pa4,this._lastTime=-1,this.object=e,this.domElement=t,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const e=this.object.quaternion;ee.set(0,0,-1).applyQuaternion(e),te.setFromVector3(ee),this.lat=90-V.M8C.radToDeg(te.phi),this.lon=V.M8C.radToDeg(te.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(e){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(e){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(e){this.domElement===document?(this.pointerX=e.pageX-this.viewHalfX,this.pointerY=e.pageY-this.viewHalfY):(this.pointerX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(e){if(this.enableKeys)switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(e){if(this.enableKeys)switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(e,t,i){return e.isVector3?ie.copy(e):void 0===t||void 0===i?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):ie.set(e,t,i),this.object.lookAt(ie),this.setOrientation(),this}update(){const e=(0,s.now)(),t=(this._lastTime<0?16:Math.min(e-this._lastTime,1e3))/1e3;if(this._lastTime=e,!this.enabled)return;if(this.heightSpeed){const e=V.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=t*(e*this.heightCoef)}else this.autoSpeedFactor=0;const i=t*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let n=t*this.lookSpeed;this.activeLook||(n=0);let r=1;this.constrainVertical&&(r=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*n,this.lookVertical&&(this.lat-=this.pointerY*n*r),this.lat=Math.max(-85,Math.min(85,this.lat));let o=V.M8C.degToRad(90-this.lat);const a=V.M8C.degToRad(this.lon);this.constrainVertical&&(o=V.M8C.mapLinear(o,0,Math.PI,this.verticalMin,this.verticalMax));const l=this.object.position;this.targetPosition.setFromSphericalCoords(1,o,a).add(l),this.object.lookAt(this.targetPosition),this.dispatchEvent(ne)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(e){this.enableKeys&&e.preventDefault()}};J([(0,H.qC)(),(0,I.Q7)()],se.prototype,"enabled",void 0),J([(0,H.qC)(),(0,I.Q7)()],se.prototype,"enableKeys",void 0),J([(0,H.qC)(),(0,I.ri)()],se.prototype,"movementSpeed",void 0),J([(0,H.qC)(),(0,I.ri)()],se.prototype,"lookSpeed",void 0),J([(0,H.qC)(),(0,I.Q7)()],se.prototype,"lookVertical",void 0),J([(0,H.qC)(),(0,I.Q7)()],se.prototype,"autoForward",void 0),J([(0,H.qC)(),(0,I.Q7)()],se.prototype,"activeLook",void 0),J([(0,H.qC)(),(0,I.Q7)()],se.prototype,"heightSpeed",void 0),J([(0,H.qC)(),(0,I.ri)()],se.prototype,"heightCoef",void 0),J([(0,H.qC)(),(0,I.ri)()],se.prototype,"heightMin",void 0),J([(0,H.qC)(),(0,I.ri)()],se.prototype,"heightMax",void 0),J([(0,H.qC)(),(0,I.Q7)()],se.prototype,"constrainVertical",void 0),J([(0,H.qC)(),(0,I.ri)()],se.prototype,"verticalMin",void 0),J([(0,H.qC)(),(0,I.ri)()],se.prototype,"verticalMax",void 0),J([(0,H.qC)(),(0,I.Q7)()],se.prototype,"mouseDragOn",void 0),se=J([(0,I.Sp)("First Person Controls")],se);class re extends Z{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new se(e,t)}}re.PluginType="FirstPersonControlsPlugin";var oe=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const ae=new V.USm(0,0,0,"YXZ"),le=new V.Pa4,he={type:"change"},de={type:"lock"},ce={type:"unlock"},pe=Math.PI/2;let ue=class extends s.SimpleEventDispatcher{constructor(e,t){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new V.Pa4(0,0,-1),this.domElement=t,this.object=e,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(e){this.isLocked||this.autoLockOnClick&&(e.preventDefault(),this.lock())}onMouseMove(e){this.isLocked&&(this._movementX+=e.movementX||e.mozMovementX||e.webkitMovementX||0,this._movementY+=e.movementY||e.mozMovementY||e.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(de),this.isLocked=!0):(this.dispatchEvent(ce),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(e){return e.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(e){le.setFromMatrixColumn(this.object.matrix,0),le.crossVectors(this.object.up,le),this.object.position.addScaledVector(le,e)}moveRight(e){le.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(le,e)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(ae.setFromQuaternion(this.object.quaternion),ae.y-=.002*this._movementX*this.pointerSpeed,ae.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,ae.x=Math.max(pe-this.maxPolarAngle,Math.min(pe-this.minPolarAngle,ae.x)),this.object.quaternion.setFromEuler(ae),this.dispatchEvent(he))}};oe([(0,I.Q7)(),(0,H.qC)()],ue.prototype,"enabled",void 0),oe([(0,I.ri)(),(0,H.qC)()],ue.prototype,"minPolarAngle",void 0),oe([(0,I.ri)(),(0,H.qC)()],ue.prototype,"maxPolarAngle",void 0),oe([(0,I.ri)(),(0,H.qC)()],ue.prototype,"pointerSpeed",void 0),oe([(0,I.Q7)(),(0,H.qC)()],ue.prototype,"autoLockOnClick",void 0),ue=oe([(0,I.BF)("Pointer Lock Controls")],ue);class ge extends Z{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new ue(e,t.ownerDocument?t:t.documentElement)}}ge.PluginType="PointerLockControlsPlugin";var me=i(7721),fe=i(2926),ve=i(5529),we=i(7800),ye=i(9923),be=i(1948),_e=i(356),xe=i(1358),Ce=i(38),Pe=i(2307),Se=i(560),Me=i(3585),Oe=i(9930),je=i(5268),Ee=i(5855),ke=i(2244),De=i(46),Te=i(7655),Ae=i(6320),Ue=i(8537),Le=i(5614),Re=i(2278),Fe=i(5571),Be=i(7697),ze=i(5254),Ve=i(6882),He=i(5220),Ie=i(6695),qe=i(7821),Ne=i(6667),We=i(439),Qe=i(1233),Ge=i(922),$e=i(1531),Ke=i(4388),Ye=i(6493),Ze=i(4722),Xe=i(7256),Je=i(1213),et=i(2875),tt=i(418),it=i(3036),nt=i(9483),st=i(3316),rt=i(5133),ot=i(1755),at=i(529),lt=i(8505),ht=i(4352),dt=i(1672),ct=i(1134),pt=i(5942),ut=i(5454),gt=i(2412),mt=i(9076),ft=i(9280),vt=i(8903),wt=i(8453),yt=i(2804),bt=i(3277),_t=i(1321),xt=i(3065),Ct=i(8430),Pt=i(8326),St=i(450);class Mt extends V.Tme{get objectRef(){return this.light}constructor(e){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=(0,I.YH)("Widget",this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(e),this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}dispose(){this.detach()}_objectUpdate(){this.light&&this.update()}attach(e){return this.light&&this.detach(),this.light=e,this.light&&(this.update(),this.light.addEventListener("objectUpdate",this._objectUpdate),this.light.addEventListener("dispose",this.dispose),this.uiConfig&&this.light.uiConfig?.children?.push(this.uiConfig),this.visible=!0),this}detach(){if(this.light){if(this.light.removeEventListener("objectUpdate",this._objectUpdate),this.light.removeEventListener("dispose",this.dispose),this.uiConfig){const e=this.light.uiConfig?.children?.indexOf(this.uiConfig);void 0!==e&&e>=0&&this.light.uiConfig?.children?.splice(e,1)}this.light=void 0,this.visible=!1}return this}}!function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)}([(0,I.Q7)()],Mt.prototype,"visible",void 0);var Ot=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class jt extends Mt{constructor(e,t,i){super(e),this.lineWidth=5,this.size=.5,this._v1=new V.Pa4,this._v2=new V.Pa4,this._v3=new V.Pa4,this.color=i,void 0!==t&&(this.size=t);let n=new St.L;this.material=new Ct.Y({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new Pt.w(n,this.material),this.add(this.lightPlane),n=new St.L,n.setPositions([0,0,0,0,0,1]),this.targetLine=new Pt.w(n,this.material),this.add(this.targetLine),this.update(),this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(e){return e.isDirectionalLight}static Create(e){return new jt(e)}}Ot([(0,s.onChange)(jt.prototype.update)],jt.prototype,"material",void 0),Ot([(0,s.onChange)(jt.prototype.update),(0,I.t8)(void 0,[.1,20],.01)],jt.prototype,"lineWidth",void 0),Ot([(0,s.onChange)(jt.prototype.update),(0,I.t8)(void 0,[.01,10],.01)],jt.prototype,"size",void 0);var Et=i(1217),kt=i(9854),Dt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class Tt extends Mt{constructor(e,t,i){super(e),this.lineWidth=5,this.size=.5,this.color=i,void 0!==t&&(this.size=t);const n=new Et.H(new V.xo$(.5,4,2));this.material=new Ct.Y({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new kt.v(n,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){this.light&&this.lightSphere&&(this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(e){return e.isPointLight}static Create(e){return new Tt(e)}}Dt([(0,s.onChange)(Tt.prototype.update)],Tt.prototype,"material",void 0),Dt([(0,s.onChange)(Tt.prototype.update),(0,I.t8)(void 0,[.1,20],.01)],Tt.prototype,"lineWidth",void 0),Dt([(0,s.onChange)(Tt.prototype.update),(0,I.t8)(void 0,[.01,10],.01)],Tt.prototype,"size",void 0);var At=i(9404),Ut=i(2820),Lt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class Rt extends Mt{constructor(e,t,i){super(e),this.lineWidth=5,this._v1=new V.Pa4,this.color=i,void 0===t&&(t=.5);let n=new Ut.z;const s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,i=32;e<i;e++,t++){const n=e/i*Math.PI*2,r=t/i*Math.PI*2;s.push(Math.cos(n),Math.sin(n),1,Math.cos(r),Math.sin(r),1)}n.setPositions(s),this.material=new Ct.Y({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new At.w(n,this.material),this.add(this.cone),n=new St.L,n.setPositions([0,0,0,0,0,1]),this.update(),this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(e){return e.isSpotLight}static Create(e){return new Rt(e)}}Lt([(0,s.onChange)(Rt.prototype.update)],Rt.prototype,"material",void 0),Lt([(0,s.onChange)(Rt.prototype.update),(0,I.t8)(void 0,[.1,20],.01)],Rt.prototype,"lineWidth",void 0);class Ft extends p.Q{constructor(){super(...arguments),this.enabled=!0,this.helpers=[jt,Rt,Tt],this.visible=!0,this.toJSON=null,this._addSceneObject=e=>{const t=e.object;this._createWidgets(t?.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Light Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"visible"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]}}_onVisibleChange(){this.widgets?.forEach((e=>e.visible=this.visible)),this._viewer?.setDirty()}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach((e=>e.dispose&&e.dispose())),this.widgets=[],super.onRemove(e)}refresh(){this._createWidgets(this._viewer?.scene.modelRoot)}_createWidgets(e){e?.traverse((e=>{if("light"!==e.assetType)return;const t=this.widgets.find((t=>t.objectRef===e));t?t.update&&t.update():this.helpers.filter((t=>t.Check(e))).forEach((t=>{const i=t.Create(e);this.widgets.push(i),this._viewer?.scene.addWidget(i)}))}))}}Ft.PluginType="LightWidgetsPlugin",function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)}([(0,s.onChange)(Ft.prototype._onVisibleChange)],Ft.prototype,"visible",void 0);class Bt extends p.Q{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=e=>{e.object.traverse((e=>{void 0===e.userData[Bt.PluginType]&&(e.userData[Bt.PluginType]={transforms:[]});const t={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{this.addTransform(e),t?.uiRefresh?.()}},()=>e.userData[Bt.PluginType].transforms.map(((t,i)=>({type:"folder",label:`Transform ${i}`,children:[{type:"vec3",label:"Position",property:[t,"position"]},{type:"vec3",label:"Quaternion",property:[t,"quaternion"]},{type:"vec3",label:"Scale",property:[t,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(e,t)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(e,t)}}]})))]};e.uiConfig?.children?.push(t)}))}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(e)}addTransform(e){e.userData[Bt.PluginType].transforms.push({position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()})}setTransform(e,t){e.position.copy(t.position),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale),e.userData.setDirty?.(),e.uiConfig?.uiRefresh?.()}animateTransform(e,t){console.log(e,t);const i=this._viewer?.getPluginByType("PopmotionPlugin");i||this._viewer?.console.error("PopmotionPlugin required for animation");const n="number"==typeof t?e.userData[Bt.PluginType].transforms[t]:t,s=new V.Pa4,r=new V._fP,o=new V.Pa4,a=e.position.clone(),l=e.quaternion.clone(),h=e.scale.clone(),d=n.position,c=n.quaternion,p=n.scale;i?.animate({from:0,to:1,duration:2e3,onUpdate:t=>{s.lerpVectors(a,d,t),r.slerpQuaternions(l,c,t),o.lerpVectors(h,p,t),e.position.copy(s),e.quaternion.copy(r),e.scale.copy(o),this._viewer?.setDirty(),this._viewer?.renderer.resetShadows()},onStop:()=>{e.position.copy(n.position),e.quaternion.copy(n.quaternion),e.scale.copy(n.scale),e.userData.setDirty?.(),e.uiConfig?.uiRefresh?.()}})}}Bt.PluginType="TransformAnimationPlugin";var zt=i(2295);class Vt extends n.o{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[Ee.r,ke.p,Ie._,L.y]},{title:"Picking",plugins:[Se.e,R.l,tt.h,xe.M,Te.cz,Ft]},{title:"Scene",plugins:[De.l,ft.C,Me.p,Oe.U,je.o,Ke.F,Je.h,vt.O]},{title:"Anti-aliasing",plugins:[We.E,ht.N,rt.l]},{title:"Post Processing",plugins:[Re.I,B.r,ot.v,Fe._,qe.k,nt.Q,Ye.i,Be.i,ze.d,Ve.H,Ge.s,et.j]},{title:"Export",plugins:[l.I,Pe.G,Ce.n,Ue.P]},{title:"Animations",plugins:[Qe.L,it.qK,st.E,Ae.T,wt.H]},{title:"Modifiers",plugins:[fe.q,ve.z,we.kZ,z.F,yt.F,bt.N,at.o]},{title:"Configurators",plugins:[be.e,ye.z,pt.j,_e.t]},{title:"Plugins",plugins:[Ze.$,ct.D,Ne.D,dt.$,_t.w,He.w,Xe.D,ut.r,$e.R,lt.T,c._,me.YY,zt.P]},{title:"Extras",plugins:[xt.e]}],(0,r.S)()}async setupUi(e,t){await(0,r.V)(this,e,t??this.defaultModes),this._editorInitialized=!0}}async function Ht(e,{debug:t=!1,ground:i=!0,bloom:n=!0,depthTonemap:r=!1,importPopup:p=!0,caching:u=!0}){e.enabled=!1,t&&await e.addPlugin(o.z),e.getPlugin(a.k)||await e.addPlugin(a.k,void 0,void 0,{storage:u&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await e.addPlugin(l.I),await e.addPlugin(h.K),await e.addPlugin(d.i),p&&await e.addPlugin(c._),await e.addPlugin(mt.S,!1),await e.addPlugin(T),await e.addPlugin(A.G),await e.addPlugin(U.J),await e.addPlugin(L.y),await e.addPlugin(wt.H),await e.addPlugin(Bt),await e.addPlugin(R.l,F.c,!1,!0),await(0,gt.B)(e,{ground:i,bloom:n,depthTonemap:r}),await e.addPlugin(B.r),await e.addPlugin(z.F,!1),await e.addPlugin(X),await e.addPlugin(re),await e.addPlugin(ge),await e.addPlugin(me.YY,!1),await e.addPlugin(fe.q),await e.addPlugin(ve.z),await e.addPlugin(we.kZ),await e.addPlugin(ye.z),await e.addPlugin(be.e),await e.addPlugin(_e.t),await e.addPlugin(xe.M),await e.addPlugin(Ce.n),await e.addPlugin(Pe.G),await e.addPlugin(Se.e),await e.addPlugin(Me.p),await e.addPlugin(Oe.U),await e.addPlugin(je.o),await e.addPlugin(Ee.r),await e.addPlugin(ke.p),await e.addPlugin(De.l),await e.addPlugin(Ft),await e.addPlugin(Te.cz),await e.addPlugin(Ae.T,e.container,!1),await e.addPlugin(Ue.P);const g=await e.addPlugin(new Le.L(!(0,s.mobileAndTabletCheck)()));return e.renderer.refreshPipeline(),e.scene.addEventListener("textureAdded",(t=>{t.texture&&e.scene.setEnvironment(t.texture)})),g.setupPluginUi(ct.D),g.setupPluginUi(Ee.r),g.setupPluginUi(ke.p),g.setupPluginUi(L.y),g.setupPluginUi(De.l),g.setupPluginUi(l.I),g.setupPluginUi(Qe.L),g.setupPluginUi(Ke.F),g.setupPluginUi(be.e),g.setupPluginUi(ye.z),g.setupPluginUi(wt.H),g.setupPluginUi(Se.e),g.setupPluginUi(xe.M),g.setupPluginUi(tt.h),g.setupPluginUi(R.l),i&&e.getPlugin(ft.C)&&g.setupPluginUi(ft.C),i&&e.getPlugin(vt.O)&&g.setupPluginUi(vt.O),g.setupPluginUi(Ye.i),g.setupPluginUi(it.qK),g.setupPluginUi(Ce.n),g.setupPluginUi(Re.I),g.setupPluginUi(B.r),g.setupPluginUi(Fe._),g.setupPluginUi(qe.k),g.setupPluginUi(ot.v),g.setupPluginUi(nt.Q),g.setupPluginUi(Ve.H),g.setupPluginUi(Be.i),g.setupPluginUi($e.R),g.setupPluginUi(ut.r),g.setupPluginUi(Me.p),g.setupPluginUi(fe.q),g.setupPluginUi(ve.z),g.setupPluginUi(We.E),g.setupPluginUi(Oe.U),g.setupPluginUi(je.o),g.setupPluginUi(He.w),g.setupPluginUi(Xe.D),g.setupPluginUi(lt.T),n&&g.setupPluginUi(ze.d),g.setupPluginUi(Pe.G),g.setupPluginUi(Ze.$),g.setupPluginUi(ht.N),g.setupPluginUi(Je.h),g.setupPluginUi(Ge.s),g.setupPluginUi(et.j),g.setupPluginUi(we.kZ),g.setupPluginUi(dt.$),g.setupPluginUi(rt.l),g.setupPluginUi(Ie._),g.setupPluginUi(pt.j),g.setupPluginUi(Ne.D),g.setupPluginUi(z.F),g.setupPluginUi(c._),g.setupPluginUi(st.E),g.setupPluginUi(me.YY),g.setupPluginUi(Ue.P),g.setupPluginUi(Ae.T),g.setupPluginUi(Te.cz),g.setupPluginUi(_e.t),g.setupPluginUi(at.o),g.setupPluginUi(Ft),g.setupPluginUi(zt.P),e.enabled=!0,e}},2804:function(e,t,i){i.d(t,{F:function(){return a}});var n=i(3330),s=i(2988),r=i(5551),o=i(995);let a=class extends o.${_buildCSGMesh(e){return function(e,t){let i=new n.y;const r=e.map((e=>e[0].material)).flatMap((e=>e));e.forEach((([e,t])=>{if(!o.r.includes(t))return void console.error(`Unknown operation ${t}`);e.updateMatrix(),e.updateMatrixWorld();const s=e.matrix;e.matrix=e.matrixWorld;let a=0;a=Array.isArray(e.material)?void 0:r.indexOf(e.material),i=i[t](n.y.fromMesh(e,a)),e.matrix=s}));const a=i.toMesh((new s.yGw).identity(),r);return a.userData._isCSGMesh=!0,a.geometry.groups=a.geometry.groups.filter((e=>e.count>0)),a}(e)}};a.PluginType="CSGPluginBSP",a=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([(0,r.Sp)("CSG Plugin (BSP)")],a)},3277:function(e,t,i){i.d(t,{N:function(){return d}});var n=i(2988),s=i(995),r=i(7551),o=i(3558),a=i(3319),l=i(5551);const h={union:r.UC,subtract:r.vC,intersect:r.TP,difference:r.tD};let d=class extends s.${_buildCSGMesh(e){return function(e,t){const i=new o.v;i.useGroups=!0,i.attributes=["position","normal","uv"],e.forEach((e=>{for(const t of[...i.attributes])e[0].geometry.getAttribute(t)||i.attributes.splice(i.attributes.indexOf(t),1)}));let s=new a.B(new n._12(.01,.01,2,2));e.forEach((([e,t])=>{if(!Object.keys(h).includes(t))return void console.error(`Unknown operation ${t}`);e.updateMatrix(),e.updateMatrixWorld();const n=new a.B;n.geometry=e.geometry,n.material=e.material,e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.updateMatrix(),n.updateMatrixWorld(),s=i.evaluate(s,n,h[t])}));const r=s;return r.userData._isCSGMesh=!0,r}(e)}};d.PluginType="CSGPluginBVH",d=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([(0,l.Sp)("CSG Plugin (BVH)")],d)},995:function(e,t,i){i.d(t,{$:function(){return d},r:function(){return h}});var n=i(3995),s=i(2988),r=i(2095),o=i(5551),a=i(9008),l=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const h=["union","subtract","intersect"];class d extends n.Q{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[r.l],this.rootMesh=new s.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),e.getPlugin(r.l)?.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){const e=this._viewer?.getPlugin(r.l)?.getSelectedObject();e&&e.geometry&&(e.userData._isCSGMesh||(e.userData.csgBrush||(e.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,a.downloadBlob)(e,"csg."+e.ext)}async exportObject(){const e=this._viewer?.getPluginByType("AssetExporterPlugin")?.exporter;if(!e||!this.rootObject)return;const t=this.rootMesh.visible;this.rootMesh.visible=!0;const i=await e.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=t,i}_updateSelectedProperties(){const e=this._viewer?.getPlugin(r.l)?.getSelectedObject();e&&e.userData.csgBrush&&(e.userData.csgBrush.enabled=this.csgSelectedEnabled,e.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){const e=this._viewer?.getPlugin(r.l)?.getSelectedObject();e&&(this.csgSelectedEnabled=e.userData.csgBrush?.enabled??!1,this.csgSelectedOperation=e.userData.csgBrush?.operation??"union"),this.uiConfig?.uiRefresh?.("postFrame",!0)}_preFrame(){if(!this.rootObject)return;if(!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const e=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,this.rootObject?.modelObject.updateMatrixWorld(!0),(this.rootMesh.userData.dispose??this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(e)),this.rootMesh&&!this.rootMesh.parent&&this.rootObject?.modelObject.add(this.rootMesh),this.showResult?(e.forEach((e=>{e[0].visible=!1})),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(e.forEach((e=>{e[0].visible=!0})),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){const e=[];return this._viewer?.scene.traverse((t=>{t.isMesh&&t.geometry&&t.userData.csgBrush?.enabled&&e.push([t,t.userData.csgBrush.operation])})),e}_sceneUpdate(e){e?.object?.userData?._isCSGMesh||(this._csgNeedsUpdate=!0)}}l([(0,o.Q7)("Show Result",(e=>({onChange:()=>e._viewer?.setDirty()})))],d.prototype,"showResult",void 0),l([(0,o.M)("Make CSG Brush",(e=>({hidden:()=>{const t=e._viewer?.getPlugin(r.l)?.getSelectedObject();return!t?.userData||!!t.userData.csgBrush||t.userData._isCSGMesh}})))],d.prototype,"makeSelectedCSGBrush",null),l([(0,o.Q7)("Enabled",(e=>({hidden:()=>{const t=e._viewer?.getPlugin(r.l)?.getSelectedObject();return!t||!t.userData.csgBrush},onChange:e._updateSelectedProperties})))],d.prototype,"csgSelectedEnabled",void 0),l([(0,o.vI)("Operation",h.map((e=>({label:e}))),(e=>({hidden:()=>{const t=e._viewer?.getPlugin(r.l)?.getSelectedObject();return!t||!t.userData.csgBrush},onChange:e._updateSelectedProperties})))],d.prototype,"csgSelectedOperation",void 0),l([(0,o.M)("Refresh CSG")],d.prototype,"refreshCSG",null),l([(0,o.M)("Export Result",(e=>({hidden:()=>!e._viewer?.getPluginByType("AssetExporterPlugin")})))],d.prototype,"downloadObject",null)},8453:function(e,t,i){i.d(t,{H:function(){return g}});var n,s=i(3995),r=i(4107),o=i(5551),a=i(3653),l=i(500),h=i(2988),d=i(2095),c=i(9280),p=i(1672),u=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let g=n=class extends s.Q{constructor(e=!1){super(),this._world=new a.q3,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{this._viewer?.scene.modelRoot.children.forEach((e=>{this.makeBody(e)}))},this._bodyMeshMap=new Map,this._movementPlane=new h.Kj0(new h._12(100,100),new h.vBJ({color:65280,side:h.ehD})),this.enabled=e,this._world.gravity.set(0,-9.81,0);const t=new a.JO,i=new a.uT({mass:0,position:new a.AO(0,-2,0)});i.addShape(t),i.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=i,this._world.addBody(i);const n=new a.aL(.1);this._jointBody=new a.uT({mass:0}),this._jointBody.addShape(n),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(e){await super.onAdded(e);const t=new h.Pa4,i=new h.Pa4,s=new h.Pa4,r=new h._fP,o=new h._fP,l=new h.yGw,u=new h.yGw;let g=!1,m=!1;function f(t){const i=e.canvas.getBoundingClientRect(),n=new h.FM8;return n.x=(t.clientX-i.x)/i.width*2-1,n.y=-(t.clientY-i.y)/i.height*2+1,n}e.addEventListener("preFrame",(()=>{const a=e.getPlugin(c.C),h=e.getPlugin(p.$);if(!this.enabled){if(!(this.nextSteps>0))return a&&g&&(a.enableRefreshTransform=!0,g=!1),h&&m&&(h.enable(n.PluginType),m=!1),void(this._dirty=!1);this.enabled=!0}if(a&&a.enableRefreshTransform&&!g&&(a.enableRefreshTransform=!1,g=!0),h&&!m&&h.disable(n.PluginType),this.nextSteps>0)for(let e=0;e<this.stepPhysics.stepCount;e++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let d=!1;for(const e of this._world.bodies){if(0===e.mass)continue;const n=this._bodyMeshMap.get(e);if(n&&(n.updateMatrixWorld(),n.getWorldPosition(i),n.getWorldQuaternion(o),n.getWorldScale(s),i.manhattanDistanceTo(t.copy(e.position))>0&&(d=!0),o.angleTo(r.copy(e.quaternion))>0&&(d=!0),d)){if(l.compose(t,r,s),!n.parent)throw new Error("no parent");u.copy(n.parent.matrixWorld).invert(),u.multiply(l),u.decompose(t,r,s),n.position.copy(t),n.quaternion.copy(r)}}this._dirty=d,e.setDirty(),e.renderer.resetShadows(),a?.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)})),e.scene.addEventListener("update",(e=>{this._bodyMeshMap.forEach(((e,t)=>{t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0)}))})),e.scene.addEventListener("addSceneObject",(e=>{const t=e.object?.modelObject;t&&t.traverse((e=>{const t=e.uiConfig;t&&Array.isArray(t.children)&&(t.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(e)},{type:"number",label:"Mass",hidden:()=>!e._physicsBody,getValue:()=>e._physicsBody?.mass??0,setValue:t=>{e._physicsBody&&(e._physicsBody.mass=t)}}]}),void 0!==e.userData.physicsMass&&this.makeBody(e))}))})),e.canvas.addEventListener("pointerdown",(t=>{if(!this.enabled)return;if(!t.isPrimary)return;e.getPlugin(d.l).enabled=!1;const i=f(t),n=new h.iMs;n.setFromCamera(i,e.scene.activeCamera.cameraObject);const s=n.intersectObjects([...this._bodyMeshMap.values()],!0);if(!s.length)return;let r,o=null,l=s[0];for(const e of s){for(o=e.object,l=e;!(null==o||o.visible&&o.material);)o=o.parent;if(o)break}if(!o)return;for(;o.parent&&!r;){for(const[e,t]of this._bodyMeshMap.entries())if(t===o){e.mass>0&&(r=e);break}o=o.parent}if(!r)return;e.scene.activeCamera.interactionsEnabled=!1,this._movementPlane.position.copy(l.point),this._movementPlane.lookAt(e.scene.activeCamera.cameraObject.getWorldPosition(new h.Pa4));const c=(new a.AO).copy(l.point).vsub(r.position),p=r.quaternion.inverse().vmult(c);this._jointBody.position.copy(l.point),this._jointConstraint=new a.Qx(r,p,this._jointBody,new a.AO(0,0,0)),this._world.addConstraint(this._jointConstraint)})),e.canvas.addEventListener("pointermove",(t=>{if(!this.enabled)return;if(!t.isPrimary)return;if(!this._jointConstraint)return;const i=f(t),n=new h.iMs;n.setFromCamera(i,e.scene.activeCamera.cameraObject);const s=n.intersectObject(this._movementPlane);if(!s.length)return;const r=s[0];this._jointBody.position.copy(r.point),this._jointConstraint.update()})),e.canvas.addEventListener("pointerup",(t=>{this.enabled&&t.isPrimary&&(e.getPlugin(d.l).enabled=!0,e.scene.activeCamera.interactionsEnabled=!0,this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))}))}makeBody(e){if(e.isLight)return;if(e._physicsBody)return;const t=[];let i=0;if(e.updateMatrixWorld(),e.traverse((e=>{const n=e;if(!n.isMesh)return;if(n._physicsShape)return void t.push(n._physicsShape);if(i+=n.userData.physicsMass??1,n.addEventListener("objectUpdate",(()=>{0===n.userData.physicsMass&&(this._ground.position.y=n.position.y,this._bodyMeshMap.forEach(((e,t)=>{t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0),t.force.set(0,0,0),t.torque.set(0,0,0)})))})),0===n.userData.physicsMass)return;const s=(0,l.J7)(n,{type:l.DY.HULL});s?(t.push([s.shape,n]),n._physicsShape=s.shape):console.warn("Failed to convert mesh to cannon shape",n)})),!t.length)return;const n=new a.uT({mass:i,angularVelocity:new a.AO(0,0,0),velocity:new a.AO(0,0,0)}),s=new h.Pa4,r=new h._fP,o=new h.Pa4,d=new h.yGw;for(const[i,l]of t)l!==e?(l.updateMatrixWorld(),d.copy(e.matrixWorld).invert(),d.multiply(l.matrixWorld),d.decompose(s,r,o),n.addShape(i,new a.AO(...s.toArray()),new a._f(...r.toArray()))):n.addShape(i);n.position.set(...e.getWorldPosition(s).toArray()),n.quaternion.set(...e.getWorldQuaternion(r).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0),e.addEventListener("objectUpdate",(()=>{n.position.set(...e.getWorldPosition(s).toArray()),n.quaternion.set(...e.getWorldQuaternion(r).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0)})),this._world.addBody(n),this._bodyMeshMap.set(n,e),e._physicsBody=n,e.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};g.PluginType="CannonPhysics",u([(0,o.Q7)("Enabled",(e=>({onChange:()=>{}}))),(0,r.qC)()],g.prototype,"enabled",void 0),u([(0,o.FJ)()],g.prototype,"stepPhysics",void 0),u([(0,o.M)("Make Root Bodies")],g.prototype,"makeRootBodies",void 0),g=n=u([(0,o.Sp)("Physics (dev)")],g)},8903:function(e,t,i){i.d(t,{O:function(){return g}});var n=i(2988),s=i(9228),r=i(9008),o=i(4107),a=i(3770),l=i(7398),h=i(8434),d=i(8816),c=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const p=new n.jyz(h.P);p.depthTest=!1;const u=new n.jyz(d.Z);u.depthTest=!1;class g extends s.g{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new n.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(l.z)}async onAdded(e){const t=e.renderer.createTarget({type:n.ywz,format:n.wk1,colorSpace:n.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:n.wem,magFilter:n.wem});t.texture.name="groundContactDepthTexture";const i=new n.lRF({depthPacking:n.z81});i.onBeforeCompile=function(e){e.uniforms.opacity.value=1,e.fragmentShader=`\n\t\t\t\t\t\t${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}\n\t\t\t\t\t`};const s=new a.J(t,i,new n.Ilk(0,0,0),0);this._depthPass=s,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer)return;if(!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:n.ywz,format:n.wk1,colorSpace:n.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:n.wem,magFilter:n.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(p.uniforms.h.value=t*this.blurAmount/256,u.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:p,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:u,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new n.Pa4)),this.shadowCamera.setRotationFromEuler(new n.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){this._viewer?.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){if(!this._viewer)return!1;const e=super._refreshMaterial();return this._material?(this._material.alphaMap=this._depthPass?.target.texture||null,e&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1),e):e}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}g.PluginType="ContactShadowGroundPlugin",c([(0,r.onChange)(g.prototype.refreshOptions),(0,o.qC)()],g.prototype,"contactShadows",void 0),c([(0,o.qC)(),(0,r.onChange)(g.prototype._setDirty)],g.prototype,"blurAmount",void 0),c([(0,o.qC)(),(0,r.onChange)(g.prototype._refreshShadowCameraFrustum)],g.prototype,"shadowScale",void 0),c([(0,o.qC)(),(0,r.onChange)(g.prototype._refreshShadowCameraFrustum)],g.prototype,"shadowHeight",void 0)},3065:function(e,t,i){i.d(t,{e:function(){return h}});var n=i(3995),s=i(9008),r=i(4821),o=i(2988),a=i(9505),l=i(6453);class h extends n.Q{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Shadow type",type:"dropdown",children:[["Basic",o._MY],["PCF",o._iA],["PCFSoft",a.ntZ],["VSM",a.dwk]].map((e=>({label:e[0],value:e[1]}))),getValue:()=>this._viewer?.renderer.rendererObject.shadowMap.type,setValue:e=>{this._viewer?.doOnce("postFrame",(()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())}))}}),()=>({label:(this._viewer?.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,s.setUrlQueryParam)("rgbm",this._viewer?.useRgbm?"no":"yes",!0)}}),()=>({label:(this._viewer?.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,s.setUrlQueryParam)("msaa",this._viewer?.isAntialiased?"no":"yes",!0)}}),()=>({label:(this._viewer?.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,s.setUrlQueryParam)("depthPrepass",this._viewer?.useGBufferDepth?"no":"yes",!0)}}),()=>({label:(this._viewer?.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,s.setUrlQueryParam)("debug",this._viewer?.getPluginByType("debug")?null:"true",!0)}}),{label:"Clear local storage",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{const e=this._viewer?.getPlugin(r.k)?.storage;if(e instanceof Storage)e.clear();else if(e instanceof Cache){const t=await e.keys();await Promise.all(t.map((async t=>e.delete(t))))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{const e=new Set;this._viewer?.scene.modelRoot.traverse((t=>t.geometry&&e.add(t.geometry))),e.forEach((e=>(0,l.Y)(e)))}},{label:"Auto Center All Geometries",type:"button",value:()=>{const e=new Set;this._viewer?.scene.modelRoot.traverse((t=>t.geometry&&e.add(t.geometry))),e.forEach((e=>{const t=new o.Pa4;e.center(t),e.userData.__appliedMeshes.forEach((e=>{e.position.sub(t),e.setDirty&&e.setDirty()}))}))}}]}}}h.PluginType="ExtrasUiPlugin1"},5933:function(e,t,i){i.d(t,{i:function(){return r}});var n=i(3995),s=i(9008);class r extends n.Q{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,t,i)=>{(0,s.downloadBlob)(e,t)}},this.actions={...this.defaultActions}}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting"}),await this.actions.exportFile(e,t,(({state:e,progress:i})=>{this.dispatchEvent({type:"transferFile",path:t,state:e??"exporting",progress:i})})),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}}r.PluginType="FileTransferPlugin"},560:function(e,t,i){i.d(t,{e:function(){return o}});var n=i(3995),s=i(9008),r=i(8466);class o extends n.Q{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,s.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(e,t)=>(e.push({text:t.name||"unnamed",id:t.uuid,children:t.children.reduce(this._buildData,[])}),e),this._findVisible=(e,t)=>t.visible?(t.children.length<1?e.push(t.uuid):e.push(...t.children.reduce(this._findVisible,[])),e):e,this._setVisible=e=>{this._viewer?.doOnce("postFrame",(()=>{const t=this._viewer?.scene.modelRoot;if(!t||null==e)return;const i=new Set;t.traverse((n=>{n!==t&&(n.visible=e.includes(n.uuid),n.visible&&n.traverseAncestors((e=>i.add(e))))})),i.forEach((e=>e.visible=!0)),this._viewer?.scene?.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})}))},this.enabled=e,this.reset=this.reset.bind(this),(0,s.createStyles)(s.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){if(e?.fromHierarchyPlugin)return;if(!e?.hierarchyChanged)return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const t=this._viewer?.scene.modelRoot;if(!t)return;const i=t.children.reduce(this._buildData,[]),n=t.children.reduce(this._findVisible,[]);let o=!1;return new Promise(((e,a)=>{this.treeView=new r.Z(this.hierarchyDiv,{closeDepth:1,data:i,loaded:function(){this.values=n,e()},onChange:()=>{o?(0,s.timeout)(200).then((()=>{this.treeView&&this._setVisible(this.treeView.values)})):o=!0},onItemLabelClick:e=>{const i=this._viewer?.scene.modelRoot.modelObject.getObjectByProperty("uuid",e);i&&t.visible&&i.dispatchEvent({type:"select",value:i,ui:!0})}})}))}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}o.PluginType="HierarchyUiPlugin"},9930:function(e,t,i){i.d(t,{U:function(){return o}});var n=i(3995),s=i(4821),r=i(4091);class o extends n.Q{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new r.qt;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const e=new r.B$;e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const e=new r.qD;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const e=new r.iw;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,e.lookAt(0,0,0),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[s.k],this._sceneUpdate=e=>{if(!e.hierarchyChanged)return;const t=[];this._viewer?.traverseSceneObjects((e=>{if(!e.lightObject)return;const i=e.uiConfig;i&&!t.includes(i)&&t.push(i)})),[...this.uiConfig.children].forEach((e=>{"button"===e?.type||t.includes(e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(e),1)})),t.forEach((e=>{this.uiConfig.children.includes(e)||this.uiConfig.children.push(e)})),this.uiConfig.uiRefresh?.("postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}o.PluginType="SimpleLightsUi"},6153:function(e,t,i){i.d(t,{F:function(){return u}});var n,s=i(3995),r=i(9008),o=i(2988),a=i(4821),l=i(6533),h=i(5551),d=i(4107),c=i(8670),p=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let u=n=class extends s.Q{constructor(e=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,i)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <map_fragment>");for(const t of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=(0,c.p)(e.fragmentShader,`#include <${t}>`,o.WdD[t].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=(0,c.p)(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=(0,c.p)(e.fragmentShader,"#include <normal_fragment_maps>",(0,c.p)((0,c.p)(o.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?"#ifdef USE_BUMPMAP\nmat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){\n#if defined( TANGENTSPACE_NORMALMAP ) && 0 \nvec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);\n#else\nvec2 texOffs=1./bumpMapSize;\n#if PARALLAX_NORMAL_MAP_QUALITY > 0\nfloat hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);\n#else\nfloat h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);\n#endif\nreturn normalize(vec3(deltaH/texOffs,1.));\n#endif\n}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;\n#pragma unroll_loop_start\nfor(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}\n#pragma unroll_loop_end\nbestBumpHeight+=bumpHeightStep;\n#pragma unroll_loop_start\nfor(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}\n#pragma unroll_loop_end\nbestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);\n#ifdef FLIP_SIDED\nnormal=-normal;\n#endif\nreturn parallaxUv;}\n#endif \n\n".replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>this.enabled+" "+e.materialObject.bumpMap?.uuid+" "+this.debugNormals+" "+this.debugHitHeight+"  ",onObjectRender:(e,{materialObject:t},i)=>{if(this.enabled)for(const[e,i]of Object.entries(this._defines)){const n="number"==typeof i?i:i?1:0;t.defines[e]!==n&&(t.defines[e]=n,t.needsUpdate=!0)}}},this.dependencies=[a.k],this.enabled=e,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){this._bumpMapExtension?.setDirty?.(),this._viewer?.setDirty()}async onAdded(e){return e.getPlugin(a.k)?.materials?.registerMaterialExtension(this._bumpMapExtension),super.onAdded(e)}async onRemove(e){return e.getPlugin(a.k)?.materials?.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(e)}};u.PluginType="ReliefParallaxMapping",p([(0,r.onChange)(n.prototype._updateExtension),(0,d.qC)(),(0,h.Q7)("Enabled")],u.prototype,"enabled",void 0),p([(0,r.onChange)(n.prototype._updateExtension),(0,h.Q7)("Debug Normals")],u.prototype,"debugNormals",void 0),p([(0,r.onChange)(n.prototype._updateExtension),(0,h.Q7)("Debug Hit Height")],u.prototype,"debugHitHeight",void 0),p([(0,l.lD)("PARALLAX_MAP_STEPS",void 0,!0,n.prototype._updateExtension),(0,h.t8)("Step count",[1,32],1),(0,d.qC)()],u.prototype,"stepCount",void 0),p([(0,l.lD)("PARALLAX_MAP_B_STEPS",void 0,!0,n.prototype._updateExtension),(0,h.t8)("Binary search steps",[1,8],1),(0,d.qC)()],u.prototype,"binaryStepCount",void 0),u=n=p([(0,h.Sp)("Parallax Mapping")],u)},5268:function(e,t,i){i.d(t,{o:function(){return r}});var n=i(3995),s=i(4821);class r extends n.Q{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[s.k],this._sceneUpdate=e=>{if(!e.hierarchyChanged)return;const t=[];this._viewer?.traverseSceneObjects((e=>{if(!e.cameraObject)return;const i=e.uiConfig;i&&!t.includes(i)&&t.push(i)})),[...this.uiConfig.children].forEach((e=>{"button"===e?.type||t.includes(e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(e),1)})),t.forEach((e=>{this.uiConfig.children.includes(e)||this.uiConfig.children.push(e)})),this.uiConfig.uiRefresh?.("postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}r.PluginType="SimpleSceneCamerasUi"},6320:function(e,t,i){i.d(t,{T:function(){return f}});var n=i(5551),s=i(9008),r=i(2988),o=i(3995),a=i(4107),l=i(3036),h=i(3206),d=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class c extends o.Q{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:r.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[l.qK],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=e=>{this._preFrame(e)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){return this._viewer?.getPlugin(l.qK)?.camViews??[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){if(!this.enabled)return;const t=this._cameraViews;if(t.length<=1)return;if(!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=r.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=r.M8C.clamp(this._oldState,0,t.length-1.001);const i=Math.floor(this._oldState),n=this._overrideStartView||t[i],s=this._overrideEndView||t[i+1];let o,a=this._overrideStartView?this._overrideTime:this._oldState-i;a=h.q8[this.animEase](a),o="spherical"===this.interpolateMode?this._lerpViewsSpherical(n,s,a):this._lerpViewsLinear(n,s,a);const l=this._viewer?.scene.activeCamera;l&&(l.position.copy(o[0]),l.target.copy(o[1]),l.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,t,i){const n=new r.Pa4,s=new r.Pa4;return s.lerpVectors(e.position,t.position,i),n.lerpVectors(e.target,t.target,i),[s,n]}_lerpViewsSpherical(e,t,i){const n=e.target.clone(),s=new r.Pa4,o=new r.Pa4,a=(0,l.pQ)(e,e.target),h=(0,l.pQ)(t,t.target),d=new r.$V;return d.phi=(0,l.td)(a.phi,h.phi,i),d.theta=(0,l.td)(a.theta,h.theta,i),d.radius=r.M8C.lerp(a.radius,h.radius,i),s.copy(n).lerp(t.target,i),o.setFromSpherical(d),o.add(s),[o,s]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new l.it(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const t=Math.floor(this._oldState),i=this._oldState-t;let n;n="spherical"===this.interpolateMode?this._lerpViewsSpherical(e[t],e[t+1],i):this._lerpViewsLinear(e[t],e[t+1],i),this._overrideEndView=new l.it(n[0],n[1]),this._overrideTime=0}}c.PluginType="CameraViewControlPlugin",d([(0,n.Q7)("Enabled"),(0,s.onChange)(c.prototype._onEnabledChanged1),(0,a.qC)()],c.prototype,"enabled",void 0),d([(0,a.qC)(),(0,n.vI)("Ease",Object.keys(h.q8).map((e=>({label:e}))))],c.prototype,"animEase",void 0),d([(0,a.qC)(),(0,n.vI)("Interpolation",["spherical","linear"].map((e=>({label:e}))))],c.prototype,"interpolateMode",void 0),d([(0,n.Q7)("Enable Damping"),(0,a.qC)()],c.prototype,"enableDamping",void 0),d([(0,n.t8)("Damping",[.01,1],.001),(0,a.qC)()],c.prototype,"damping",void 0),d([(0,n.t8)("Init Anim Time",[.01,5],.001),(0,a.qC)()],c.prototype,"initAnimationTime",void 0);class p extends c{constructor(e=document.body,t=!0){super(t),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...(0,n._t)(this)]},"string"==typeof e?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){if(!this.enabled)return;if(this._cameraViews.length<=1)return;const t=this._findActiveView(),i=this._getScroll(t);this.setState(i+t),super._preFrame(e)}_getScroll(e){if(e>=this._cameraViews.length-1)return 0;const t=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],i=this.parent.querySelector(this._cameraViews[e+1].name)??this.parent.getElementsByTagName("section")[e+1],n=this.parent.getBoundingClientRect();if(!t||!i)return 0;const s=t.getBoundingClientRect(),o=i.getBoundingClientRect(),a=this.parent===document.body?0:n.top;return r.M8C.clamp((a-s.top)/Math.max(o.top-s.top,1e-4),0,1)}_findActiveView(){for(let e=this._cameraViews.length-1;e>=0;e--){const t=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],i=this.parent.getBoundingClientRect();if(t){if(t.getBoundingClientRect().top<(this.parent===document.body?0:i.top))return e}else this._cameraViews[e].name?.startsWith("#")&&console.error("section with id "+this._cameraViews[e].name+" doesn't exist!")}return 0}}p.PluginType="ScrollableCameraViewPlugin";var u,g=i(1504),m=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let f=u=class extends p{generateCode(){const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="200";const t=document.createElement("textarea");t.rows=20,t.style.border="3px solid #27223a",t.style.borderRadius="5px",t.style.width="30%",t.style.padding="5px",t.style.zIndex="1000";const i=document.createElement("div");i.textContent="X",i.style.color="red",i.style.width="20px",i.style.height="20px",i.style.padding="2",i.style.textAlign="center",i.style.backgroundColor="white",i.style.borderRadius="100%",i.style.border="2px solid #27223a",i.style.cursor="pointer",i.addEventListener("click",(()=>{this._viewer?.container.removeChild(e)}));const n=document.createElement("div");n.textContent="Update",n.style.marginTop="10px",n.style.color="white",n.style.padding="4px 10px 4px 10px",n.style.justifyContent="center",n.style.alignItems="center",n.style.backgroundColor="green",n.style.borderRadius="10px",n.style.border="2px solid #fff",n.style.cursor="pointer",n.addEventListener("click",(()=>{const e=this.parent.innerHTML;this.parent.innerHTML=t.value;let i=0;for(;i<this._cameraViews.length;i++){const e=this.parent.querySelector(this._cameraViews[i].name)??this.parent.getElementsByTagName("section")[i];if(!e&&i<2){alert("you need to add 2 sections at least");break}if(!e){const e=(this._cameraViews[i].name?.startsWith("#"),this._cameraViews[i].name.replace(/^#/,""));t.value+=e,t.value=this._format(t.value)}}i<2?this.parent.innerHTML=e:(0,g.zL)(this.parent,t.value)})),e.appendChild(i),e.appendChild(t),e.appendChild(n),t.value=this._format(this.parent.innerHTML),this._viewer?.container.appendChild(e)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(e=document.body,t=!1){super(e,t),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(e){this.parent=this.wrapper,await super.onAdded(e),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),this._viewer?.getPlugin(l.qK)?.addEventListener("viewDelete",this.deleteView),this._viewer?.getPlugin(l.qK)?.addEventListener("deserialize",this.deserialize),this._viewer?.getPlugin(l.qK)?.addEventListener("viewAdd",this.addView)}deserialize(e){this._cameraViews.forEach((e=>{this._createSection(e.name)}))}_addWrapper(){this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",this._viewer?.container.appendChild(this.wrapper)}_createSection(e){const t=document.createElement("section");t.style.width="100%",t.style.height="100%",t.style.opacity="50%",t.style.backgroundColor="black",t.style.zIndex="100",t.style.top="0",t.textContent=e,t.style.color="white",t.style.fontSize="100px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.id=e,this.parent.appendChild(t)}addView(e){this._cameraViews.forEach(((e,t)=>{if(!(this.parent.querySelector(e.name)??this.parent.getElementsByTagName("section")[t])){const t=`<section id="${e.name?.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">\n                    ${e.name}\n                    </section>`;this.parent.innerHTML+=t}}))}deleteView(e){const t=this.parent.querySelector(e.view.name)??this.parent.getElementsByTagName("section").namedItem(e.view.name);t?.remove()}_format(e){let t="",i="";return e.split(/>\s*</).forEach((function(e){e.match(/^\/\w/)&&(i=i.substring("\t".length)),t+=i+"<"+e+">\r\n",e.match(/^<?\w[^>]*[^/]$/)&&!e.startsWith("input")&&(i+="\t")})),t.substring(1,t.length-3)}};m([(0,n.M)("Show/Edit Code")],f.prototype,"generateCode",null),m([(0,n.Q7)("Canvas on top"),(0,s.onChange)(u.prototype._togglePreview)],f.prototype,"canvasUp",void 0),f=u=m([(0,n.Sp)("Scrollable Camera View Preview (Dev)")],f)},5529:function(e,t,i){i.d(t,{z:function(){return d}});var n=i(3995),s=i(5551),r=i(2095),o=i(2988);class a extends o.u9r{constructor(e,t,i=32,n=64,s=!1,r=new o.FM8(1,1),a="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:i,tubularSegments:n,closed:s,primary:a,shapeScale:r.clone()};const l=t.computeFrenetFrames(n,s);this.frames=l;const h=new o.Pa4,d=new o.Pa4,c=new o.Pa4,p=new o.FM8;let u=new o.Pa4;const g=[],m=[],f=[],v=e.getSpacedPoints(i);for(const e of v)e.multiply(r);!function(){for(let e=0;e<n;e++)y(e);y(!1===s?n:0),function(){for(let e=0;e<=n;e++)for(let t=0;t<=i;t++)p.x=e/n,p.y=t/i,m.push(p.x,p.y)}(),function(){const e="shape"===a,t=e?i:n,s=e?n:i;for(let n=1;n<=t;n++)for(let t=1;t<=s;t++){const[s,r]=e?[t,n]:[n,t],o=(i+1)*(s-1)+(r-1),a=(i+1)*s+(r-1),l=(i+1)*s+r,h=(i+1)*(s-1)+r;f.push(o,a,h),f.push(a,l,h)}}()}(),this.setIndex(f),this.setAttribute("position",new o.a$l(g,3)),this.setAttribute("uv",new o.a$l(m,2)),this.computeVertexNormals();const w=this.attributes.normal;function y(e){u=t.getPointAt(e/n,u);const s=l.normals[e],r=l.binormals[e];for(let e=0;e<=i;e++){const t=v[e%i];d.set(0,0,0).addScaledVector(s,t.x).addScaledVector(r,t.y),h.copy(u).add(d),g.push(h.x,h.y,h.z)}}!function(){for(let e=1;e<i;e++){const t=e+n*(i+1);d.fromBufferAttribute(w,e),c.fromBufferAttribute(w,t),d.add(c).normalize(),w.setXYZ(e,d.x,d.y,d.z),w.setXYZ(t,d.x,d.y,d.z)}for(let e=1;e<n;e++){const t=e*(i+1),n=t+i;d.fromBufferAttribute(w,t),c.fromBufferAttribute(w,n),d.add(c).normalize(),w.setXYZ(t,d.x,d.y,d.z),w.setXYZ(n,d.x,d.y,d.z)}d.fromBufferAttribute(w,0),c.fromBufferAttribute(w,i),d.add(c);const e=n*(i+1);c.fromBufferAttribute(w,e),d.add(c),c.fromBufferAttribute(w,e+i),d.add(c),d.normalize(),w.setXYZ(0,d.x,d.y,d.z),w.setXYZ(i,d.x,d.y,d.z),w.setXYZ(e,d.x,d.y,d.z),w.setXYZ(e+i,d.x,d.y,d.z),w.needsUpdate=!0}()}createSplits(e){this.clearGroups();const t="shape"===this.parameters.primary?this.parameters.shapeSegments:this.parameters.tubularSegments,i=this.index.count,n=[...e,1].sort(((e,t)=>e-t));let s=0,r=0;for(const e of n){const n=Math.round(t*e)*i/t;this.addGroup(s,n-s,r++),s=n}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var l,h=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let d=l=class extends n.Q{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new o.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{const e=this._viewer?.getPlugin(r.l)?.getSelectedObject();if(!e)return;let t=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!t)return;t=parseFloat(t);const i=new c(0,0,t,t,0,2*Math.PI,!0,0);await this.extrudeObject(e,i)}}async onAdded(e){await super.onAdded(e)}static CreateCurve(e,t){if("circle"===e)return new c(0,0,t.radius??1,t.radius??1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(e,t,i=this.shapeSegments,n=this.tubularSegments,s=this.shapeScale,r=this.materialSplits.split(",").map((e=>parseFloat(e.trim()))),h=this.horizontalSplits){if(e.userData.isExtrudedTube,e.userData._extrudeSource){const t=e.userData._extrudeSource;if(e=e.parent?.children.find((e=>t===e.uuid)),!e)return void console.warn("Could not find extrude source with uuid",t)}if(e.userData.extrudedObject){const t=e.userData.extrudedObject,i=e.parent?.children.find((e=>t===e.uuid));i&&(i.removeFromParent(),i.geometry.dispose(),i.geometry=null,i.material=null),delete e.userData.extrudedObject}const d=e.geometry;if(!d)return void this._viewer?.alert("Extrude: No geometry to extrude");const c=[e.material];let p;try{const e=l.ConvertGeometryToFlatShape(d);p=new a(e,t,i,n,!0,s,h?"shape":"path"),p.computeBoundingBox(),p.createSplits(r)}catch(e){return void this._viewer?.alert("string"==typeof e?e:e?.message)}c[0].color.set(16777215);for(let e=c.length;e<p.groups.length;e++){const e=c[0].clone();c.push(e),e.color.set(16777215*Math.random())}const u=new o.Kj0(p,c);u.userData._extrudeSource=e.uuid,u.userData.isExtrudedTube=!0,e.visible=!1,e.userData.bboxVisible=!1,u.name=e.name+"_extruded";const g=await(this._viewer?.getManager()?.importer?.processImportedSingle(u,{autoCenter:!1,autoScale:!1}));g&&(e.parent?.add(g.modelObject),e.userData.extrudedObject=g.modelObject.uuid,g.dispatchEvent({type:"select",ui:!0,value:g}))}static ExtrudeShape(e,t,i,n,s,r,l,h){const d=new a(e,n,t,i,!0,new o.FM8(s,r),h?"shape":"path");d.computeBoundingBox(),d.createSplits(l);const c=new o.Kj0(d,[]);return c.userData.isExtrudedTube=!0,c}static ConvertGeometryToFlatShape(e,t=!0){if(e.userData.__planarShape)return e.userData.__planarShape;let i=e.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const n=e;i=n.attributes.position,n.boundingBox||n.computeBoundingBox();const s=n.boundingBox.getSize(new o.Pa4),r=s.x<.001?"x":s.y<.001?"y":s.z<.001?"z":null;if(!r)throw"geometry is not axis aligned not planar";let a=[];for(let e=0;e<i.count;e++){const t=new o.FM8;"x"===r?t.set(i.getY(e),i.getZ(e)):"y"===r?t.set(i.getX(e),i.getZ(e)):t.set(i.getX(e),i.getY(e)),a.push(t)}if(t){let e=0;for(let t=0;t<a.length;t++)(a[t].x<a[e].x||a[t].x===a[e].x&&a[t].y<a[e].y)&&(e=t);0!==e&&(a=a.slice(e).concat(a.slice(0,e)))}const l=new o.bnF(a);return e.userData.__planarShape=l,l}};d.PluginType="ShapeTubeExtrudePlugin",h([(0,s.Q7)("Enabled")],d.prototype,"enabled",void 0),h([(0,s.t8)("Shape Segments (X)",[1,100],1,(e=>({hidden:()=>!e._viewer?.getPlugin(r.l)?.getSelectedObject()})))],d.prototype,"shapeSegments",void 0),h([(0,s.t8)("Tube Segments (Y)",[1,100],1,(e=>({hidden:()=>!e._viewer?.getPlugin(r.l)?.getSelectedObject()})))],d.prototype,"tubularSegments",void 0),h([(0,s.KG)("Shape scale",[.01,10],.01,(e=>({hidden:()=>!e._viewer?.getPlugin(r.l)?.getSelectedObject()})))],d.prototype,"shapeScale",void 0),h([(0,s.ri)("Material Splits",(e=>({hidden:()=>!e._viewer?.getPlugin(r.l)?.getSelectedObject()})))],d.prototype,"materialSplits",void 0),h([(0,s.Q7)("Horizontal Splits",(e=>({hidden:()=>!e._viewer?.getPlugin(r.l)?.getSelectedObject()})))],d.prototype,"horizontalSplits",void 0),h([(0,s.M)("Extrude Circle Tube",(e=>({hidden:()=>!e._viewer?.getPlugin(r.l)?.getSelectedObject()})))],d.prototype,"extrudeCirceTube",void 0),d=l=h([(0,s.Sp)("Extrude Tube Shapes")],d);class c extends o.Ny0{getPoint(e,t){return super.getPoint(e,t||new o.Pa4)}}},7800:function(e,t,i){i.d(t,{kZ:function(){return m}});var n=i(3995),s=i(5551),r=i(9008),o=i(2988);class a extends o.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,i,n){return super.load(e,(e=>{try{t?.((0,r.blobToDataURL)(e))}catch(e){n?.(e)}}),i,n)}}var l,h,d=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const c=e=>({onChange:t=>{t.last&&e.onChange()}});let p=l=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(e){Object.assign(this,e)}reset(){const e=this.onChange;Object.assign(this,new l),this.onChange=e}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};d([(0,s.ri)("Text",c)],p.prototype,"text",void 0),d([(0,s.t8)("Font Size",[2,400],1,c)],p.prototype,"fontSize",void 0),d([(0,s.t8)("Width",[2,4096],1,c)],p.prototype,"width",void 0),d([(0,s.t8)("Height",[2,4096],1,c)],p.prototype,"height",void 0),d([(0,s.t8)("X Offset",[-1024,1024],1,c)],p.prototype,"xOffset",void 0),d([(0,s.t8)("Y Offset",[-1024,1024],1,c)],p.prototype,"yOffset",void 0),d([(0,s.t8)("V-Width",[2,4096],1,c)],p.prototype,"boxWidth",void 0),d([(0,s.t8)("V-Height",[2,4096],1,c)],p.prototype,"boxHeight",void 0),d([(0,s.vI)("Text Anchor",["start","middle","end"].map((e=>({label:e}))),c)],p.prototype,"textAnchor",void 0),d([(0,s.ri)("Font",c)],p.prototype,"fontFamily",void 0),d([(0,s.ri)("Font Url",c)],p.prototype,"fontPath",void 0),d([(0,s.Q7)("Mask Text",c)],p.prototype,"maskText",void 0),d([(0,s.Q7)("Inner Shadow",c)],p.prototype,"innerShadow",void 0),d([(0,s.s4)("Text Color",c)],p.prototype,"textColor",void 0),d([(0,s.s4)("BG Fill",c)],p.prototype,"bgFillColor",void 0),d([(0,s.s4)("SVG BG",c)],p.prototype,"svgBackground",void 0),p=l=d([(0,s.Sp)("Text SVG Options")],p);const u={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},g=e=>({hidden:()=>{const t=e.getSelected();return!t||!t.userData[m.PluginType]}});let m=h=class extends n.Q{async onAdded(e){await super.onAdded(e),e.getPluginByType("Picking")?.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>this._viewer?.getPluginByType("Picking")?.getSelectedObject(),this.options=new p,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){if(!this.enabled)return;const e=this.getSelected();if(!e)return void this.uiConfig.uiRefresh?.("postFrame",!0);const t=e.userData[h.PluginType];if(!t)return this.options.reset(),this._lastMeta=void 0,void this.uiConfig.uiRefresh?.("postFrame",!0);this._lastMeta!==t&&(this.options.set(t),this._lastMeta=t),this.uiConfig.uiRefresh?.("postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const e=this.getSelected();e&&e.isMesh&&e.userData[h.PluginType]&&this.updateText(e,this.options.toJSON())}async addTextToSelected(){const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[h.PluginType]||!e.material.map||await(this._viewer?.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(e,t){return this.updateText(e,Object.assign(this.options.toJSON(),t))}async updateText(e,t){if(!e.isMesh)return;if(!e.material)return void console.error("updateText: no material on mesh");let i=e.userData[h.PluginType];i||(e.userData[h.PluginType]=i={}),Object.assign(i,t);const n=e.material;n.map&&(n.map._isSimpleTextTexture&&n.map.dispose(),n.map=void 0),n.alphaMap&&(n.alphaMap._isSimpleTextTexture&&n.alphaMap.dispose(),n.alphaMap=void 0),n.bumpMap&&(n.bumpMap._isSimpleTextTexture&&n.bumpMap.dispose(),n.bumpMap=void 0);const s=await this.makeTextSvg(i);this.applyToMap&&(n.map=s),this.applyToAlphaMap&&(n.alphaMap=s,n.transparent=!0),this.applyToBumpMap&&(n.bumpMap=s),n.userData.inverseAlphaMap=this.inverseAlphaMap,n.setDirty(),n.needsUpdate=!0,this.uiConfig.uiRefresh?.("postFrame",!0)}async makeTextSvg(e){const t=e.fontFamily||"Arial",i=e.fontPath||this.fonts[t]||"";let n=e.style;if(i.length>0){const e=i.split("?")[0].split(".").pop()||"woff";n+="\n"+(i.length>0?`\n            @font-face {\n                font-family: ${t};\n                src: url(${i}) format(${u[e]||e});\n            }`:"")}let s=function({text:e="Custom Text",svgBackground:t="#ffffff",xOffset:i=0,yOffset:n=0,width:s=1024,height:r=1024,boxWidth:o=1024,boxHeight:a=1024,fontFamily:l="",fontSize:h=32,maskText:d=!0,innerShadow:c=!0,bgFillColor:p="#000000",textColor:u="#ffffff",textAnchor:g="middle",style:m=""}){return`\n<svg style="background-color:${t}" width="${s}" height="${r}" viewBox="0 0 ${o} ${a}"\n xmlns="http://www.w3.org/2000/svg"\n xmlns:xlink="http://www.w3.org/1999/xlink">\n     <defs>\n        <style>\n        ${m}\n        </style>\n    </defs>\n\n    <g style="overflow:hidden; text-anchor: ${g}; font-size: ${h}px; font-family: ${l||"Arial"}">\n        <defs>\n\n`+(d?`\n<mask id="textMask">\n<text style="fill:white; font-size: ${h}px;" x="${i+o/2}" y="${a/2+n+h/4}" > ${e} </text>\n</mask>\n`:"")+"\n\n"+(c?'\n<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">\n<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>\n<feOffset in="blur" dx="1.5" dy="1.5"/>\n</filter>\n':"")+"\n\n        </defs>\n\n"+(d?'\n        <g mask="url(#textMask)">\n':"")+`\n\n        <rect x="0" y="0" width="${o}" height="${a}" style="fill:${p}"/>\n        <text style="${c?"filter: url(#innerShadow);":""} fill:${u};" x="${i+o/2}" y="${a/2+n+h/4}"> ${e} </text>\n\n`+(d?"\n        </g>\n":"")+"\n\n    </g>\n</svg>\n"}({...e,fontFamily:t,style:n});s=await(0,r.embedUrlRefs)(s,(async e=>this._getAssetData(e))),s=(0,r.svgUrl)(s);const a=await this._viewer.getManager().importer.importSinglePath(s,{generateMipmaps:!1,minFilter:o.wem});return a._isSimpleTextTexture=!0,a.flipY=!1,a.needsUpdate=!0,a}async _getAssetData(e){if(e.startsWith("http://www.w3.org"))return e;const t=this._viewer?.getManager()?.importer;if(!t)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new a(t.loadingManager),processImported:!1};try{return await t.importPath(e,this._assetLoadOptions)}catch(e){return console.error(e),""}}};m.PluginType="SimpleTextPlugin",d([(0,s.FJ)(void 0,{params:g})],m.prototype,"options",void 0),d([(0,s.Q7)("Apply Map",g),(0,r.onChange)(h.prototype._paramsChanged)],m.prototype,"applyToMap",void 0),d([(0,s.Q7)("Apply Bump Map",g),(0,r.onChange)(h.prototype._paramsChanged)],m.prototype,"applyToBumpMap",void 0),d([(0,s.Q7)("Apply Alpha Map",g),(0,r.onChange)(h.prototype._paramsChanged)],m.prototype,"applyToAlphaMap",void 0),d([(0,s.Q7)("Invert Alpha Map",g),(0,r.onChange)(h.prototype._paramsChanged)],m.prototype,"inverseAlphaMap",void 0),d([(0,s.M)("Add Text",(e=>({hidden:()=>!e.getSelected()})))],m.prototype,"addTextToSelected",null),m=h=d([(0,s.Sp)("Simple Text")],m)},356:function(e,t,i){i.d(t,{t:function(){return c}});var n=i(9008),s=i(743),r=i(1375),o=i(7162),a=i(3995),l=i(4821);class h extends a.Q{constructor(){super(...arguments),this.dependencies=[l.k],this.enabled=!0,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,t)=>{let i=e.icon;return(i&&/^(\w+)\(([^)]*)\)/.exec(i)||/^#([A-Fa-f\d]+)$/.exec(i))&&(i=(0,n.makeColorSvg)(i)),i&&i.startsWith("http")&&i.startsWith("data:")||(i=this.utils.pathToIcon(this.baseUrl+t+"/"+e.prefix+(i||""))),i},getItemIcon:(e,t,i)=>{const s=e.iconFiles[t];if(s)return URL.createObjectURL(s);let r=e.icons[t];return(r&&/^(\w+)\(([^)]*)\)/.exec(r)||/^#([A-Fa-f\d]+)$/.exec(r))&&(r=(0,n.makeColorSvg)(r)),r||(r=this.utils.pathToIcon(e.items[t])),!r||r.startsWith("http")||r.startsWith("data:")||(r=this.baseUrl+i+"/"+e.prefix+r),r},getItemTitle:(e,t)=>e.titles[t]||this.utils.pathToTitle(e.items[t]),getItemPath:(e,t,i)=>e.items[t].startsWith("http")?e.items[t]:`${this.baseUrl}${i}/${e.prefix}${e.items[t]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,t,i,n=!1){if(!this._viewer)return;const s=this._getVariationId(e);"number"==typeof t&&(t=e.items[t]);const r=e.items.indexOf(t);if(-1===r)return void this._viewer.console.warn(`Item ${t} not found`);const o=e.itemFiles[r],a=e.selected;if(!n&&a===r)return;e.selected=r;const l=this._viewer.getManager(),h=this.utils.getItemPath(e,r,i);if("objects"===i){let e=this._viewer.scene.findObjectsByName(s).map((e=>e.modelObject));0===e.length&&(e=[(await this._viewer.createObject3D()).modelObject],e[0].name=s),this._viewer.renderEnabled=!1;for(const t of e)[...t.children].forEach((e=>e.dispose&&this.autoDispose?e.dispose():e.removeFromParent()));const t=await this._loadObject(h,o);if(!t.length)return void(h.endsWith("json")||this._viewer.console.warn(`Object ${h} not found`));let i=!1;for(const n of e){[...n.children].forEach((e=>e.dispose&&this.autoDispose?e.dispose():e.removeFromParent()));for(const e of t)i?n.add(e.modelObject.clone()):n.add(e.modelObject);i=!0}const n=[],r=this.variations.materials.filter((e=>e&&"number"==typeof e.selected));for(const e of r)n.push(this.applyVariation(e,e.selected,"materials",!0));await Promise.all(n),this._viewer.renderEnabled=!0}if("materials"===i){const t=await this._loadMaterial(h,o);if(!t)return void this._viewer.console.warn(`Material ${h} not found`);t.userData.__isVariation=!0;const i=this._viewer.scene.findObjectsByName(s),n=i=>{i.material&&(Array.isArray(i.material)?0!==i.material.length&&e.data?.matType!==i.material[0].typeSlug:e.data?.matType!==i.material.typeSlug)||i?.setMaterial?.(t)};for(const t of i)e.data?.traverse?t.traverse(n):n(t);l.materials?.applyMaterial(t,s)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const t of e){const e=this._getVariationId(t),i=this._viewer.scene.findObjectsByName(e);for(const e of i)[...e.children].forEach((e=>(e.dispose??e.removeFromParent)()))}}async _loadMaterial(e,t){return this._viewer?.getManager()?.importer?.importSinglePath(e,{importedFile:t})}async _loadObject(e,t){return this._viewer?.getManager()?.importer?.importPath(e,{importedFile:t,reimportDisposed:!0})}importConfig(e,t){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.baseUrl&&(this.baseUrl=e.baseUrl),!t&&e.folder&&(t="object"==typeof e.folder?e.folder:"string"==typeof e.folder?(0,s.GZ)((0,s.TD)(e.folder)):(0,s.GZ)(e.folder));for(const i of this._ty)if(e[i])for(const n of e[i]){const e={items:n.items,prefix:n.prefix,name:n.name,title:n.title||"",icon:n.icon||"",icons:n.icons??n.items.map((()=>"")),titles:n.titles??n.items.map((()=>"")),itemFiles:[],iconFiles:[],data:{...n.data}};if(t)for(let s=0;s<n.items.length;s++){const r=n.items[s],o=t[i+"/"+n.prefix+r];e.itemFiles[s]=o?new File([o],r):void 0;const a=n.icons[s];if(!a)continue;const l=t[i+"/"+n.prefix+a];e.iconFiles[s]=l?new File([l],a):void 0}this.variations[i].push(e)}}async importPath(e){if(e.endsWith(".json")){const t=await(this._viewer?.getManager().importer?.importSinglePath(e,{processImported:!1})),i=e.split("?")[0];return this.baseUrl||(this.baseUrl=i.substring(0,i.lastIndexOf("/")+1)),this.importConfig(t)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){return this.variations.materials.find((t=>this.utils.getName(t)===e))?.items||[]}getObjects(e){return this.variations.objects.find((t=>this.utils.getName(t)===e))?.items||[]}getMaterialVariations(){return this.variations.materials.map((e=>this.utils.getName(e)))}getObjectVariations(){return this.variations.objects.map((e=>this.utils.getName(e)))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){let e={objects:{},materials:{}};const t={objects:[],materials:[],type:h.PluginType};this.baseUrl&&(t.baseUrl=this.baseUrl);let i=!1;for(const n of this._ty)for(const s of this.variations[n]){const r={...s};r.data={...r.data},delete r.itemFiles,delete r.iconFiles,t[n].push(r);const o=s.prefix.replace(/^\//,""),a=o.trimEnd().endsWith("/")?"":o.split("/").pop()||"",l=o.replace(a,"").trimEnd().replace(/\/$/,""),h={};let d=!1;for(let e=0;e<s.items.length;e++){const t=s.items[e],i=s.itemFiles[e],n=s.iconFiles[e],r=s.icons[e];i?(h[a+t]=new Uint8Array(await i.arrayBuffer()),n&&!r&&this._viewer?.console.error("Icon file without icon name"),n&&r&&(h[a+r]=new Uint8Array(await n.arrayBuffer())),d=!0):n&&alert("Icon file without model/material file not supported")}if(!d)continue;i=!0;const c=l.split("/");let p=e[n];for(const e of c){p[e]||(p[e]={});const t=p[e];if("object"!=typeof t)throw new Error("Invalid prefix: "+s.prefix);p=t}Object.assign(p,h)}return i||(e=void 0),{folder:e,config:t}}}h.PluginType="VariationConfiguratorPlugin";class d extends h{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled)return!1;if(!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,r.M.RemoveAll(d.PluginType);for(const e of["objects","materials"])for(const t of this.variations[e])r.M.Create(d.PluginType,this.utils.getTitle(t),5,20,0,t.items.map(((i,n)=>({id:i,image:this.utils.getItemIcon(t,n,e),onClick:async i=>this.applyVariation(t,i,e,!1),tooltip:this.utils.getItemTitle(t,n)}))),((e,t)=>(0,o.ZP)(e,{placement:"bottom",content:t.tooltip})));return r.M.RebuildUi(this._viewer.container),!0}}d.PluginType="VariationConfiguratorPlugin";class c extends d{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map((e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map((t=>({type:"folder",expanded:this._uiExpandedState[t.name],onExpand:()=>this._uiExpandedState[t.name]=!0,onCollapse:()=>this._uiExpandedState[t.name]=!1,label:()=>this.utils.getName(t),children:[{type:"input",placeholder:()=>this.utils.getName(t),property:[t,"name"]},{type:"input",property:[t,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(t)),property:[t,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+t.prefix),property:[t,"icon"]},{type:"folder",label:"items",children:t.items.map(((i,s)=>({type:"folder",label:()=>t.items[s],children:[{type:"input",label:"File/URL",isMonitor:!t.itemFiles[s],getValue:()=>t.items[s],setValue:e=>{t.items[s]=e}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(t.items[s]),getValue:()=>t.icons[s],setValue:e=>{t.icons[s]=e}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(t.items[s]),getValue:()=>t.titles[s],setValue:e=>{t.titles[s]=e}},{type:"button",label:"Apply",value:async()=>this.applyVariation(t,s,e)},t.itemFiles[s]?[{type:"button",label:"Remove",value:()=>{t.items.splice(s,1),t.itemFiles.splice(s,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const e=await(0,n.uploadFile)(!1,!1);0!==e.length&&(t.itemFiles[s]=e[0],t.items[s]=e[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const e=t.itemFiles[s];(0,n.downloadBlob)(e,e.name)}}]:{}]})))},{type:"button",label:"Add item (local)",value:async()=>{const i=await(0,n.uploadFile)(!0,!1);if(0!==i.length){for(const n of i){if(!this._extForType[e].includes(n.name.split(".").pop()??"")){await(this._viewer?.alert(`Invalid file: ${n.name} is not a valid ${e} file`));continue}if(t.items.includes(n.name)){await(this._viewer?.alert(`Already exists: Item with name ${n.name} already exists`));continue}const i=t.items.push(n.name)-1;t.icons[i]="",t.titles[i]="",t.itemFiles[i]=n}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{const i=await(this._viewer?.prompt("URL: Enter the url of the object/material"));if(!i)return;if(!i.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await(this._viewer?.alert(`Invalid url: ${i} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(i.split(".").pop()??""))return void await(this._viewer?.alert(`Invalid url: ${i} should be of a material ending with mat`));t.items.includes(i)&&await(this._viewer?.alert(`Already exists: Item with url ${i} already exists`)),t.items.push(i);const n=t.items.length-1;t.icons[n]="",t.titles[n]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(t),value:async()=>{await(this._viewer?.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(t)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(t),1),this.refreshUi())}}]}))),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{const t=await(this._viewer?.prompt("Name: Enter the name of the object/material"));t&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:t+"/",name:t,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{const t=await(0,n.uploadFile)(!1,!0);if(0===t.length)return;const i=[],s=[],r=[],o=[];for(const n of t){if(n.name.startsWith("."))continue;const t=n.name.split(".").pop()??"";t?this._extForType[e].includes(t)?(i.push(n.webkitRelativePath.replace(/^\//,"")),s.push(n)):this._extForType.images.includes(t)?(r.push(n.webkitRelativePath.replace(/^\//,"")),o.push(n)):await(this._viewer?.alert(`Invalid file: ${n.name} is not a valid ${e} file`)):await(this._viewer?.alert(`Invalid file: ${n.name} has no extension`))}const a=(0,n.longestCommonPrefix)(i),l=this.utils.getName({prefix:a});let h=await(this._viewer?.prompt("Name: Enter the name of the object/material",l,!0));if(null===h)return;h=h||l;const d=i.map((e=>{const t=e.replace(a,""),i=t.split(".").pop()??"",n=t.replace("."+i,"")+".",s=r.findIndex((e=>e.replace(a,"").startsWith(n)));return s<0?["",void 0]:[r[s].replace(a,""),o[s]||void 0]}));this.variations[e].push({items:i.map((e=>e.replace(a,""))),icons:d.map((e=>e[0])),iconFiles:d.map((e=>e[1])),titles:i.map((()=>"")),itemFiles:s,prefix:a,name:h,icon:"",title:""}),this.refreshUi()}}]}))),{type:"button",label:"Download JSON/Zip",value:async()=>{try{const{folder:e,config:t}=await this._exportConfiguratorState(),i=JSON.stringify(t,null,4);if(e){e["config.json"]=(0,s.TD)(i);const t=await(0,s.Xo)(e),r=new Blob([t],{type:"application/zip"});(0,n.downloadBlob)(r,"configurator.zip")}else{const e=new Blob([i],{type:"application/json"});(0,n.downloadBlob)(e,"config.json")}}catch(e){return this._viewer?.console.error(e),void await(this._viewer?.alert("Error: "+(e?.message||e)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{const e=await(0,n.uploadFile)(!1,!1,"application/zip,application/json");if(0===e.length)return;const t=e[0];if(t.name.endsWith(".zip")){const e=(0,s.GZ)(new Uint8Array(await t.arrayBuffer()));if(!e["config.json"])return void await(this._viewer?.alert("Invalid zip: config.json not found"));const i=JSON.parse((0,s.T8)(e["config.json"]));this.importConfig(i,e)}else{if(!t.name.endsWith(".json"))return void await(this._viewer?.alert("Invalid file: "+t.name));{const e=JSON.parse(await t.text());this.importConfig(e)}}await(this._viewer?.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{const e=await(this._viewer?.prompt("URL: Enter the url of the json file."));e&&(await this.importPath(e),await(this._viewer?.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{await(this._viewer?.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){this.uiConfig?.uiRefresh?.("postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,t){const i=await super._loadObject(e,t);for(const e of i)(e.modelObject||e).userData.excludeFromExport=!0;return i}}c.PluginType="VariationConfiguratorPlugin"},7655:function(e,t,i){i.d(t,{cz:function(){return g}});var n,s=i(5551),r=i(2778),o=i(2988),a=i(9008),l=i(4107),h=i(3995),d=i(2095),c=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let p=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};c([(0,l.qC)()],p.prototype,"fixWinding",void 0),c([(0,l.qC)()],p.prototype,"maxBoundaryLength",void 0),c([(0,l.qC)()],p.prototype,"maxChartArea",void 0),c([(0,l.qC)()],p.prototype,"maxCost",void 0),c([(0,l.qC)()],p.prototype,"maxIterations",void 0),c([(0,l.qC)()],p.prototype,"normalDeviationWeight",void 0),c([(0,l.qC)()],p.prototype,"normalSeamWeight",void 0),c([(0,l.qC)()],p.prototype,"roundnessWeight",void 0),c([(0,l.qC)()],p.prototype,"straightnessWeight",void 0),c([(0,l.qC)()],p.prototype,"textureSeamWeight",void 0),c([(0,l.qC)()],p.prototype,"useInputMeshUvs",void 0),p=c([(0,s.Sp)("Chart Options"),(0,l.Bg)("UChartOptions")],p);let u=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};c([(0,l.qC)()],u.prototype,"bilinear",void 0),c([(0,l.qC)()],u.prototype,"blockAlign",void 0),c([(0,l.qC)()],u.prototype,"bruteForce",void 0),c([(0,l.qC)()],u.prototype,"createImage",void 0),c([(0,l.qC)()],u.prototype,"maxChartSize",void 0),c([(0,l.qC)()],u.prototype,"padding",void 0),c([(0,l.qC)()],u.prototype,"resolution",void 0),c([(0,l.qC)()],u.prototype,"rotateCharts",void 0),c([(0,l.qC)()],u.prototype,"rotateChartsToAxis",void 0),c([(0,l.qC)()],u.prototype,"texelsPerUnit",void 0),u=c([(0,s.Sp)("Pack Options"),(0,l.Bg)("UPackOptions")],u);let g=n=class extends h.Q{constructor(e=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new p,this.packOptions=new u,this._loaded=!1,this._unwrapProgress=(e,t)=>{console.log("Unwrapping",e,t)},this.unwrapSelected=async()=>{const e=this._viewer?.getPlugin(d.l)?.getSelectedObject();if(e)if(e.geometry){if(e.geometry.attributes.uv&&!await(this._viewer?.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(e.geometry)}else this._viewer?.alert("Unwrap: Selected object has no geometry");else this._viewer?.alert("Unwrap: No object selected")},e&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,a.timeout)(100);else this._unwrapper=new r.Q({BufferAttribute:o.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,n.LIBRARY_PATH+"xatlas.wasm",n.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(e,t="uv",i="uv"){await this.loadLibrary(),await(this._unwrapper?.unwrapGeometry(e,t,i))}async packAtlas(e,t=!0,i="uv2",n="uv"){await this.loadLibrary(),Array.isArray(e)||(e=[e]);const s=[];t?e.forEach((e=>e.traverse((e=>{e.geometry&&s.push(e.geometry)})))):e.forEach((e=>{e.geometry&&s.push(e.geometry)})),await(this._unwrapper?.packAtlas(s,i,n))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};g.PluginType="XAtlasPlugin",g.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",c([(0,a.onChange)(n.prototype._useNormalsChanged),(0,l.qC)()],g.prototype,"useNormals",void 0),c([(0,l.qC)()],g.prototype,"chartOptions",void 0),c([(0,l.qC)()],g.prototype,"packOptions",void 0),c([(0,s.M)("Unwrap Selected Geometry")],g.prototype,"unwrapSelected",void 0),g=n=c([(0,s.Sp)("UV Unwrapping (xAtlas)")],g)},7721:function(e,t,i){i.d(t,{YY:function(){return p}});var n,s=i(3995),r=i(9561),o=i(2988),a=i(5551),l=i(2095),h=i(9008),d=i(4107),c=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let p=n=class extends s.Q{constructor(e=!0){super(),this._scene=new o.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{const e=this._viewer?.getPlugin(l.l)?.getSelectedObject();if(!e?.geometry)return void await(this._viewer?.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const t=await(this._viewer?.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!t)return;const i=await(this._viewer?.prompt("Width: Enter the width for the object.","512",!1))||"512";i&&this.attachIFrame(e,t,parseInt(i))},this._resizeObserver=new ResizeObserver((()=>{this.enabled&&this._viewer?.scene.setDirty({sceneUpdate:!0})})),this.enabled=e,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const e=this._viewer;e&&this._renderer&&(e.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",e.canvas):this._renderer.domElement.appendChild(e.canvas))}_initialize(){if(this._renderer)return;if(!this._viewer)return;this._renderer=new r.lX;const e=this._viewer.renderer.rendererObject.getSize(new o.FM8);this._renderer.setSize(e.width,e.height);const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.zIndex="0",t.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(t),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",(()=>{if(!this._viewer||!this._renderer)return;const e=this._viewer.renderer.rendererObject.getSize(new o.FM8);this._renderer.setSize(e.width,e.height)}))}async onAdded(e){await super.onAdded(e);let t=!0,i=!0;e.addEventListener("postFrame",(n=>{t&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach((e=>{let t=!0;const i=e.modelObj.material.side;if(i!==o.ehD){const n=new o.Pa4(0,0,1).applyQuaternion(e.cssObj.quaternion),s=this._viewer?.scene.activeCamera?.cameraObject,r=n.dot(s.getWorldDirection(new o.Pa4));t=i===o._Li?r>0:r<0}e.cssObj.element.style.visibility=t?"visible":"hidden"})),this._trackers.filter((e=>e.dirty)).forEach((e=>this._syncProperties(e))),this._renderer?.render(this._scene,e.scene.activeCamera?.cameraObject),t=!1))})),e.addEventListener("update",(e=>{this.enabled&&(t=this._trackers.length>0)})),e.scene.addEventListener("sceneUpdate",(e=>{this.enabled&&(this._trackers.forEach((e=>e.dirty=!0)),t=this._trackers.length>0)})),e.scene.addEventListener("activeCameraUpdate",(e=>{this.enabled&&(t=this._trackers.length>0,i=!0)}));let n=!1;const s=new o.iMs;e.container.addEventListener("mousemove",(e=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const t=this._viewer.canvas.getBoundingClientRect(),i=(e.clientX-t.x)/t.width*2-1,r=-(e.clientY-t.y)/t.height*2+1;s.setFromCamera({x:i,y:r},this._viewer.scene.activeCamera.cameraObject);const o=this._trackers.map((e=>e.modelObj)),a=s.intersectObjects(o,!1);if(console.log(a),a.length)return this._viewer.canvas.style.pointerEvents="none",n=!0,void console.log(this._viewer.canvas.style.pointerEvents);n&&(this._viewer.canvas.style.pointerEvents="auto",n=!1)}))}attachIFrame(e,t,i){const n=m(e.modelObject),s=function(t,i,n,s){const o=document.createElement("div");o.style.width=i.toString()+"px",o.style.height=n.toString()+"px",o.style.backgroundColor="transparent";const a=document.createElement("iframe",{is:"x-frame-bypass"});a.style.width="100%",a.style.height="100%",a.style.border="0px";const l=()=>{try{a.contentWindow.name}catch(e){("string"==typeof e?e:e?.toString?.()??"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(e)}e.setDirty?.(),a.removeEventListener("load",l)};return a.addEventListener("load",l),a.src=t,o.appendChild(a),new r.cp(o)}(t,i,i*n.y/n.x);return this.attachCSS3DObject(s,e),s}attachCSS3DObject(e,t){if(this._trackers.push({cssObj:e,modelObj:t.modelObject,dirty:!0}),e.element&&(this._resizeObserver.observe(e.element),e.element.__isCSS3DObjectElement=!0,console.log(e.element,e.element.__isCSS3DObjectElement)),t.userData.__oldMaterial=t.material,!t.setMaterial)throw"model not processed?";const i=this._viewer?.createMaterial("basic",{opacity:0,color:new o.Ilk("black"),blending:o.jFi,side:o.Wl3});if(!i)throw"cannot create mat";i.userData.forcedLinearDepth=0,t.setMaterial?.(i),u(t.modelObject),g(t.modelObject),m(t.modelObject),this._scene.add(e),this.uiConfig?.uiRefresh?.(),t.setDirty?.()}_syncProperties(e){const t=e.modelObj,i=e.cssObj;t.updateMatrixWorld();const n=e.cssObj.element.clientWidth<1.5?0:(e.cssObj.element.clientWidth-1.5)/m(t).x,s=u(t);i.quaternion.setFromUnitVectors(new o.Pa4(0,0,1),s),i.position.copy(g(t)),i.scale.set(1,1,1).multiplyScalar(1/n),i.updateMatrixWorld(),i.applyMatrix4(t.matrixWorld),e.dirty=!1}async onDispose(e){return this._resizeObserver.disconnect(),super.onDispose(e)}};function u(e){if(e.geometry.userData.geometryNormal)return e.geometry.userData.geometryNormal;const t=e.geometry.attributes.normal,i=new o.Pa4,n=new o.Pa4;for(let e=0,s=t.count;e<s;e++)i.fromBufferAttribute(t,e),n.add(i);return n.normalize(),e.geometry.userData.geometryNormal=n,n}function g(e){if(e.geometry.userData.geometryCenter)return e.geometry.userData.geometryCenter;const t=e.geometry;if(!t)return new o.Pa4(0,0,0);t.boundingBox||t.computeBoundingBox();const i=t.boundingBox.getCenter(new o.Pa4);return e.geometry.userData.geometryCenter=i,i}function m(e,t=new o.Pa4(0,0,1)){if(e.geometry.userData.geometrySize)return e.geometry.userData.geometrySize;const i=e.geometry;if(!i)return new o.Pa4(0,0,0);const n=i.clone();n.applyMatrix4((new o.yGw).makeRotationFromQuaternion((new o._fP).setFromUnitVectors(t,u(e)).invert())),n.computeBoundingBox();const s=n.boundingBox.getSize(new o.Pa4);return e.geometry.userData.geometrySize=s,n.dispose(),s}p.PluginType="CSS3DRenderer",c([(0,a.Q7)("Enabled"),(0,h.onChange)(n.prototype._refreshEnabled),(0,d.qC)()],p.prototype,"enabled",void 0),c([(0,a.Q7)("Over canvas"),(0,h.onChange)(n.prototype._refreshCanvasInDOM),(0,d.qC)()],p.prototype,"overCanvas",void 0),c([(0,a.M)("Attach iframe")],p.prototype,"attachIFrameToSelected",void 0),p=n=c([(0,a.Sp)("CSS3D Renderer")],p)},853:function(e,t,i){i.d(t,{r:function(){return y}});var n=i(2988),s=i(5551),r=i(4107),o=i(9033),a=i(9008),l=i(8670),h=i(3278),d=i(5008),c=i(3206),p=i(4915),u=i(6533);class g extends p.C{constructor(e,t,i,s=new n.Ilk(1,1,1),r=1){super(void 0,void 0,i,s,r),this.target=t,this._getSelectedObject=e}render(e,t,i,s,r){const o=e.getRenderTarget(),a=e.getActiveCubeFace(),l=e.getActiveMipmapLevel(),h=this._getSelectedObject();if(h)this._renderSelectedObject(e,h,t,s,r);else{e.setRenderTarget(this.target);const t=new n.Ilk;e.getClearColor(t),e.setClearColor(new n.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(t)}e.setRenderTarget(o,a,l)}_renderSelectedObject(e,t,i,n,s){if(!this.camera)return;t.traverse((e=>{e.layers.enable(6)}));const r=this.camera.layers.mask;this.camera.layers.set(6);const o=e.userData;o||console.error("threejs is not patched?"),o.transmissionRenderTarget=i,(0,u.of)(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},(()=>super.render(e,i,this.target,n,s))),o.transmissionRenderTarget=void 0,t.traverse((e=>{e.layers.disable(6)})),this.camera.layers.mask=r}}var m,f=i(3995),v=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let w=m=class{constructor(e,t){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new n.Ilk(15305317),this.debugOutline=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new n.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new n.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(e,t)=>this.enabled?a.glsl`
            ${o.Z}
            ${"uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;\n#if DEBUG_OUTLINE > 0\ncolor=vec4(0.,0.,0.,1.);\n#endif\nvec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}"}
        `:"",this._combinedPostPlugin=e.getPlugin(d.x),this._pickingPlugin=e.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),t&&(this.extraUniforms.outlineBuffer.value=t.texture),this._enable()}shaderExtender(e,t,i){this.enabled&&(e.fragmentShader=(0,l.p)(e.fragmentShader,"#glMarker"," \n            gl_FragColor = outline(gl_FragColor);\n            #glMarker\n        "))}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){this.__setDirty?.(),this._setDirty()}_enable(){this._pickingPlugin?.enableWidget(!this.enabled),this._setDirty()}};w.PluginType="Outline",v([(0,a.onChange)(m.prototype._enable),(0,s.Q7)("Enable"),(0,r.qC)()],w.prototype,"enabled",void 0),v([(0,a.onChange)(m.prototype._setDirty),(0,s.Q7)("Highlight"),(0,r.qC)()],w.prototype,"enableHighlight",void 0),v([(0,a.onChange)(m.prototype._setDirty),(0,s.Q7)("DynamicSelection"),(0,r.qC)()],w.prototype,"enableDynamicSelection",void 0),v([(0,a.onChange)(m.prototype._setDirty),(0,s.t8)("Intensity",[0,2],.001,{limitedUi:!0}),(0,r.qC)()],w.prototype,"outlineIntensity",void 0),v([(0,a.onChange)(m.prototype._setDirty),(0,s.t8)("Transparency",[0,1],.01,{limitedUi:!0}),(0,r.qC)()],w.prototype,"highlightTransparency",void 0),v([(0,a.onChange)(m.prototype._setDirty),(0,s.s4)("Color"),(0,r.qC)()],w.prototype,"outlineColor",void 0),v([(0,a.onChange)(m.prototype._setDirty),(0,s.Q7)("Debug")],w.prototype,"debugOutline",void 0),w=m=v([(0,s.Sp)("Outline")],w);class y extends h.a{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new w(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const t=e?.getPluginByType("Picking"),i=new n.jyz({uniforms:{cameraNearFar:{value:new n.FM8(.1,100)}},vertexShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec3 vViewPosition;void main(){\n#include <skinbase_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition=-mvPosition.xyz;}",fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:n.ehD}),s=(0,f.M)(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new g((()=>t?.getSelectedObject()),this._outlineTarget,i),update(){e.scene.activeCamera.updateShaderProperties(this.passObject.overrideMaterial)}});e.renderer.registerPass(s),s.passObject.scene=e.scene.modelObject,s.passObject.camera=e.scene.activeCamera.cameraObject,e.scene.addEventListener("activeCameraChange",(()=>{s.passObject.camera=e.scene.activeCamera.cameraObject})),t?.addEventListener("selectedObjectChanged",(()=>{!this._animationCallBack&&this._extension&&(t?.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)})),document.addEventListener("mousemove",(i=>{if(!this._extension)return;if(!this.mouseInOutAnimationEnabled)return;const n=t?.getSelectedObject();n&&this._extension.enableDynamicSelection?i.target!==e.canvas?this._animationCallBack||"in"!==this._state||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||"out"!==this._state||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=n?this._extension.highlightTransparency:1}))}async _startTransparencyAnimation(e,t,i){return(0,c.wB)(this._extension,"transparency",{from:e,to:t,duration:i,onComplete:()=>{this._animationCallBack=null}})}}y.PluginType="Outline"},2244:function(e,t,i){i.d(t,{p:function(){return s}});var n=i(3995);class s extends n.Q{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){const t=super.toJSON(e);return t.activeCamera=this._viewer?.scene.activeCamera.toJSON(),t}fromJSON(e,t){return e.activeCamera&&(this._viewer?.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){this._viewer&&this.uiConfig.uiRefresh?.("postFrame",!0)}get uiConfig(){return this._viewer?.scene.activeCamera.uiConfig||{}}}s.PluginType="CameraUiPlugin"},5855:function(e,t,i){i.d(t,{r:function(){return h}});var n,s=i(3995),r=i(4107),o=i(5551),a=i(9008),l=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let h=n=class extends s.Q{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(e=!0){if(!this._viewer)return;if("full"===this.mode)return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const t={width:Math.floor(this.width),height:Math.floor(this.height)},i=this._viewer.container.getBoundingClientRect(),s={width:Math.floor(i.width),height:Math.floor(i.height)};let r=1;if(t.width>s.width){const e=t.width;t.width=s.width;const i=t.width/e;if(t.height=Math.floor(t.height*i),r/=i,r>n.MaxCanvasScale)return this.width=s.width*n.MaxCanvasScale,console.log("loop",this.width,s.width,r),void this._sizeChanged()}if(t.height>s.height){const e=t.height;t.height=s.height;const i=t.height/e;if(t.width=Math.floor(t.width*i),r/=i,r>n.MaxCanvasScale)return this.height=s.height*n.MaxCanvasScale,console.log("loop",this.width,s.width,this.height,s.height,r),void this._sizeChanged()}(t.width>=s.width||t.width<1)&&delete t.width,(t.height>=s.height||t.height<1)&&delete t.height,this._viewer.setSize(t),this._setScale(r),e&&(this.scale=r),this._refresh()}_setScale(e){this._viewer&&(this._viewer.renderer.displayCanvasScaling=e)}_scaleChanged(){if(!this._viewer)return;const e=this.scale;if(Math.abs(e-this._viewer.renderer.displayCanvasScaling)<.01)return;if("full"===this.mode)return void this._sizeChanged();const t=this.width/this.height,i=this._viewer.container.getBoundingClientRect(),n=Math.floor(i.width*e),s=Math.floor(n/t);this.width=n,this.height=s,this._sizeChanged(!1)}async onAdded(e){await super.onAdded(e);const t=e.canvas.clientWidth,i=e.canvas.clientHeight,n=e.renderer.displayCanvasScaling;this.width=t,this.height=i,this.scale=n,e.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",(()=>this._sizeChanged(!0))),this._refresh()}async onRemove(e){return e.renderer.removeEventListener("resize",this._refresh),super.onRemove(e)}_refresh(){this.uiConfig?.uiRefresh?.("postFrame",!0)}fromJSON(e,t){if(!e.mode)if(e.width||e.height){const t=this._viewer.container.getBoundingClientRect();e.width||(e.width=t.width),e.height||(e.height=t.height),e.scale&&(e.width*=e.scale,e.height*=e.scale,delete e.scale),e.width=Math.round(e.width),e.height=Math.round(e.height),e.mode="custom"}else e.mode="full";return super.fromJSON(e,t)}toJSON(e){const t=super.toJSON(e);return"full"===t.mode&&(delete t.width,delete t.height),"custom"===t.mode&&delete t.scale,t}};h.PluginType="RendererParamsUiPlugin",h.MaxCanvasScale=5,l([(0,r.qC)("version")],h.prototype,"_serializeVersion",void 0),l([(0,r.qC)(),(0,o.vI)("Mode",["full","custom"].map((e=>({label:e})))),(0,a.onChange2)(n.prototype._sizeChanged)],h.prototype,"mode",void 0),l([(0,r.qC)(),(0,o.t8)("Width",void 0,1,(e=>({onChange:()=>e._sizeChanged(),hidden:()=>"full"===e.mode,bounds:()=>[10,Math.pow(2,Math.ceil(Math.log2(e._viewer?.container.getBoundingClientRect().width||1024)+2))]})))],h.prototype,"width",void 0),l([(0,r.qC)(),(0,o.t8)("Height",void 0,1,(e=>({onChange:()=>e._sizeChanged(),hidden:()=>"full"===e.mode,bounds:()=>[10,Math.pow(2,Math.ceil(Math.log2(e._viewer?.container.getBoundingClientRect().height||1024)+2))]})))],h.prototype,"height",void 0),l([(0,r.qC)(),(0,a.onChange)(n.prototype._scaleChanged),(0,o.t8)("Scale",[.25,n.MaxCanvasScale],.001,(e=>({disabled:()=>"custom"===e.mode})))],h.prototype,"scale",void 0),h=n=l([(0,o.Sp)("Renderer")],h)},2909:function(e,t,i){i.d(t,{S:function(){return E},V:function(){return k}});var n=i(9008),s=i(2095),r=i(1432),o=i(2307),a=i(1233),l=i(3036),h=i(5614),d=i(5701),c=i.n(d),p=i(8236),u=i.n(p),g=i(6850),m=i.n(g),f=i(7182),v=i.n(f),w=i(9213),y=i.n(w),b=i(7729),_={};b.Z&&b.Z.locals&&(_.locals=b.Z.locals);var x,C=0,P={};P.styleTagTransform=y(),P.setAttributes=m(),P.insert=function(e,t){(t.target||document.head).appendChild(e)},P.domAPI=u(),P.insertStyleElement=v(),_.use=function(e){return P.options=e||{},C++||(x=c()(b.Z,P)),_},_.unuse=function(){C>0&&!--C&&(x(),x=null)};var S=_,M=i(1134),O=i(7162),j=i(1815);function E(){S.use(),j.Z.use()}async function k(e,t=undefined,i=[]){O.ZP.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>e.container});const d=(0,n.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),c=(0,n.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,n.getUrlQueryParam)("logo-img")&&(c.style.backgroundImage=`url(${(0,n.getUrlQueryParam)("logo-img")})`),c.onclick=()=>{window.open((0,n.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const p='<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />\n</svg>';e.container.appendChild(c),(0,O.ZP)(c,{placement:"right",content:"Powered by WebGi SDK"});const u=(0,n.createDiv)({innerHTML:p,id:"fsToggle",classList:["round-button"],addToBody:!1});u.dataset.tippyContent="Full-Screen",e.getPlugin(M.D)?.addEventListener("enter",(()=>{u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',u.dataset.tippyContent="Exit Full-Screen"})),e.getPlugin(M.D)?.addEventListener("exit",(()=>{u.innerHTML=p,u.dataset.tippyContent="Full-Screen"})),u.onclick=()=>{e.getPlugin(M.D)?.toggle(e.container)},e.container.appendChild(u),(0,O.ZP)(u,{placement:"left"});const g=(0,n.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});e.container.appendChild(g);const m=[{id:"reset-settings",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />\n</svg>',tooltip:"Reset All Settings",onclick:async()=>{if(!await e.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const t=y.map((t=>e.getPlugin(t)));for(const e of t)await(e?.resetDefaults?.())}},{id:"clear-scene",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />\n</svg>',tooltip:"Clear Scene",onclick:async()=>{await e.confirm("Clear scene: Are you sure you want to clear the scene?")&&e.scene.disposeSceneModels()}},{id:"fit-scene",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">\n    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />\n</svg>',tooltip:"Fit Object/Scene",onclick:async()=>{await e.fitToView(e.getPlugin(s.l)?.getSelectedObject())}},{id:"loop-cam-views",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />\n</svg>',tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{e.getPlugin(l.qK)&&(e.getPlugin(l.qK).viewLooping=!e.getPlugin(l.qK).viewLooping)}},{id:"play-gltf",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />\n  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n</svg>',tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{e.getPlugin(a.L)?.playPauseAnimation()}},{id:"auto-rotate-cc",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />\n</svg>',tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const t=e.scene.activeCamera.controls;t&&void 0!==t.autoRotate&&(t.autoRotate=!t.autoRotate)}},{id:"snapshot",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />\n  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />\n</svg>',tooltip:"Capture Snapshot",onclick:async()=>{const t=e.getPlugin(o.G);t?await t.downloadSnapshot():e.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />\n</svg>',tooltip:"Export GLB",onclick:async()=>{const t=e.getPlugin(r.I);t?await(t?.downloadSceneGlb()):e.console.error("AssetExporterPlugin not added")}}];for(const e of m){const t=(0,n.createDiv)({innerHTML:e.icon,id:e.id,classList:["button-bar-button","util-button"],addToBody:!1});t.dataset.tippyContent=e.tooltip,t.onclick=()=>{e.toggle&&t.classList.toggle("button-bar-selected-box"),e.onclick()},g.appendChild(t)}(0,O.XB)((0,O.ZP)(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const f=e.getPlugin(s.l);for(const[e,n]of Object.entries(t??{})){const t=i.find((t=>t.title===e));t?t.plugins.push(...n):i.push({title:e,plugins:[...n]})}let v=i[2],w=[];const y=i.reduce(((e,t)=>e.concat(t.plugins)),[]);function b(t){v=t,f&&(f.enabled=!0),w=[];for(const i of y){const s=e.getPlugin(i);if(!s?.uiConfig)continue;const r=t.plugins.includes(i);(0,n.safeSetProperty)(s.uiConfig,"hidden",!r,!0),r&&w.push(s)}for(const e of i)e.div?.classList[v!==e?"remove":"add"]("mode-button-selected","button-bar-selected");e.getPlugin(h.L).refreshPluginsEnabled()}for(const e of i){const t=(0,n.createDiv)({innerHTML:e.title,classList:["mode-button","button-bar-button"]});t.onclick=()=>{b(e)},e.div=t,d.appendChild(t)}b(i[0]),f?.addEventListener("selectedObjectChanged",(()=>{f?.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(v.title)&&b(i.find((e=>e.plugins.includes(s.l))))}))}}}]);
//# sourceMappingURL=335.0f34c67f.js.map