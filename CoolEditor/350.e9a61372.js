"use strict";(self.webpackChunkwebgi=self.webpackChunkwebgi||[]).push([[350],{1432:function(e,t,s){s.d(t,{I:function(){return m}});var r=s(3995),n=s(9008),i=s(5022);class o{async parseAsync(e,t){return new Blob([JSON.stringify(e,null,t.jsonSpaces??2)],{type:"application/json"})}}class a{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}var c=s(5152),p=s(7769);class l extends n.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find((t=>t.ext.some((t=>e.includes(t)))))}constructor(e,t={}){super(),this._processors=new i.z,this.Exporters=[{ctor:()=>new o,ext:["json"]},{ctor:()=>new a,ext:["txt","text"]},{ctor:()=>new p.n,ext:["exr"]}],this._cachedParsers=[],(0,c.$)(this,e)}async exportObject(e,t={}){if(!e?.assetType)return void console.error("Object has no asset type");e?.userData?.rootSceneModelRoot&&!1===t.viewerConfig&&(e.userData.__exportViewerConfig=!1);const s=[];"model"===e.assetType&&e.modelObject.traverse((e=>{e.userData.excludeFromExport&&e.visible&&(e.visible=!1,s.push(e))}));const r=await this._exportFile(e,t);return"model"===e.assetType&&s.forEach((e=>e.visible=!0)),e?.userData?.rootSceneModelRoot&&!1===t.viewerConfig&&delete e.userData.__exportViewerConfig,r}async _exportFile(e,t={}){let s;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const r=await this.processBeforeExport(e,t),n=t.exportExt??r?.typeExt??r?.ext;if(!r||!n)throw new Error(`Unable to preprocess before export ${n}`);const i=this._getParser(n);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const o=await i.parseAsync(r.obj,{exportExt:r.ext??n,...t});o.ext=r.ext,s=o}catch(t){return console.error("AssetExporter: Unable to Export file",e),console.error(t),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:t})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),s}_createParser(e){const t=this.Exporters.find((t=>t.ext.includes(e)));if(!t)throw new Error(`No exporter found for extension ${e}`);const s=t?.ctor(this);if(!s)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:s}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:s}),s}_getParser(e){return this._cachedParsers.find((t=>t.ext.includes(e)))?.parser??this._createParser(e)}async processBeforeExport(e,t={}){if(null!=e.assetType&&"renderTarget"!==e.assetType&&(e=await this._processors.process(e.assetType,e,t)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){this._processors?.dispose()}}var u,h=s(4821),d=s(6533),x=s(4107);!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(u||(u={}));class m extends r.Q{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:u.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new l(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(e,t)=>(t.convertMeshToIndexed&&e.modelObject?.traverse((e=>{e.geometry&&(e.geometry.attributes.index||e.setGeometry?.((0,d.aP)(e.geometry)))})),e)})}async onRemove(e){return super.onRemove(e)}async exportScene(e){return this.exporter?.exportObject(this._viewer?.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,t){const s=this._viewer?.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,t):this._viewer?.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",(e=>{"function"==typeof e.plugin?.toJSON&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")}));const t=Object.entries(e.plugins).filter((([e,t])=>"function"==typeof t?.toJSON&&!1!==t?.serializeWithViewer)).map((([e,t])=>({label:e,type:"checkbox",value:!0})));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>this._uiConfig?.uiRefresh?.("postFrame",!0)},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(u).map((([e,t])=>({label:e,value:t})))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map((e=>({label:e})))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map((e=>({type:"slider",label:e,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,e]})))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>this._uiConfig?.uiRefresh?.("postFrame",!0)},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>this._uiConfig?.uiRefresh?.("postFrame",!0)},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach((e=>{e.value=!1,e.uiRefresh?.()}))}},{type:"button",label:"Select all",value:()=>{t.forEach((e=>{e.value=!0,e.uiRefresh?.()}))}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(h.k).exportPluginPresets(t.filter((e=>!!e.value)).map((e=>(0,n.getOrCall)(e.label)||""))),null,2)],{type:"application/json"});s&&await this._downloadBlob(s,this.exportOptions.name+"."+h.k.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const t=new Blob([JSON.stringify(e.getPlugin(h.k).exportViewerConfig(!1),null,2)],{type:"application/json"});t&&await this._downloadBlob(t,this.exportOptions.name+"."+h.k.ViewerTypeSlug)}}]}]}}}m.PluginType="AssetExporterPlugin",function(e,t,s,r){var n,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i<3?n(o):i>3?n(t,s,o):n(t,s))||o);i>3&&o&&Object.defineProperty(t,s,o)}([(0,x.qC)()],m.prototype,"exportOptions",void 0)},5509:function(e,t,s){s.d(t,{K:function(){return N}});var r=s(4330),n=s(9453),i=s(2179),o=s(8570),a=s(8124),c=s(418),p=s(4722),l=s(5152),u=s(1233),h=s(1321),d=s(5220),x=s(3995),m=s(1432),f=s(4821),g=s(8505),E=s(6667),y=s(5454),w=s(2714);class b extends i.a{constructor(e){super(),this._loadedLibs=!1,e=e||{method:n.r7.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=(new r.WC).registerExtensions(n.BR).registerExtensions([_,j,S,A,M,D,P,C,U,R,L,F,B,X,G,k,I]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,dracoOptions:s,...r}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,r);await this._loadLibs();const i={...r};t&&(i.externalImagesInExtras=!0);const o=await new Promise(((t,s)=>this.parse(e,t,s,i))),a=await super.parseAsync(o,i);if(!t)return a;if(!o)throw new Error("GLTFDracoExporter: gltf is null");let c=o;const p=c.byteLength||1/0,l=await("object"!=typeof c||c.byteLength?this._io.readBinary(new Uint8Array(c)):this._io.readJSON({json:c,resources:{}}));if(l.createExtension(n.r7).setRequired(!0).setEncoderOptions({...this._encoderOptions,...s??{}}),"glb"===i.exportExt)c=await this._io.writeBinary(l),isFinite(p)&&console.log("DRACO Compression ratio: "+(c.byteLength/p).toFixed(5));else{const e=await this._io.writeJSON(l);c=e.json,Object.values(e.resources).filter((e=>e)).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),c.resources=e.resources)}c.__isGLTFOutput=!0;const u=await super.parseAsync(c,i);if(!u)throw new Error("GLTFDracoExporter: blob is null");return u.ext="glb",u.__uncompressed=a,u}}class N extends x.Q{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[f.k,m.I]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer,s=e.getManager().exporter;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");!function(e,t,s){(0,l.$)(e,t,b,(e=>{const t=(0,o.Z)()+".drc",r=e;r.loader=s.registerFile(t),r.loader.setDecoderConfig({type:"js"}),r.loader.preload(!0,!0)}))}(s,e,t)}}N.PluginType="GLTFDracoExportPlugin";class T extends r.eY{constructor(){super(...arguments),this.extensionName=a.Pd,this.parentTypes=[r.uS.SCENE],this.propertyType="ViewerJSON"}init(){}}class _ extends r.hj{constructor(){super(...arguments),this.extensionName=a.Pd,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){return this._viewerConfig={},e.jsonDoc.json.scenes?.forEach(((t,s)=>{if(t.extensions&&t.extensions[a.Pd]){const r=new T(this.document.getGraph());e.scenes[s].setExtension(a.Pd,r),this._viewerConfig=t.extensions[a.Pd]}})),this}write(e){return this.document.getRoot().listScenes().forEach((t=>{if(t.getExtension(a.Pd)){const t=e.jsonDoc.json.scenes?.[e.jsonDoc.json.scene||0];t&&Object.keys(this._viewerConfig).length>0&&(t.extensions=t.extensions||{},t.extensions[a.Pd]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}})),this}}_.EXTENSION_NAME=a.Pd;class O extends r.eY{addTexture(e,t,s,r=4369){this.setRef(e,s,{channels:r}),this.textures[e]=[t,s]}constructor(e,t,s){super(e,t),this.parentTypes=[r.uS.MATERIAL,r.uS.MESH,r.uS.NODE,r.uS.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=s}init(){}}class v extends r.hj{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,s=t.json.materials||[],n=t.json.textures||[];return s.forEach(((t,s)=>{if(t.extensions&&t.extensions[this.extensionName]){const i=new O(this.document.getGraph(),"",this.extensionName);e.materials[s].setExtension(this.extensionName,i);const o={...t.extensions[this.extensionName]};for(const[t,s]of Object.entries(o))if("number"==typeof s?.index){const a=s,c=n[a.index]?.source;if("number"!=typeof c){console.warn("GLTF Pipeline: source texture not found for texture info",a);continue}const p=e.textures[c],l=new r.lO(this.document.getGraph()),u=this.textureChannels[t]??4369;i.addTexture(t,l,p,u),e.setTextureInfo(l,a),delete o[t]}i.setExtras(o)}})),(t.json.meshes||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[this.extensionName]){const r=new O(this.document.getGraph(),"",this.extensionName);e.meshes[s].setExtension(this.extensionName,r);const n=t.extensions[this.extensionName];r.setExtras(n)}})),(t.json.nodes||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[this.extensionName]){const r=new O(this.document.getGraph(),"",this.extensionName);e.nodes[s].setExtension(this.extensionName,r);const n=t.extensions[this.extensionName];r.setExtras(n)}})),(t.json.scenes||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[this.extensionName]){const r=new O(this.document.getGraph(),"",this.extensionName);e.scenes[s].setExtension(this.extensionName,r);const n=t.extensions[this.extensionName];r.setExtras(n)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(this.extensionName);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o={...r.getExtras()};for(const[t,s]of Object.entries(r.textures)){const r=s[0],n=s[1];n&&(o[t]=e.createTextureInfoDef(n,r))}i.extensions[this.extensionName]=o}})),this.document.getRoot().listMeshes().forEach((s=>{const r=s.getExtension(this.extensionName);if(r){const n=e.meshIndexMap.get(s),i=t.json.meshes[n];i.extensions=i.extensions||{},i.extensions[this.extensionName]=r.getExtras()}})),this.document.getRoot().listNodes().forEach((s=>{const r=s.getExtension(this.extensionName);if(r){const n=e.nodeIndexMap.get(s),i=t.json.nodes[n];i.extensions=i.extensions||{},i.extensions[this.extensionName]=r.getExtras()}})),this.document.getRoot().listScenes().forEach((s=>{const r=s.getExtension(this.extensionName);if(r){const s=e.jsonDoc.json.scene||0,n=t.json.scenes[s];if(!n)return;n.extensions=n.extensions||{},n.extensions[this.extensionName]=r.getExtras()}})),this}}class S extends v{constructor(){super(...arguments),this.extensionName=S.EXTENSION_NAME,this.textureChannels={bumpTexture:r.TextureChannel.R}}}S.EXTENSION_NAME=a.pn;class A extends v{constructor(){super(...arguments),this.extensionName=A.EXTENSION_NAME,this.textureChannels={lightMapTexture:r.TextureChannel.R|r.TextureChannel.G|r.TextureChannel.B}}}A.EXTENSION_NAME=a.Eb;class M extends v{constructor(){super(...arguments),this.extensionName=M.EXTENSION_NAME,this.textureChannels={alphaTexture:r.TextureChannel.G}}}M.EXTENSION_NAME=a.Hf;class I extends v{constructor(){super(...arguments),this.extensionName=I.EXTENSION_NAME,this.textureChannels={displacementTexture:r.TextureChannel.R}}}I.EXTENSION_NAME=a.tA;class j extends v{constructor(){super(...arguments),this.extensionName=j.EXTENSION_NAME}}j.EXTENSION_NAME=c.h.DIAMOND_GLTF_EXTENSION;class D extends v{constructor(){super(...arguments),this.extensionName=D.EXTENSION_NAME}}D.EXTENSION_NAME=u.L.AnimationMarkersExtension;class P extends v{constructor(){super(...arguments),this.extensionName=P.EXTENSION_NAME,this.textureChannels={anisotropyDirection:r.TextureChannel.R|r.TextureChannel.G|r.TextureChannel.B}}}P.EXTENSION_NAME=p.$.ANISOTROPY_GLTF_EXTENSION;class C extends v{constructor(){super(...arguments),this.extensionName=C.EXTENSION_NAME,this.textureChannels={customBumpMap:r.TextureChannel.R|r.TextureChannel.G|r.TextureChannel.B}}}C.EXTENSION_NAME=E.D.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class U extends v{constructor(){super(...arguments),this.extensionName=U.EXTENSION_NAME}}U.EXTENSION_NAME=a.Tu;class R extends v{constructor(){super(...arguments),this.extensionName=R.EXTENSION_NAME}}R.EXTENSION_NAME=a.RX;class L extends v{constructor(){super(...arguments),this.extensionName=L.EXTENSION_NAME}}L.EXTENSION_NAME=a.dR;class F extends v{constructor(){super(...arguments),this.extensionName=F.EXTENSION_NAME}}F.EXTENSION_NAME=h.w.CLEARCOAT_TINT_GLTF_EXTENSION;class B extends v{constructor(){super(...arguments),this.extensionName=B.EXTENSION_NAME}}B.EXTENSION_NAME=d.w.THIN_FILM_LAYER_GLTF_EXTENSION;class G extends v{constructor(){super(...arguments),this.extensionName=G.EXTENSION_NAME}}G.EXTENSION_NAME=w.z.TRIPLANAR_GLTF_EXTENSION;class X extends v{constructor(){super(...arguments),this.extensionName=X.EXTENSION_NAME}}X.EXTENSION_NAME=y.r.SSBEVEL_GLTF_EXTENSION;class k extends v{constructor(){super(...arguments),this.extensionName=k.EXTENSION_NAME}}k.EXTENSION_NAME=g.T.NOISE_BUMP_MATERIAL_GLTF_EXTENSION},2179:function(e,t,s){s.d(t,{a:function(){return u}});var r=s(9728),n=s(9008),i=s(2988),o=s(2860),a=s(1483),c=s(4107);class p extends r.M.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new i.Wid}serializeUserData(e,t){const s=e.userData,r={};s.__disposed&&console.error("Serializing a disposed object",e),Object.entries(s).forEach((([e,t])=>{(!t||"function"==typeof t||t.isObject3D||t.isTexture||t.isMaterial||null!=t.assetType||e.startsWith("_")||"uuid"!==e&&(a.Ej.includes(e)||a.DQ.includes(e)||o.ep.includes(e)))&&(r[e]=t,delete s[e])}));const n=(0,c.HD)(s,!1);Object.entries(r).forEach((([e,t])=>{s[e]=t,delete r[e]})),e.userData=n,super.serializeUserData(e,t),e.userData=s}processObjects(e){1===e.length&&e[0]?.userData.rootSceneModelRoot?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const s=super.processMaterial(t);if(null===s)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return s;const r=JSON.stringify(this.json.materials[s]),n=JSON.parse(r);this.serializeUserData(e,n),this._invokeAll((t=>{t.writeMaterial&&t.writeMaterial(e,n)}));const i=this.json.materials.push(n)-1;return this.cache.materials.set(e,i),i}processImageBlob(e,t){if(!e)return-1;const s=this.cache,r=this.options,i=this.pending,o=this.json,a=t.image;s.images.has(a)||s.images.set(a,{});const c=s.images.get(a),p=e.type+":flipY/"+t.flipY.toString();if(void 0!==c[p])return c[p];o.images||(o.images=[]);const l={mimeType:e.type};!0===r.binary?i.push(new Promise((t=>{this.processBufferViewImage(e).then((e=>{l.bufferView=e,t()}))}))):i.push((0,n.blobToDataURL)(e).then((e=>{l.uri=e})));const u=o.images.push(l)-1;return c[p]=u,u}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,s=this.json;if(t.textures.has(e))return t.textures.get(e);const r=e.source.data,n=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const i=super.processTexture(e),o=s.textures[i];if(!o)return console.error("No texture def",i,e),i;const a=s.images?s.images[o.source]:null;if(a&&(a.extras||(a.extras={}),e.source&&(a.extras.uuid=e.source.uuid),a.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=r,e.userData.mimeType=n,!o)return console.error("textureDef is null",i,e),i;if(o.source>=0){const t=this.json.images[o.source];t.uri?console.warn("uri already set",t.uri):(t.uri=e.userData.rootPath,t.mimeType=n,t.extras||(t.extras={}),t.extras.flipY=e.flipY,t.extras.uri=e.userData.rootPath)}else o.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,n)}return o.source<0&&console.error("textureDef.source cannot be saved",o,e),i}processImage(e,t,s,r="image/png"){return e?super.processImage(e,t,s,r,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,s,r="image/png"){const n=this.cache,i=this.json;n.images.has(e)||n.images.set(e,{});const o=n.images.get(e),a=r+":flipY/"+s.toString();if(void 0!==o[a])return o[a];i.images||(i.images=[]);const c={mimeType:r,uri:t,extras:{flipY:s}},p=i.images.push(c)-1;return o[a]=p,p}}var l=s(1504);class u extends r.M{register(e){return super.register(e)}async parseAsync(e,t){if(!e)throw new Error("No object to export");const s=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise(((s,r)=>this.parse(e,s,r,t)));if(s&&"object"==typeof s&&!s.byteLength)return new Blob([JSON.stringify(s,((e,t)=>e.startsWith("__")?void 0:t),t.jsonSpaces??2)],{type:"model/gltf+json"});if(s){let e=null;if(t.encrypt)if(!t.encryptKey&&window.prompt&&(t.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),t.encryptKey){const r=await(0,n.aesGcmEncrypt)(new Uint8Array(s),t.encryptKey);e=(0,l.H2)(r,{asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}})}else console.warn("GLTF Export: encryption key not provided, skipping encryption");return e||(e=new Blob([s],{type:"model/gltf+binary"})),e}throw new Error("GLTFExporter2.parse() failed")}parse(e,t,s,r={}){const n={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!r.embedUrlImages&&r.externalImagesInExtras||!1,embedUrlImages:r.embedUrlImages??!1,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:r};return"glb"===r.exportExt&&(n.binary=!0),!1!==r.preserveUUIDs&&(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{e.uuid&&(e.userData.gltfUUID=e.uuid)})))),(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{if(e.animations)for(const t of e.animations)!1===t.__gltfExport||n.animations.includes(t)||n.animations.push(...e.animations)})))),super.parse(e,(s=>{!1!==r.preserveUUIDs&&(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{delete e.userData.gltfUUID})))),t(Object.assign(s,{__isGLTFOutput:!0}))}),s,n,new p)}}},5152:function(e,t,s){s.d(t,{$:function(){return l}});var r=s(2179),n=s(8124),i=s(4821),o=s(2988);function a(e,t=3,s){let r,n,i,o,a;const c=e.byteLength/(2*t)|0;s=s||new Uint8ClampedArray(4*c);for(let p=0;p<c;p++){r=e[p*t],n=e[p*t+1],i=e[p*t+2],o=Math.max(Math.max(r,n),i);const c=Math.ceil(Math.log2(o));a=Math.pow(2,c-8),s[4*p]=r/a|0,s[4*p+1]=n/a|0,s[4*p+2]=i/a|0,s[4*p+3]=c+128}return s}var c=s(4107),p=s(6453);function l(e,t,s=r.a,c){if(!t)return;const l=e.Exporters.findIndex((e=>e.ext.includes("gltf")||e.ext.includes("glb"))),E=[];l>=0?(E.push(...e.Exporters[l].extensions??[]),e.Exporters.splice(l,1)):(E.push(d),E.push(h),E.push(u),E.push((e=>new p.c(e))),E.push((e=>new x(e))),E.push((e=>new m(e))),E.push((e=>new f(e))),E.push((e=>new g(e)))),e.Exporters.push({ctor:()=>{const e=new s;return E.forEach((t=>e.register(t))),e.register((e=>({afterParse:s=>{if(s=Array.isArray(s)?s[0]:s,!s?.userData?.rootSceneModelRoot||!1===s?.userData?.__exportViewerConfig)return;const r=e.json.scenes[e.json.scene||0];r.extensions||(r.extensions={}),r.extensions[n.Pd]=function(e,t){const s=e.getPlugin(i.k).exportViewerConfig();t.json.textures&&t.json.samplers&&t.json.images&&s.resources.textures&&[...Object.entries(s.resources.textures)].forEach((([e,r])=>{t.json.textures.find((s=>s.extras?.uuid===e||t.json.samplers[s.sampler]?.extras?.uuid===e||t.json.images[s.source]?.extras?.t_uuid===e))&&(r.image&&s.resources.images&&s.resources.images[r.image]&&delete s.resources.images[r.image],s.resources.textures[e]={})})),t.json.materials&&s.resources.materials&&[...Object.entries(s.resources.materials)].forEach((([e,r])=>{t.json.materials.find((t=>t.extras?.uuid===e))&&(s.resources.materials[e]={})}));const r=[];Object.values(s.resources).forEach((e=>{e&&Object.values(e).forEach((e=>{e.url&&("Uint16Array"===e.url.type&&e.url.data?(e.url.data instanceof Uint16Array||(e.url.data=new Uint16Array(e.url.data)),r.push(e.url)):"Uint8Array"===e.url.type&&e.url.data&&(e.url.data instanceof Uint8Array||(e.url.data=new Uint8Array(e.url.data)),r.push(e.url)))}))}));for(const e of r){let s="application/octet-stream";if(e.mimeType&&(s=e.mimeType),t.options.exporterOptions.encodeUint16Rgbe&&"Uint16Array"===e.type&&e.width>0&&e.height>0){const t=a(e.data,4),r=new ImageData(t,e.width,e.height),n=o.PpQ.getDataURL(r,!0).split(",")[1],i=2;if(s="image/png",1===i)e.data=atob(n);else{if(2!==i)throw new Error("Invalid encoding version");e.data=Uint8Array.from(atob(n),(e=>e.charCodeAt(0)))}e.encoding="rgbe",e.encodingVersion=i}t.json.images||(t.json.images=[]);const r={mimeType:s},n=t.json.images.push(r)-1,i=e.data;r.bufferView=t.processBufferViewImageBuffer(i),e.data={image:n}}return s}(t,e),e.extensionsUsed[n.Pd]=!0}}))),c?.(e),e},ext:["gltf","glb"],extensions:E})}const u=e=>({writeNode:(t,s)=>{if(!t?.isLight)return;s.extensions||(s.extensions={});const r={};t.shadow&&(r.shadow=t.shadow.toJSON()),Object.keys(r).length>0&&(s.extensions[n.Tu]=r,e.extensionsUsed[n.Tu]=!0)}}),h=e=>({writeNode:(t,s)=>{if(!t?.isObject3D)return;s.extensions||(s.extensions={});const r={};void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),!1===t.visible&&(r.visible=!1),!1===t.frustumCulled&&(r.frustumCulled=!1),0!==t.renderOrder&&(r.renderOrder=t.renderOrder),1!==t.layers.mask&&(r.layers=t.layers.mask),!1===t.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),Object.keys(r).length>0&&(s.extensions[n.RX]=r,e.extensionsUsed[n.RX]=!0)}}),d=e=>({writeMaterial(t,s){if(!t?.isMaterial)return;s.extensions||(s.extensions={});const r={};void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.side&&t.side!==o.ehD&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.depthFunc&&(r.depthFunc=t.depthFunc),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.vertexColors&&(r.vertexColors=t.vertexColors),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.normalScale&&(r.normalScale=[t.normalScale.x,t.normalScale.y]);const i=this.materialExternalResources[t.uuid];i&&Object.entries(i).forEach((([t,s])=>{t.startsWith("_")||(s?.userData&&(s.userData.__embedUrlImagePreviews=e.options.exporterOptions?.embedUrlImagePreviews),r[t]=(0,c.HD)(s,!1,this.serializedMeta),s?.userData&&delete s.userData.__embedUrlImagePreviews)})),Object.keys(r).length>0&&(s.extensions[n.dR]=r,e.extensionsUsed[n.dR]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(t){if(this.materialExternalResources={},!e.options.externalImagesInExtras)return;const s=[];(Array.isArray(t)?t:[t]).forEach((e=>{e?.traverse((e=>{e&&e.material?.isMaterial&&s.push(e.material)}))})),s.forEach((e=>{e&&(this.materialExternalResources[e.uuid]||(this.materialExternalResources[e.uuid]={}),this.materialExternalResources[e.uuid].__materialRef=e,Object.entries(e).forEach((([t,s])=>{t.startsWith("_")||s&&s.isTexture&&s.userData.rootPath&&(s.userData.rootPath.startsWith("http")||s.userData.rootPath.startsWith("data:"))&&(e[t]=null,this.materialExternalResources[e.uuid][t]=s)})))}))},afterParse(t){const s=Object.values(this.materialExternalResources);if(s.length<1)return;s.forEach((e=>{const t=e.__materialRef;t&&(Object.entries(e).forEach((([e,s])=>{e.startsWith("_")||s&&(t[e]=s)})),delete this.materialExternalResources[t.uuid])}));const r=e.json.scenes[e.json.scene||0];r.extensions||(r.extensions={}),r.extensions[n.dR]={resources:this.serializedMeta},e.extensionsUsed[n.dR]=!0}});class x{constructor(e){this.writer=e,this.name=n.pn}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.bumpScale)return;const s=this.writer,r=s.extensionsUsed,n={};if(n.bumpScale=e.bumpScale,e.bumpMap){const t={index:s.processTexture(e.bumpMap)};s.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class m{constructor(e){this.writer=e,this.name=n.tA}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.displacementScale)return;const s=this.writer,r=s.extensionsUsed,n={};if(n.displacementScale=e.displacementScale,n.displacementBias=e.displacementBias,e.displacementMap){const t={index:s.processTexture(e.displacementMap)};s.applyTextureTransform(t,e.displacementMap),n.displacementTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class f{constructor(e){this.writer=e,this.name=n.Eb}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.lightMapIntensity)return;const s=this.writer,r=s.extensionsUsed,n={};if(n.lightMapIntensity=e.lightMapIntensity,e.lightMap){const t={index:s.processTexture(e.lightMap)};s.applyTextureTransform(t,e.lightMap),n.lightMapTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class g{constructor(e){this.writer=e,this.name=n.Hf}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const s=this.writer,r=s.extensionsUsed,n={};if(e.alphaMap){const t={index:s.processTexture(e.alphaMap)};s.applyTextureTransform(t,e.alphaMap),n.alphaTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}},5343:function(e,t,s){s.d(t,{G:function(){return a}});var r=s(2354),n=s(4217),i=s(9008),o=s(4821);class a extends i.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[o.k]}async onAdded(e){this._importer||(this._importer=new r.q(n.s,["ktx"],!1)),e.getManager()?.importer?.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&e.getManager()?.importer?.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}a.PluginType="KTXLoadPlugin"},1504:function(e,t,s){async function r(e,t){e.innerHTML=t;const s=e.getElementsByTagName("script");for(let e=0;e<s.length;e++){const t=s[e],r=n(t);let i=!1;await new Promise((e=>{r.onload=e,r.onerror=()=>{i=!0,e(void 0)}})),i||t.parentNode?.replaceChild(r,t)}}function n(e,t){(t=t??document.createElement("script")).type=e.type||"text/javascript",t.text=e.text;for(let s=0;s<e.attributes.length;s++){const r=e.attributes[s];t.setAttribute(r.name,r.value)}return t}function i(e,t=0){const s=(r=e.byteLength,4*Math.ceil(r/4));var r;if(s!==e.byteLength){const r=new Uint8Array(s);if(r.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<s;n++)r[n]=t;return r.buffer}return e}s.d(t,{H2:function(){return h},zL:function(){return r}}),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){const s=new Uint8Array(this);null==t&&(t=s.length);const r=new ArrayBuffer(t-e),n=new Uint8Array(r);for(let t=0;t<n.length;t++)n[t]=s[t+e];return r});const o=12,a=1179937895,c=2,p=8,l=1313821514,u=5130562;function h(e,t){const s=i(e),r=new DataView(new ArrayBuffer(p));r.setUint32(0,s.byteLength,!0),r.setUint32(4,u,!0);const n=i((new TextEncoder).encode(JSON.stringify(t||{})).buffer,32),h=new DataView(new ArrayBuffer(p));h.setUint32(0,n.byteLength,!0),h.setUint32(4,l,!0);const d=new ArrayBuffer(o),x=new DataView(d);x.setUint32(0,a,!0),x.setUint32(4,c,!0);const m=o+h.byteLength+n.byteLength+r.byteLength+s.byteLength;x.setUint32(8,m,!0);const f=new Blob([d,h,n,r,s],{type:"application/octet-stream"});return f.ext="glb",f}},3262:function(e,t,s){s.d(t,{J:function(){return a}});var r=s(3995),n=s(9008),i=s(706),o=s(8570);class a extends r.Q{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&(this._viewer.getPluginByType("FrameFade")?.enable(a.PluginType),this._fadeDisabled=!1));const e=(0,n.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/60);let t=e-this._lastFrameTime;this._lastFrameTime=e;const s=this._viewer.getPluginByType("Progressive")?.postFrameConvergedRecordingDelta();if(s&&s>0&&(t=s),0!==s&&(t*=1e3,!(t<=.001)&&(this._updaters.forEach((e=>{let s=t;e.time+s<0&&(s=-e.time),e.time+=s,Math.abs(s)>.001&&e.u(s)})),!this._fadeDisabled&&this.disableFrameFade))){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(a.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex((t=>t.u===e)),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=(0,o.Z)(),s={id:t,options:e,stop:()=>{this.animations[t]?._stop?this.animations[t]?._stop?.():console.warn("Animation not started")}};return this.animations[t]=s,s.promise=new Promise(((s,r)=>{const n={driver:this.defaultDriver,...e,onComplete:()=>{try{e.onComplete?.()}catch(e){return void r(e)}s()},onStop:()=>{try{e.onStop?.()}catch(e){return void r(e)}s()}},o=(0,i.j)(n);this.animations[t]._stop=o.stop,this.animations[t].options=n})).then((()=>(delete this.animations[t],t))),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}a.PluginType="PopmotionPlugin"}}]);
//# sourceMappingURL=350.e9a61372.js.map