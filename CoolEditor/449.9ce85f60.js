/*! For license information please see 449.9ce85f60.js.LICENSE.txt */
(self.webpackChunkwebgi=self.webpackChunkwebgi||[]).push([[449],{7109:function(t,e,n){"use strict";var i=n(352),s=n.n(i)()((function(t){return t[1]}));s.push([t.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),e.Z=s},5476:function(t){var e;e=function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={convertToObject:function(t){var e=t.substring(t.indexOf("{")+1).trim().slice(0,-1),n={};return e.split(";").map((function(t){if(t=t.trim()){var e=t.split(":");n[e[0].trim()]=e[1].trim()}})),n},getFromSheets:function(t){var e=document.styleSheets;for(var n in e){var s=null;try{s=e[n].rules||e[n].cssRules}catch(t){}if(s)for(var o in s)if(s[o].selectorText&&-1!=s[o].selectorText.split(",").indexOf(t))return s[o].cssText?i.convertToObject(s[o].cssText):i.convertToObject(s[o].style.cssText)}return{}},getPropertyDefault:function(t){return"timing-function"==t?"ease":"iteration-count"==t?1:"direction"==t?"normal":"fill-mode"==t?"none":null}};e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={generateId:function(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<8;++n)t+=e.charAt(Math.floor(Math.random()*e.length));return t},frameToString:function(t){var e="";for(var n in t)e+=n+":"+t[n]+";";return e},convertTimeToMs:function(t){if(!t)return 0;if("number"==typeof t)return t;var e=parseFloat(t);return-1!=t.indexOf("ms")?e:1e3*e},prefixes:["","-webkit-","-moz-","-o-"]};e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,s=(i=n(0))&&i.__esModule?i:{default:i};e.default=function t(e,n){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.styles="string"==typeof e?s.default.getFromSheets(e):e,"string"==typeof n){var i=s.default.getFromSheets(n);for(var o in this.options={},i)this.options[o.replace("animation-","")]=i[o]}else this.options="number"==typeof n?{duration:n}:n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=a(n(4)),o=a(n(1)),r=a(n(0));function a(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,s){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e.constructor===Array?this.doms=e:this.doms=[e],n.constructor===Array?this.frames=n:this.frames=[n],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},null!=i&&null!=i)if("boolean"==typeof i)this.options.instant=i;else if("number"==typeof i)this.options.count=i,"boolean"==typeof s&&(this.options.instant=s);else for(var r in i)"pauseAt"==r&&i.pauseAt.constructor!==Array?this.options[r]=[i[r]]:this.options[r]=i[r];for(var a in this.promiseSupported="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=o.default.prefixes:this.prefixes=[""],e)this.countRemainder[a]=this.options.count-1;this.options.instant&&this.play()}return i(t,[{key:"play",value:function(){var t=this;for(var e in this.clear(),this.promiseSupported&&(this.promise=new Promise((function(e){t.promiseResolve=e}))),this.doms){var n=this.makeAnimation(this.doms[e]);this.animations[e]=n.names,this.styleDoms[e]=n.styleDom,this.superSets[e]=this.makeSuperSet(this.doms[e],this.animations[e]),this.playAnimation(this.doms[e],this.superSets[e]),this.eventHandler[e]=this.handleAnimationEnd.bind(this,e),this.doms[e].addEventListener("animationend",this.eventHandler[e])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(t){if(!t){for(var e in this.doms)this.clear(e);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var n=this.styleDoms[t];for(var i in n&&n.parentNode&&n.parentNode.removeChild(n),this.superSets[t])for(var s in this.prefixes)this.doms[t].style[this.prefixes[s]+"animation-"+i]=null;for(var o in this.prefixes)this.doms[t].style[this.prefixes[o]+"animation-play-state"]=null;this.doms[t].removeEventListener("animationend",this.eventHandler[t]),this.countRemainder[t]=this.options.count-1}},{key:"replay",value:function(t){var e=this.doms[t],n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),this.doms[t].removeEventListener("animationend",this.eventHandler[t]),this.doms[t]=n,this.doms[t].addEventListener("animationend",this.eventHandler[t])}},{key:"pause",value:function(){for(var t in this.doms)this.pauseDom(this.doms[t])}},{key:"resume",value:function(){for(var t in this.doms)this.resumeDom(this.doms[t])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(t,e){var n=e.animationName,i=n.substring(n.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(i))&&this.pauseDom(this.doms[t]),i==this.frames.length&&(-1==this.countRemainder[t]?this.replay(t):this.countRemainder[t]>0?(this.countRemainder[t]--,this.replay(t)):(this.options.applyOnEnd&&this.applyOnEnd(t),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(t){for(var e in this.prefixes)t.style[this.prefixes[e]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(t){for(var e in this.prefixes)t.style[this.prefixes[e]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(t){var e=this.newFrames[this.frames.length];for(var n in e)this.doms[t].style[n]=e[n]}},{key:"makeAnimation",value:function(t){var e={},n=[],i={};for(var o in this.frames)for(var r in n.push(this.frames[o].styles),n[o])i[r]=!0;var a=window.getComputedStyle(t);for(var l in i)e[l]=a[l];n.unshift(e);for(var c=[n[0]],h=1;h<n.length;++h){var u=JSON.parse(JSON.stringify(c[h-1]));for(var d in n[h])u[d]=n[h][d];c.push(u)}return this.newFrames=c,s.default.make(c,this.prefixes)}},{key:"makeSuperSet",value:function(t,e){var n=0,i={};for(var s in this.frames)for(var a in this.frames[s].options)i[a]="";i.name="",i.duration="",i.delay="";for(var l=0;l<this.frames.length;++l){if(l)for(var c in i)i[c]+=",";var h=o.default.convertTimeToMs(this.frames[l].options.duration),u=o.default.convertTimeToMs(this.frames[l].options.delay);for(var d in l<this.options.startFrom&&(h=0,u=0),i.name+=e[l],i.duration+=h+"ms",i.delay+=n+u+"ms",i)"name"!=d&&"duration"!=d&&"delay"!=d&&(i[d]+=this.frames[l].options[d]?this.frames[l].options[d]:r.default.getPropertyDefault(d));var p=this.frames[l].options["iteration-count"];n+=h*parseInt(p||1)+u}return i}},{key:"playAnimation",value:function(t,e){for(var n in e)for(var i in this.prefixes)t.style[this.prefixes[i]+"animation-"+n]=e[n];this.options.pauseAt.includes(0)&&this.pauseDom(t)}}]),t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,s=(i=n(1))&&i.__esModule?i:{default:i},o={make:function(t,e){for(var n=[],i="",r="atr-"+s.default.generateId(),a=document.createElement("style"),l=0;l<t.length-1;++l)n.push(r+"-"+(l+1)),i+=o.makeFromTwoFrames(t[l],t[l+1],n[l],e);return a.innerHTML=i,a.class="foo",document.getElementsByTagName("head")[0].appendChild(a),{names:n,styleDom:a}},makeFromTwoFrames:function(t,e,n,i){var o="";for(var r in i)o+="@"+i[r]+"keyframes "+n+" {",o+="0%",o+="{"+s.default.frameToString(t)+"}",o+="100%",o+="{"+s.default.frameToString(e)+"}",o+="}";return o}};e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Queue=e.Frame=void 0;var i=o(n(2)),s=o(n(3));function o(t){return t&&t.__esModule?t:{default:t}}e.Frame=i.default,e.Queue=s.default}])},t.exports=e()},3653:function(t,e,n){"use strict";n.d(e,{AO:function(){return o},Ab:function(){return ie},JO:function(){return se},Qx:function(){return $t},YD:function(){return b},_f:function(){return f},aL:function(){return ne},np:function(){return he},q3:function(){return Bi},uT:function(){return P},xu:function(){return S}});class i{constructor(t){void 0===t&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z}getTrace(t){void 0===t&&(t=new o);const e=this.elements;return t.x=e[0],t.y=e[4],t.z=e[8],t}vmult(t,e){void 0===e&&(e=new o);const n=this.elements,i=t.x,s=t.y,r=t.z;return e.x=n[0]*i+n[1]*s+n[2]*r,e.y=n[3]*i+n[4]*s+n[5]*r,e.z=n[6]*i+n[7]*s+n[8]*r,e}smult(t){for(let e=0;e<this.elements.length;e++)this.elements[e]*=t}mmult(t,e){void 0===e&&(e=new i);const n=this.elements,s=t.elements,o=e.elements,r=n[0],a=n[1],l=n[2],c=n[3],h=n[4],u=n[5],d=n[6],p=n[7],f=n[8],y=s[0],m=s[1],g=s[2],w=s[3],v=s[4],b=s[5],x=s[6],A=s[7],E=s[8];return o[0]=r*y+a*w+l*x,o[1]=r*m+a*v+l*A,o[2]=r*g+a*b+l*E,o[3]=c*y+h*w+u*x,o[4]=c*m+h*v+u*A,o[5]=c*g+h*b+u*E,o[6]=d*y+p*w+f*x,o[7]=d*m+p*v+f*A,o[8]=d*g+p*b+f*E,e}scale(t,e){void 0===e&&(e=new i);const n=this.elements,s=e.elements;for(let e=0;3!==e;e++)s[3*e+0]=t.x*n[3*e+0],s[3*e+1]=t.y*n[3*e+1],s[3*e+2]=t.z*n[3*e+2];return e}solve(t,e){void 0===e&&(e=new o);const n=[];let i,s;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(s=0;s<3;s++)n[i+4*s]=this.elements[i+3*s];n[3]=t.x,n[7]=t.y,n[11]=t.z;let r=3;const a=r;let l,c;do{if(i=a-r,0===n[i+4*i])for(s=i+1;s<a;s++)if(0!==n[i+4*s]){l=4;do{c=4-l,n[c+4*i]+=n[c+4*s]}while(--l);break}if(0!==n[i+4*i])for(s=i+1;s<a;s++){const t=n[i+4*s]/n[i+4*i];l=4;do{c=4-l,n[c+4*s]=c<=i?0:n[c+4*s]-n[c+4*i]*t}while(--l)}}while(--r);if(e.z=n[11]/n[10],e.y=(n[7]-n[6]*e.z)/n[5],e.x=(n[3]-n[2]*e.z-n[1]*e.y)/n[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw`Could not solve equation! Got x=[${e.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return e}e(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n}copy(t){for(let e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this}toString(){let t="";for(let e=0;e<9;e++)t+=this.elements[e]+",";return t}reverse(t){void 0===t&&(t=new i);const e=s;let n,o;for(n=0;n<3;n++)for(o=0;o<3;o++)e[n+6*o]=this.elements[n+3*o];e[3]=1,e[9]=0,e[15]=0,e[4]=0,e[10]=1,e[16]=0,e[5]=0,e[11]=0,e[17]=1;let r=3;const a=r;let l,c;do{if(n=a-r,0===e[n+6*n])for(o=n+1;o<a;o++)if(0!==e[n+6*o]){l=6;do{c=6-l,e[c+6*n]+=e[c+6*o]}while(--l);break}if(0!==e[n+6*n])for(o=n+1;o<a;o++){const t=e[n+6*o]/e[n+6*n];l=6;do{c=6-l,e[c+6*o]=c<=n?0:e[c+6*o]-e[c+6*n]*t}while(--l)}}while(--r);n=2;do{o=n-1;do{const t=e[n+6*o]/e[n+6*n];l=6;do{c=6-l,e[c+6*o]=e[c+6*o]-e[c+6*n]*t}while(--l)}while(o--)}while(--n);n=2;do{const t=1/e[n+6*n];l=6;do{c=6-l,e[c+6*n]=e[c+6*n]*t}while(--l)}while(n--);n=2;do{o=2;do{if(c=e[3+o+6*n],isNaN(c)||c===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(n,o,c)}while(o--)}while(n--);return t}setRotationFromQuaternion(t){const e=t.x,n=t.y,i=t.z,s=t.w,o=e+e,r=n+n,a=i+i,l=e*o,c=e*r,h=e*a,u=n*r,d=n*a,p=i*a,f=s*o,y=s*r,m=s*a,g=this.elements;return g[0]=1-(u+p),g[1]=c-m,g[2]=h+y,g[3]=c+m,g[4]=1-(l+p),g[5]=d-f,g[6]=h-y,g[7]=d+f,g[8]=1-(l+u),this}transpose(t){void 0===t&&(t=new i);const e=this.elements,n=t.elements;let s;return n[0]=e[0],n[4]=e[4],n[8]=e[8],s=e[1],n[1]=e[3],n[3]=s,s=e[2],n[2]=e[6],n[6]=s,s=e[5],n[5]=e[7],n[7]=s,t}}const s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class o{constructor(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}cross(t,e){void 0===e&&(e=new o);const n=t.x,i=t.y,s=t.z,r=this.x,a=this.y,l=this.z;return e.x=a*s-l*i,e.y=l*n-r*s,e.z=r*i-a*n,e}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(t,e){if(!e)return new o(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z}vsub(t,e){if(!e)return new o(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z}crossmat(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,e=this.y,n=this.z,i=Math.sqrt(t*t+e*e+n*n);if(i>0){const t=1/i;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return i}unit(t){void 0===t&&(t=new o);const e=this.x,n=this.y,i=this.z;let s=Math.sqrt(e*e+n*n+i*i);return s>0?(s=1/s,t.x=e*s,t.y=n*s,t.z=i*s):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)}lengthSquared(){return this.dot(this)}distanceTo(t){const e=this.x,n=this.y,i=this.z,s=t.x,o=t.y,r=t.z;return Math.sqrt((s-e)*(s-e)+(o-n)*(o-n)+(r-i)*(r-i))}distanceSquared(t){const e=this.x,n=this.y,i=this.z,s=t.x,o=t.y,r=t.z;return(s-e)*(s-e)+(o-n)*(o-n)+(r-i)*(r-i)}scale(t,e){void 0===e&&(e=new o);const n=this.x,i=this.y,s=this.z;return e.x=t*n,e.y=t*i,e.z=t*s,e}vmul(t,e){return void 0===e&&(e=new o),e.x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e}addScaledVector(t,e,n){return void 0===n&&(n=new o),n.x=this.x+t*e.x,n.y=this.y+t*e.y,n.z=this.z+t*e.z,n}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(t){return void 0===t&&(t=new o),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,e){const n=this.length();if(n>0){const i=r,s=1/n;i.set(this.x*s,this.y*s,this.z*s);const o=a;Math.abs(i.x)<.9?(o.set(1,0,0),i.cross(o,t)):(o.set(0,1,0),i.cross(o,t)),i.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,e,n){const i=this.x,s=this.y,o=this.z;n.x=i+(t.x-i)*e,n.y=s+(t.y-s)*e,n.z=o+(t.z-o)*e}almostEquals(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)}almostZero(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,e){return this.negate(l),l.almostEquals(t,e)}clone(){return new o(this.x,this.y,this.z)}}o.ZERO=new o(0,0,0),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1);const r=new o,a=new o,l=new o;class c{constructor(t){void 0===t&&(t={}),this.lowerBound=new o,this.upperBound=new o,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,e,n,i){const s=this.lowerBound,o=this.upperBound,r=n;s.copy(t[0]),r&&r.vmult(s,s),o.copy(s);for(let e=1;e<t.length;e++){let n=t[e];r&&(r.vmult(n,h),n=h),n.x>o.x&&(o.x=n.x),n.x<s.x&&(s.x=n.x),n.y>o.y&&(o.y=n.y),n.y<s.y&&(s.y=n.y),n.z>o.z&&(o.z=n.z),n.z<s.z&&(s.z=n.z)}return e&&(e.vadd(s,s),e.vadd(o,o)),i&&(s.x-=i,s.y-=i,s.z-=i,o.x+=i,o.y+=i,o.z+=i),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return(new c).copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const e=this.lowerBound,n=this.upperBound,i=t.lowerBound,s=t.upperBound,o=i.x<=n.x&&n.x<=s.x||e.x<=s.x&&s.x<=n.x,r=i.y<=n.y&&n.y<=s.y||e.y<=s.y&&s.y<=n.y,a=i.z<=n.z&&n.z<=s.z||e.z<=s.z&&s.z<=n.z;return o&&r&&a}volume(){const t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)}contains(t){const e=this.lowerBound,n=this.upperBound,i=t.lowerBound,s=t.upperBound;return e.x<=i.x&&n.x>=s.x&&e.y<=i.y&&n.y>=s.y&&e.z<=i.z&&n.z>=s.z}getCorners(t,e,n,i,s,o,r,a){const l=this.lowerBound,c=this.upperBound;t.copy(l),e.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),i.set(l.x,c.y,c.z),s.set(c.x,l.y,c.z),o.set(l.x,c.y,l.z),r.set(l.x,l.y,c.z),a.copy(c)}toLocalFrame(t,e){const n=u,i=n[0],s=n[1],o=n[2],r=n[3],a=n[4],l=n[5],c=n[6],h=n[7];this.getCorners(i,s,o,r,a,l,c,h);for(let e=0;8!==e;e++){const i=n[e];t.pointToLocal(i,i)}return e.setFromPoints(n)}toWorldFrame(t,e){const n=u,i=n[0],s=n[1],o=n[2],r=n[3],a=n[4],l=n[5],c=n[6],h=n[7];this.getCorners(i,s,o,r,a,l,c,h);for(let e=0;8!==e;e++){const i=n[e];t.pointToWorld(i,i)}return e.setFromPoints(n)}overlapsRay(t){const{direction:e,from:n}=t,i=1/e.x,s=1/e.y,o=1/e.z,r=(this.lowerBound.x-n.x)*i,a=(this.upperBound.x-n.x)*i,l=(this.lowerBound.y-n.y)*s,c=(this.upperBound.y-n.y)*s,h=(this.lowerBound.z-n.z)*o,u=(this.upperBound.z-n.z)*o,d=Math.max(Math.max(Math.min(r,a),Math.min(l,c)),Math.min(h,u)),p=Math.min(Math.min(Math.max(r,a),Math.max(l,c)),Math.max(h,u));return!(p<0||d>p)}}const h=new o,u=[new o,new o,new o,new o,new o,new o,new o,new o];class d{constructor(){this.matrix=[]}get(t,e){let{index:n}=t,{index:i}=e;if(i>n){const t=i;i=n,n=t}return this.matrix[(n*(n+1)>>1)+i-1]}set(t,e,n){let{index:i}=t,{index:s}=e;if(s>i){const t=s;s=i,i=t}this.matrix[(i*(i+1)>>1)+s-1]=n?1:0}reset(){for(let t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0}setNumObjects(t){this.matrix.length=t*(t-1)>>1}}class p{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[t]&&(n[t]=[]),n[t].includes(e)||n[t].push(e),this}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[t]||!n[t].includes(e))}hasAnyEventListener(t){return void 0!==this._listeners&&void 0!==this._listeners[t]}removeEventListener(t,e){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[t])return this;const i=n[t].indexOf(e);return-1!==i&&n[t].splice(i,1),this}dispatchEvent(t){if(void 0===this._listeners)return this;const e=this._listeners[t.type];if(void 0!==e){t.target=this;for(let n=0,i=e.length;n<i;n++)e[n].call(this,t)}return this}}class f{constructor(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=t,this.y=e,this.z=n,this.w=i}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,e){const n=Math.sin(.5*e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e),this}toAxisAngle(t){void 0===t&&(t=new o),this.normalize();const e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]}setFromVectors(t,e){if(t.isAntiparallelTo(e)){const e=y,n=m;t.tangents(e,n),this.setFromAxisAngle(e,Math.PI)}else{const n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(t.length()**2*e.length()**2)+t.dot(e),this.normalize()}return this}mult(t,e){void 0===e&&(e=new f);const n=this.x,i=this.y,s=this.z,o=this.w,r=t.x,a=t.y,l=t.z,c=t.w;return e.x=n*c+o*r+i*l-s*a,e.y=i*c+o*a+s*r-n*l,e.z=s*c+o*l+n*a-i*r,e.w=o*c-n*r-i*a-s*l,e}inverse(t){void 0===t&&(t=new f);const e=this.x,n=this.y,i=this.z,s=this.w;this.conjugate(t);const o=1/(e*e+n*n+i*i+s*s);return t.x*=o,t.y*=o,t.z*=o,t.w*=o,t}conjugate(t){return void 0===t&&(t=new f),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,e){void 0===e&&(e=new o);const n=t.x,i=t.y,s=t.z,r=this.x,a=this.y,l=this.z,c=this.w,h=c*n+a*s-l*i,u=c*i+l*n-r*s,d=c*s+r*i-a*n,p=-r*n-a*i-l*s;return e.x=h*c+p*-r+u*-l-d*-a,e.y=u*c+p*-a+d*-r-h*-l,e.z=d*c+p*-l+h*-a-u*-r,e}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,e){let n,i,s;void 0===e&&(e="YZX");const o=this.x,r=this.y,a=this.z,l=this.w;if("YZX"!==e)throw new Error(`Euler order ${e} not supported yet.`);{const t=o*r+a*l;if(t>.499&&(n=2*Math.atan2(o,l),i=Math.PI/2,s=0),t<-.499&&(n=-2*Math.atan2(o,l),i=-Math.PI/2,s=0),void 0===n){const e=o*o,c=r*r,h=a*a;n=Math.atan2(2*r*l-2*o*a,1-2*c-2*h),i=Math.asin(2*t),s=Math.atan2(2*o*l-2*r*a,1-2*e-2*h)}}t.y=n,t.z=i,t.x=s}setFromEuler(t,e,n,i){void 0===i&&(i="XYZ");const s=Math.cos(t/2),o=Math.cos(e/2),r=Math.cos(n/2),a=Math.sin(t/2),l=Math.sin(e/2),c=Math.sin(n/2);return"XYZ"===i?(this.x=a*o*r+s*l*c,this.y=s*l*r-a*o*c,this.z=s*o*c+a*l*r,this.w=s*o*r-a*l*c):"YXZ"===i?(this.x=a*o*r+s*l*c,this.y=s*l*r-a*o*c,this.z=s*o*c-a*l*r,this.w=s*o*r+a*l*c):"ZXY"===i?(this.x=a*o*r-s*l*c,this.y=s*l*r+a*o*c,this.z=s*o*c+a*l*r,this.w=s*o*r-a*l*c):"ZYX"===i?(this.x=a*o*r-s*l*c,this.y=s*l*r+a*o*c,this.z=s*o*c-a*l*r,this.w=s*o*r+a*l*c):"YZX"===i?(this.x=a*o*r+s*l*c,this.y=s*l*r+a*o*c,this.z=s*o*c-a*l*r,this.w=s*o*r-a*l*c):"XZY"===i&&(this.x=a*o*r-s*l*c,this.y=s*l*r-a*o*c,this.z=s*o*c+a*l*r,this.w=s*o*r+a*l*c),this}clone(){return new f(this.x,this.y,this.z,this.w)}slerp(t,e,n){void 0===n&&(n=new f);const i=this.x,s=this.y,o=this.z,r=this.w;let a,l,c,h,u,d=t.x,p=t.y,y=t.z,m=t.w;return l=i*d+s*p+o*y+r*m,l<0&&(l=-l,d=-d,p=-p,y=-y,m=-m),1-l>1e-6?(a=Math.acos(l),c=Math.sin(a),h=Math.sin((1-e)*a)/c,u=Math.sin(e*a)/c):(h=1-e,u=e),n.x=h*i+u*d,n.y=h*s+u*p,n.z=h*o+u*y,n.w=h*r+u*m,n}integrate(t,e,n,i){void 0===i&&(i=new f);const s=t.x*n.x,o=t.y*n.y,r=t.z*n.z,a=this.x,l=this.y,c=this.z,h=this.w,u=.5*e;return i.x+=u*(s*h+o*c-r*l),i.y+=u*(o*h+r*a-s*c),i.z+=u*(r*h+s*l-o*a),i.w+=u*(-s*a-o*l-r*c),i}}const y=new o,m=new o;class g{constructor(t){void 0===t&&(t={}),this.id=g.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,e){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,e,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}g.idCounter=0,g.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class w{constructor(t){void 0===t&&(t={}),this.position=new o,this.quaternion=new f,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,e){return w.pointToLocalFrame(this.position,this.quaternion,t,e)}pointToWorld(t,e){return w.pointToWorldFrame(this.position,this.quaternion,t,e)}vectorToWorldFrame(t,e){return void 0===e&&(e=new o),this.quaternion.vmult(t,e),e}static pointToLocalFrame(t,e,n,i){return void 0===i&&(i=new o),n.vsub(t,i),e.conjugate(v),v.vmult(i,i),i}static pointToWorldFrame(t,e,n,i){return void 0===i&&(i=new o),e.vmult(n,i),i.vadd(t,i),i}static vectorToWorldFrame(t,e,n){return void 0===n&&(n=new o),t.vmult(e,n),n}static vectorToLocalFrame(t,e,n,i){return void 0===i&&(i=new o),e.w*=-1,e.vmult(n,i),e.w*=-1,i}}const v=new f;class b extends g{constructor(t){void 0===t&&(t={});const{vertices:e=[],faces:n=[],normals:i=[],axes:s,boundingSphereRadius:o}=t;super({type:g.types.CONVEXPOLYHEDRON}),this.vertices=e,this.faces=n,this.faceNormals=i,0===this.faceNormals.length&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=s?s.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const t=this.faces,e=this.vertices,n=this.uniqueEdges;n.length=0;const i=new o;for(let s=0;s!==t.length;s++){const o=t[s],r=o.length;for(let t=0;t!==r;t++){const s=(t+1)%r;e[o[t]].vsub(e[o[s]],i),i.normalize();let a=!1;for(let t=0;t!==n.length;t++)if(n[t].almostEquals(i)||n[t].almostEquals(i)){a=!0;break}a||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let t=0;t<this.faces.length;t++){for(let e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error(`Vertex ${this.faces[t][e]} not found!`);const e=this.faceNormals[t]||new o;this.getFaceNormal(t,e),e.negate(e),this.faceNormals[t]=e;const n=this.vertices[this.faces[t][0]];if(e.dot(n)<0){console.error(`.faceNormals[${t}] = Vec3(${e.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let e=0;e<this.faces[t].length;e++)console.warn(`.vertices[${this.faces[t][e]}] = Vec3(${this.vertices[this.faces[t][e]].toString()})`)}}}getFaceNormal(t,e){const n=this.faces[t],i=this.vertices[n[0]],s=this.vertices[n[1]],o=this.vertices[n[2]];b.computeNormal(i,s,o,e)}static computeNormal(t,e,n,i){const s=new o,r=new o;e.vsub(t,r),n.vsub(e,s),s.cross(r,i),i.isZero()||i.normalize()}clipAgainstHull(t,e,n,i,s,r,a,l,c){const h=new o;let u=-1,d=-Number.MAX_VALUE;for(let t=0;t<n.faces.length;t++){h.copy(n.faceNormals[t]),s.vmult(h,h);const e=h.dot(r);e>d&&(d=e,u=t)}const p=[];for(let t=0;t<n.faces[u].length;t++){const e=n.vertices[n.faces[u][t]],r=new o;r.copy(e),s.vmult(r,r),i.vadd(r,r),p.push(r)}u>=0&&this.clipFaceAgainstHull(r,t,e,p,a,l,c)}findSeparatingAxis(t,e,n,i,s,r,a,l){const c=new o,h=new o,u=new o,d=new o,p=new o,f=new o;let y=Number.MAX_VALUE;const m=this;if(m.uniqueAxes)for(let o=0;o!==m.uniqueAxes.length;o++){n.vmult(m.uniqueAxes[o],c);const a=m.testSepAxis(c,t,e,n,i,s);if(!1===a)return!1;a<y&&(y=a,r.copy(c))}else{const o=a?a.length:m.faces.length;for(let l=0;l<o;l++){const o=a?a[l]:l;c.copy(m.faceNormals[o]),n.vmult(c,c);const h=m.testSepAxis(c,t,e,n,i,s);if(!1===h)return!1;h<y&&(y=h,r.copy(c))}}if(t.uniqueAxes)for(let o=0;o!==t.uniqueAxes.length;o++){s.vmult(t.uniqueAxes[o],h);const a=m.testSepAxis(h,t,e,n,i,s);if(!1===a)return!1;a<y&&(y=a,r.copy(h))}else{const o=l?l.length:t.faces.length;for(let a=0;a<o;a++){const o=l?l[a]:a;h.copy(t.faceNormals[o]),s.vmult(h,h);const c=m.testSepAxis(h,t,e,n,i,s);if(!1===c)return!1;c<y&&(y=c,r.copy(h))}}for(let o=0;o!==m.uniqueEdges.length;o++){n.vmult(m.uniqueEdges[o],d);for(let o=0;o!==t.uniqueEdges.length;o++)if(s.vmult(t.uniqueEdges[o],p),d.cross(p,f),!f.almostZero()){f.normalize();const o=m.testSepAxis(f,t,e,n,i,s);if(!1===o)return!1;o<y&&(y=o,r.copy(f))}}return i.vsub(e,u),u.dot(r)>0&&r.negate(r),!0}testSepAxis(t,e,n,i,s,o){b.project(this,t,n,i,x),b.project(e,t,s,o,A);const r=x[0],a=x[1],l=A[0],c=A[1];if(r<c||l<a)return!1;const h=r-c,u=l-a;return h<u?h:u}calculateLocalInertia(t,e){const n=new o,i=new o;this.computeLocalAABB(i,n);const s=n.x-i.x,r=n.y-i.y,a=n.z-i.z;e.x=1/12*t*(2*r*2*r+2*a*2*a),e.y=1/12*t*(2*s*2*s+2*a*2*a),e.z=1/12*t*(2*r*2*r+2*s*2*s)}getPlaneConstantOfFace(t){const e=this.faces[t],n=this.faceNormals[t],i=this.vertices[e[0]];return-n.dot(i)}clipFaceAgainstHull(t,e,n,i,s,r,a){const l=new o,c=new o,h=new o,u=new o,d=new o,p=new o,f=new o,y=new o,m=this,g=i,w=[];let v=-1,b=Number.MAX_VALUE;for(let e=0;e<m.faces.length;e++){l.copy(m.faceNormals[e]),n.vmult(l,l);const i=l.dot(t);i<b&&(b=i,v=e)}if(v<0)return;const x=m.faces[v];x.connectedFaces=[];for(let t=0;t<m.faces.length;t++)for(let e=0;e<m.faces[t].length;e++)-1!==x.indexOf(m.faces[t][e])&&t!==v&&-1===x.connectedFaces.indexOf(t)&&x.connectedFaces.push(t);const A=x.length;for(let t=0;t<A;t++){const i=m.vertices[x[t]],s=m.vertices[x[(t+1)%A]];i.vsub(s,c),h.copy(c),n.vmult(h,h),e.vadd(h,h),u.copy(this.faceNormals[v]),n.vmult(u,u),e.vadd(u,u),h.cross(u,d),d.negate(d),p.copy(i),n.vmult(p,p),e.vadd(p,p);const o=x.connectedFaces[t];f.copy(this.faceNormals[o]);const r=this.getPlaneConstantOfFace(o);y.copy(f),n.vmult(y,y);const a=r-y.dot(e);for(this.clipFaceAgainstPlane(g,w,y,a);g.length;)g.shift();for(;w.length;)g.push(w.shift())}f.copy(this.faceNormals[v]);const E=this.getPlaneConstantOfFace(v);y.copy(f),n.vmult(y,y);const B=E-y.dot(e);for(let t=0;t<g.length;t++){let e=y.dot(g[t])+B;if(e<=s&&(console.log(`clamped: depth=${e} to minDist=${s}`),e=s),e<=r){const n=g[t];if(e<=1e-6){const t={point:n,normal:y,depth:e};a.push(t)}}}}clipFaceAgainstPlane(t,e,n,i){let s,r;const a=t.length;if(a<2)return e;let l=t[t.length-1],c=t[0];s=n.dot(l)+i;for(let h=0;h<a;h++){if(c=t[h],r=n.dot(c)+i,s<0)if(r<0){const t=new o;t.copy(c),e.push(t)}else{const t=new o;l.lerp(c,s/(s-r),t),e.push(t)}else if(r<0){const t=new o;l.lerp(c,s/(s-r),t),e.push(t),e.push(c)}l=c,s=r}return e}computeWorldVertices(t,e){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new o);const n=this.vertices,i=this.worldVertices;for(let s=0;s!==this.vertices.length;s++)e.vmult(n[s],i[s]),t.vadd(i[s],i[s]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(t,e){const n=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const s=n[i];s.x<t.x?t.x=s.x:s.x>e.x&&(e.x=s.x),s.y<t.y?t.y=s.y:s.y>e.y&&(e.y=s.y),s.z<t.z?t.z=s.z:s.z>e.z&&(e.z=s.z)}}computeWorldFaceNormals(t){const e=this.faceNormals.length;for(;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new o);const n=this.faceNormals,i=this.worldFaceNormals;for(let s=0;s!==e;s++)t.vmult(n[s],i[s]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let t=0;const e=this.vertices;for(let n=0;n!==e.length;n++){const i=e[n].lengthSquared();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,i){const s=this.vertices;let r,a,l,c,h,u,d=new o;for(let n=0;n<s.length;n++){d.copy(s[n]),e.vmult(d,d),t.vadd(d,d);const i=d;(void 0===r||i.x<r)&&(r=i.x),(void 0===c||i.x>c)&&(c=i.x),(void 0===a||i.y<a)&&(a=i.y),(void 0===h||i.y>h)&&(h=i.y),(void 0===l||i.z<l)&&(l=i.z),(void 0===u||i.z>u)&&(u=i.z)}n.set(r,a,l),i.set(c,h,u)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(t){void 0===t&&(t=new o);const e=this.vertices;for(let n=0;n<e.length;n++)t.vadd(e[n],t);return t.scale(1/e.length,t),t}transformAllPoints(t,e){const n=this.vertices.length,i=this.vertices;if(e){for(let t=0;t<n;t++){const n=i[t];e.vmult(n,n)}for(let t=0;t<this.faceNormals.length;t++){const n=this.faceNormals[t];e.vmult(n,n)}}if(t)for(let e=0;e<n;e++){const n=i[e];n.vadd(t,n)}}pointIsInside(t){const e=this.vertices,n=this.faces,i=this.faceNormals,s=new o;this.getAveragePointLocal(s);for(let r=0;r<this.faces.length;r++){let a=i[r];const l=e[n[r][0]],c=new o;t.vsub(l,c);const h=a.dot(c),u=new o;s.vsub(l,u);const d=a.dot(u);if(h<0&&d>0||h>0&&d<0)return!1}return-1}static project(t,e,n,i,s){const o=t.vertices.length,r=E;let a=0,l=0;const c=B,h=t.vertices;c.setZero(),w.vectorToLocalFrame(n,i,e,r),w.pointToLocalFrame(n,i,c,c);const u=c.dot(r);l=a=h[0].dot(r);for(let t=1;t<o;t++){const e=h[t].dot(r);e>a&&(a=e),e<l&&(l=e)}if(l-=u,a-=u,l>a){const t=l;l=a,a=t}s[0]=a,s[1]=l}}const x=[],A=[],E=(new o,new o),B=new o;class S extends g{constructor(t){super({type:g.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,i=o,s=[new i(-t,-e,-n),new i(t,-e,-n),new i(t,e,-n),new i(-t,e,-n),new i(-t,-e,n),new i(t,-e,n),new i(t,e,n),new i(-t,e,n)],r=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],a=new b({vertices:s,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:r});this.convexPolyhedronRepresentation=a,a.material=this.material}calculateLocalInertia(t,e){return void 0===e&&(e=new o),S.calculateInertia(this.halfExtents,t,e),e}static calculateInertia(t,e,n){const i=t;n.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(t,e){const n=t,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==e)for(let t=0;t!==n.length;t++)e.vmult(n[t],n[t]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(t,e,n){const i=this.halfExtents,s=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let i=0;i<s.length;i++)T.set(s[i][0],s[i][1],s[i][2]),e.vmult(T,T),t.vadd(T,T),n(T.x,T.y,T.z)}calculateWorldAABB(t,e,n,i){const s=this.halfExtents;C[0].set(s.x,s.y,s.z),C[1].set(-s.x,s.y,s.z),C[2].set(-s.x,-s.y,s.z),C[3].set(-s.x,-s.y,-s.z),C[4].set(s.x,-s.y,-s.z),C[5].set(s.x,s.y,-s.z),C[6].set(-s.x,s.y,-s.z),C[7].set(s.x,-s.y,s.z);const o=C[0];e.vmult(o,o),t.vadd(o,o),i.copy(o),n.copy(o);for(let s=1;s<8;s++){const o=C[s];e.vmult(o,o),t.vadd(o,o);const r=o.x,a=o.y,l=o.z;r>i.x&&(i.x=r),a>i.y&&(i.y=a),l>i.z&&(i.z=l),r<n.x&&(n.x=r),a<n.y&&(n.y=a),l<n.z&&(n.z=l)}}}const T=new o,C=[new o,new o,new o,new o,new o,new o,new o,new o];class P extends p{constructor(t){void 0===t&&(t={}),super(),this.id=P.idCounter++,this.index=-1,this.world=null,this.vlambda=new o,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof t.collisionResponse||t.collisionResponse,this.position=new o,this.previousPosition=new o,this.interpolatedPosition=new o,this.initPosition=new o,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new o,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new o,this.force=new o;const e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?P.STATIC:P.DYNAMIC,typeof t.type==typeof P.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=P.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new o,this.quaternion=new f,this.initQuaternion=new f,this.previousQuaternion=new f,this.interpolatedQuaternion=new f,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new o,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new o,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new o,this.invInertia=new o,this.invInertiaWorld=new i,this.invMassSolve=0,this.invInertiaSolve=new o,this.invInertiaWorldSolve=new i,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.linearFactor=new o(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new o(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new c,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new o,this.isTrigger=Boolean(t.isTrigger),t.shape&&this.addShape(t.shape),this.updateMassProperties()}wakeUp(){const t=this.sleepState;this.sleepState=P.AWAKE,this.wakeUpAfterNarrowphase=!1,t===P.SLEEPING&&this.dispatchEvent(P.wakeupEvent)}sleep(){this.sleepState=P.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(t){if(this.allowSleep){const e=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;e===P.AWAKE&&n<i?(this.sleepState=P.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(P.sleepyEvent)):e===P.SLEEPY&&n>i?this.wakeUp():e===P.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(P.sleepEvent))}}updateSolveMassProperties(){this.sleepState===P.SLEEPING||this.type===P.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(t,e){return void 0===e&&(e=new o),t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e}vectorToLocalFrame(t,e){return void 0===e&&(e=new o),this.quaternion.conjugate().vmult(t,e),e}pointToWorldFrame(t,e){return void 0===e&&(e=new o),this.quaternion.vmult(t,e),e.vadd(this.position,e),e}vectorToWorldFrame(t,e){return void 0===e&&(e=new o),this.quaternion.vmult(t,e),e}addShape(t,e,n){const i=new o,s=new f;return e&&i.copy(e),n&&s.copy(n),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this}removeShape(t){const e=this.shapes.indexOf(t);return-1===e?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeOrientations.splice(e,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=null,this)}updateBoundingRadius(){const t=this.shapes,e=this.shapeOffsets,n=t.length;let i=0;for(let s=0;s!==n;s++){const n=t[s];n.updateBoundingSphereRadius();const o=e[s].length(),r=n.boundingSphereRadius;o+r>i&&(i=o+r)}this.boundingRadius=i}updateAABB(){const t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,i=t.length,s=z,o=M,r=this.quaternion,a=this.aabb,l=k;for(let c=0;c!==i;c++){const i=t[c];r.vmult(e[c],s),s.vadd(this.position,s),r.mult(n[c],o),i.calculateWorldAABB(s,o,l.lowerBound,l.upperBound),0===c?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(t){const e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){const t=I,n=j;t.setRotationFromQuaternion(this.quaternion),t.transpose(n),t.scale(e,t),t.mmult(n,this.invInertiaWorld)}}applyForce(t,e){if(void 0===e&&(e=new o),this.type!==P.DYNAMIC)return;this.sleepState===P.SLEEPING&&this.wakeUp();const n=F;e.cross(t,n),this.force.vadd(t,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(t,e){if(void 0===e&&(e=new o),this.type!==P.DYNAMIC)return;const n=N,i=L;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,i),this.applyForce(n,i)}applyTorque(t){this.type===P.DYNAMIC&&(this.sleepState===P.SLEEPING&&this.wakeUp(),this.torque.vadd(t,this.torque))}applyImpulse(t,e){if(void 0===e&&(e=new o),this.type!==P.DYNAMIC)return;this.sleepState===P.SLEEPING&&this.wakeUp();const n=e,i=R;i.copy(t),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const s=O;n.cross(t,s),this.invInertiaWorld.vmult(s,s),this.angularVelocity.vadd(s,this.angularVelocity)}applyLocalImpulse(t,e){if(void 0===e&&(e=new o),this.type!==P.DYNAMIC)return;const n=q,i=_;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,i),this.applyImpulse(n,i)}updateMassProperties(){const t=D;this.invMass=this.mass>0?1/this.mass:0;const e=this.inertia,n=this.fixedRotation;this.updateAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),S.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(t,e){const n=new o;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}integrate(t,e,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==P.DYNAMIC&&this.type!==P.KINEMATIC||this.sleepState===P.SLEEPING)return;const i=this.velocity,s=this.angularVelocity,o=this.position,r=this.force,a=this.torque,l=this.quaternion,c=this.invMass,h=this.invInertiaWorld,u=this.linearFactor,d=c*t;i.x+=r.x*d*u.x,i.y+=r.y*d*u.y,i.z+=r.z*d*u.z;const p=h.elements,f=this.angularFactor,y=a.x*f.x,m=a.y*f.y,g=a.z*f.z;s.x+=t*(p[0]*y+p[1]*m+p[2]*g),s.y+=t*(p[3]*y+p[4]*m+p[5]*g),s.z+=t*(p[6]*y+p[7]*m+p[8]*g),o.x+=i.x*t,o.y+=i.y*t,o.z+=i.z*t,l.integrate(this.angularVelocity,t,this.angularFactor,l),e&&(n?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}P.idCounter=0,P.COLLIDE_EVENT_NAME="collide",P.DYNAMIC=1,P.STATIC=2,P.KINEMATIC=4,P.AWAKE=0,P.SLEEPY=1,P.SLEEPING=2,P.wakeupEvent={type:"wakeup"},P.sleepyEvent={type:"sleepy"},P.sleepEvent={type:"sleep"};const z=new o,M=new f,k=new c,I=new i,j=new i,F=(new i,new o),N=new o,L=new o,R=new o,O=new o,q=new o,_=new o,D=new o;class V{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&P.STATIC)&&t.sleepState!==P.SLEEPING||0==(e.type&P.STATIC)&&e.sleepState!==P.SLEEPING)}intersectionTest(t,e,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,i):this.doBoundingSphereBroadphase(t,e,n,i)}doBoundingSphereBroadphase(t,e,n,i){const s=U;e.position.vsub(t.position,s);const o=(t.boundingRadius+e.boundingRadius)**2;s.lengthSquared()<o&&(n.push(t),i.push(e))}doBoundingBoxBroadphase(t,e,n,i){t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),i.push(e))}makePairsUnique(t,e){const n=H,i=W,s=G,o=t.length;for(let n=0;n!==o;n++)i[n]=t[n],s[n]=e[n];t.length=0,e.length=0;for(let t=0;t!==o;t++){const e=i[t].id,o=s[t].id,r=e<o?`${e},${o}`:`${o},${e}`;n[r]=t,n.keys.push(r)}for(let o=0;o!==n.keys.length;o++){const o=n.keys.pop(),r=n[o];t.push(i[r]),e.push(s[r]),delete n[o]}}setWorld(t){}static boundingSphereCheck(t,e){const n=new o;t.position.vsub(e.position,n);const i=t.shapes[0],s=e.shapes[0];return Math.pow(i.boundingSphereRadius+s.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const U=new o;new o,new f,new o;const H={keys:[]},W=[],G=[];new o,new o,new o;class X extends V{constructor(){super()}collisionPairs(t,e,n){const i=t.bodies,s=i.length;let o,r;for(let t=0;t!==s;t++)for(let s=0;s!==t;s++)o=i[t],r=i[s],this.needBroadphaseCollision(o,r)&&this.intersectionTest(o,r,e,n)}aabbQuery(t,e,n){void 0===n&&(n=[]);for(let i=0;i<t.bodies.length;i++){const s=t.bodies[i];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&n.push(s)}return n}}class Z{constructor(){this.rayFromWorld=new o,this.rayToWorld=new o,this.hitNormalWorld=new o,this.hitPointWorld=new o,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,e,n,i,s,o,r){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=s,this.body=o,this.distance=r}}let Y,$,Q,K,J,tt,et;Y=g.types.SPHERE,$=g.types.PLANE,Q=g.types.BOX,K=g.types.CYLINDER,J=g.types.CONVEXPOLYHEDRON,tt=g.types.HEIGHTFIELD,et=g.types.TRIMESH;class nt{get[Y](){return this._intersectSphere}get[$](){return this._intersectPlane}get[Q](){return this._intersectBox}get[K](){return this._intersectConvex}get[J](){return this._intersectConvex}get[tt](){return this._intersectHeightfield}get[et](){return this._intersectTrimesh}constructor(t,e){void 0===t&&(t=new o),void 0===e&&(e=new o),this.from=t.clone(),this.to=e.clone(),this.direction=new o,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=nt.ANY,this.result=new Z,this.hasHit=!1,this.callback=t=>{}}intersectWorld(t,e){return this.mode=e.mode||nt.ANY,this.result=e.result||new Z,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===e.checkCollisionResponse||e.checkCollisionResponse,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(it),st.length=0,t.broadphase.aabbQuery(t,it,st),this.intersectBodies(st),this.hasHit}intersectBody(t,e){e&&(this.result=e,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!t.collisionResponse)return;if(0==(this.collisionFilterGroup&t.collisionFilterMask)||0==(t.collisionFilterGroup&this.collisionFilterMask))return;const i=at,s=lt;for(let e=0,o=t.shapes.length;e<o;e++){const o=t.shapes[e];if((!n||o.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[e],s),t.quaternion.vmult(t.shapeOffsets[e],i),i.vadd(t.position,i),this.intersectShape(o,s,i,t),this.result.shouldStop))break}}intersectBodies(t,e){e&&(this.result=e,this.updateDirection());for(let e=0,n=t.length;!this.result.shouldStop&&e<n;e++)this.intersectBody(t[e])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,e,n,i){const s=function(t,e,n){n.vsub(t,zt);const i=zt.dot(e);e.scale(i,Mt),Mt.vadd(t,Mt);return n.distanceTo(Mt)}(this.from,this.direction,n);if(s>t.boundingSphereRadius)return;const o=this[t.type];o&&o.call(this,t,e,n,i,t)}_intersectBox(t,e,n,i,s){return this._intersectConvex(t.convexPolyhedronRepresentation,e,n,i,s)}_intersectPlane(t,e,n,i,s){const r=this.from,a=this.to,l=this.direction,c=new o(0,0,1);e.vmult(c,c);const h=new o;r.vsub(n,h);const u=h.dot(c);if(a.vsub(n,h),u*h.dot(c)>0)return;if(r.distanceTo(a)<u)return;const d=c.dot(l);if(Math.abs(d)<this.precision)return;const p=new o,f=new o,y=new o;r.vsub(n,p);const m=-c.dot(p)/d;l.scale(m,f),r.vadd(f,y),this.reportIntersection(c,y,s,i,-1)}getAABB(t){const{lowerBound:e,upperBound:n}=t,i=this.to,s=this.from;e.x=Math.min(i.x,s.x),e.y=Math.min(i.y,s.y),e.z=Math.min(i.z,s.z),n.x=Math.max(i.x,s.x),n.y=Math.max(i.y,s.y),n.z=Math.max(i.z,s.z)}_intersectHeightfield(t,e,n,i,s){t.data,t.elementSize;const o=yt;o.from.copy(this.from),o.to.copy(this.to),w.pointToLocalFrame(n,e,o.from,o.from),w.pointToLocalFrame(n,e,o.to,o.to),o.updateDirection();const r=mt;let a,l,h,u;a=l=0,h=u=t.data.length-1;const d=new c;o.getAABB(d),t.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,r,!0),a=Math.max(a,r[0]),l=Math.max(l,r[1]),t.getIndexOfPosition(d.upperBound.x,d.upperBound.y,r,!0),h=Math.min(h,r[0]+1),u=Math.min(u,r[1]+1);for(let r=a;r<h;r++)for(let a=l;a<u;a++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(r,a,d),d.overlapsRay(o)){if(t.getConvexTrianglePillar(r,a,!1),w.pointToWorldFrame(n,e,t.pillarOffset,ft),this._intersectConvex(t.pillarConvex,e,ft,i,s,pt),this.result.shouldStop)return;t.getConvexTrianglePillar(r,a,!0),w.pointToWorldFrame(n,e,t.pillarOffset,ft),this._intersectConvex(t.pillarConvex,e,ft,i,s,pt)}}}_intersectSphere(t,e,n,i,s){const o=this.from,r=this.to,a=t.radius,l=(r.x-o.x)**2+(r.y-o.y)**2+(r.z-o.z)**2,c=2*((r.x-o.x)*(o.x-n.x)+(r.y-o.y)*(o.y-n.y)+(r.z-o.z)*(o.z-n.z)),h=c**2-4*l*((o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-a**2),u=gt,d=wt;if(!(h<0))if(0===h)o.lerp(r,h,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,s,i,-1);else{const t=(-c-Math.sqrt(h))/(2*l),e=(-c+Math.sqrt(h))/(2*l);if(t>=0&&t<=1&&(o.lerp(r,t,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,s,i,-1)),this.result.shouldStop)return;e>=0&&e<=1&&(o.lerp(r,e,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,s,i,-1))}}_intersectConvex(t,e,n,i,s,o){const r=vt,a=bt,l=o&&o.faceList||null,c=t.faces,h=t.vertices,u=t.faceNormals,d=this.direction,p=this.from,f=this.to,y=p.distanceTo(f),m=l?l.length:c.length,g=this.result;for(let t=0;!g.shouldStop&&t<m;t++){const o=l?l[t]:t,f=c[o],m=u[o],w=e,v=n;a.copy(h[f[0]]),w.vmult(a,a),a.vadd(v,a),a.vsub(p,a),w.vmult(m,r);const b=d.dot(r);if(Math.abs(b)<this.precision)continue;const x=r.dot(a)/b;if(!(x<0)){d.scale(x,ct),ct.vadd(p,ct),ht.copy(h[f[0]]),w.vmult(ht,ht),v.vadd(ht,ht);for(let t=1;!g.shouldStop&&t<f.length-1;t++){ut.copy(h[f[t]]),dt.copy(h[f[t+1]]),w.vmult(ut,ut),w.vmult(dt,dt),v.vadd(ut,ut),v.vadd(dt,dt);const e=ct.distanceTo(p);!nt.pointInTriangle(ct,ht,ut,dt)&&!nt.pointInTriangle(ct,ut,ht,dt)||e>y||this.reportIntersection(r,ct,s,i,o)}}}}_intersectTrimesh(t,e,n,i,s,o){const r=xt,a=Ct,l=Pt,c=bt,h=At,u=Et,d=Bt,p=Tt,f=St,y=t.indices;t.vertices;const m=this.from,g=this.to,v=this.direction;l.position.copy(n),l.quaternion.copy(e),w.vectorToLocalFrame(n,e,v,h),w.pointToLocalFrame(n,e,m,u),w.pointToLocalFrame(n,e,g,d),d.x*=t.scale.x,d.y*=t.scale.y,d.z*=t.scale.z,u.x*=t.scale.x,u.y*=t.scale.y,u.z*=t.scale.z,d.vsub(u,h),h.normalize();const b=u.distanceSquared(d);t.tree.rayQuery(this,l,a);for(let o=0,l=a.length;!this.result.shouldStop&&o!==l;o++){const l=a[o];t.getNormal(l,r),t.getVertex(y[3*l],ht),ht.vsub(u,c);const d=h.dot(r),m=r.dot(c)/d;if(m<0)continue;h.scale(m,ct),ct.vadd(u,ct),t.getVertex(y[3*l+1],ut),t.getVertex(y[3*l+2],dt);const g=ct.distanceSquared(u);!nt.pointInTriangle(ct,ut,ht,dt)&&!nt.pointInTriangle(ct,ht,ut,dt)||g>b||(w.vectorToWorldFrame(e,r,f),w.pointToWorldFrame(n,e,ct,p),this.reportIntersection(f,p,s,i,l))}a.length=0}reportIntersection(t,e,n,i,s){const o=this.from,r=this.to,a=o.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==s?s:-1,this.mode){case nt.ALL:this.hasHit=!0,l.set(o,r,t,e,n,i,a),l.hasHit=!0,this.callback(l);break;case nt.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(o,r,t,e,n,i,a));break;case nt.ANY:this.hasHit=!0,l.hasHit=!0,l.set(o,r,t,e,n,i,a),l.shouldStop=!0}}static pointInTriangle(t,e,n,i){i.vsub(e,zt),n.vsub(e,ot),t.vsub(e,rt);const s=zt.dot(zt),o=zt.dot(ot),r=zt.dot(rt),a=ot.dot(ot),l=ot.dot(rt);let c,h;return(c=a*r-o*l)>=0&&(h=s*l-o*r)>=0&&c+h<s*a-o*o}}nt.CLOSEST=1,nt.ANY=2,nt.ALL=4;const it=new c,st=[],ot=new o,rt=new o,at=new o,lt=new f,ct=new o,ht=new o,ut=new o,dt=new o;new o,new Z;const pt={faceList:[0]},ft=new o,yt=new nt,mt=[],gt=new o,wt=new o,vt=new o,bt=(new o,new o,new o),xt=new o,At=new o,Et=new o,Bt=new o,St=new o,Tt=new o;new c;const Ct=[],Pt=new w,zt=new o,Mt=new o;class kt{static defaults(t,e){void 0===t&&(t={});for(let n in e)n in t||(t[n]=e[n]);return t}}class It{constructor(t,e,n){void 0===n&&(n={}),n=kt.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=It.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!0}disable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!1}}It.idCounter=0;class jt{constructor(){this.spatial=new o,this.rotational=new o}multiplyElement(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)}multiplyVectors(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}}class Ft{constructor(t,e,n,i){void 0===n&&(n=-1e6),void 0===i&&(i=1e6),this.id=Ft.idCounter++,this.minForce=n,this.maxForce=i,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new jt,this.jacobianElementB=new jt,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(t,e,n){const i=e,s=t,o=n;this.a=4/(o*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(o*o*s*(1+4*i))}computeB(t,e,n){const i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*n}computeGq(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,s=n.position,o=i.position;return t.spatial.dot(s)+e.spatial.dot(o)}computeGW(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,s=n.velocity,o=i.velocity,r=n.angularVelocity,a=i.angularVelocity;return t.multiplyVectors(s,r)+e.multiplyVectors(o,a)}computeGWlambda(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,s=n.vlambda,o=i.vlambda,r=n.wlambda,a=i.wlambda;return t.multiplyVectors(s,r)+e.multiplyVectors(o,a)}computeGiMf(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,s=n.force,o=n.torque,r=i.force,a=i.torque,l=n.invMassSolve,c=i.invMassSolve;return s.scale(l,Nt),r.scale(c,Lt),n.invInertiaWorldSolve.vmult(o,Rt),i.invInertiaWorldSolve.vmult(a,Ot),t.multiplyVectors(Nt,Rt)+e.multiplyVectors(Lt,Ot)}computeGiMGt(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,s=n.invMassSolve,o=i.invMassSolve,r=n.invInertiaWorldSolve,a=i.invInertiaWorldSolve;let l=s+o;return r.vmult(t.rotational,qt),l+=qt.dot(t.rotational),a.vmult(e.rotational,qt),l+=qt.dot(e.rotational),l}addToWlambda(t){const e=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,s=this.bj,o=_t;i.vlambda.addScaledVector(i.invMassSolve*t,e.spatial,i.vlambda),s.vlambda.addScaledVector(s.invMassSolve*t,n.spatial,s.vlambda),i.invInertiaWorldSolve.vmult(e.rotational,o),i.wlambda.addScaledVector(t,o,i.wlambda),s.invInertiaWorldSolve.vmult(n.rotational,o),s.wlambda.addScaledVector(t,o,s.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Ft.idCounter=0;const Nt=new o,Lt=new o,Rt=new o,Ot=new o,qt=new o,_t=new o;class Dt extends Ft{constructor(t,e,n){void 0===n&&(n=1e6),super(t,e,0,n),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}computeB(t){const e=this.a,n=this.b,i=this.bi,s=this.bj,o=this.ri,r=this.rj,a=Vt,l=Ut,c=i.velocity,h=i.angularVelocity;i.force,i.torque;const u=s.velocity,d=s.angularVelocity;s.force,s.torque;const p=Ht,f=this.jacobianElementA,y=this.jacobianElementB,m=this.ni;o.cross(m,a),r.cross(m,l),m.negate(f.spatial),a.negate(f.rotational),y.spatial.copy(m),y.rotational.copy(l),p.copy(s.position),p.vadd(r,p),p.vsub(i.position,p),p.vsub(o,p);const g=m.dot(p),w=this.restitution+1;return-g*e-(w*u.dot(m)-w*c.dot(m)+d.dot(l)-h.dot(a))*n-t*this.computeGiMf()}getImpactVelocityAlongNormal(){const t=Wt,e=Gt,n=Xt,i=Zt,s=Yt;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,s),this.ni.dot(s)}}const Vt=new o,Ut=new o,Ht=new o,Wt=new o,Gt=new o,Xt=new o,Zt=new o,Yt=new o;class $t extends It{constructor(t,e,n,i,s){void 0===e&&(e=new o),void 0===i&&(i=new o),void 0===s&&(s=1e6),super(t,n),this.pivotA=e.clone(),this.pivotB=i.clone();const r=this.equationX=new Dt(t,n),a=this.equationY=new Dt(t,n),l=this.equationZ=new Dt(t,n);this.equations.push(r,a,l),r.minForce=a.minForce=l.minForce=-s,r.maxForce=a.maxForce=l.maxForce=s,r.ni.set(1,0,0),a.ni.set(0,1,0),l.ni.set(0,0,1)}update(){const t=this.bodyA,e=this.bodyB,n=this.equationX,i=this.equationY,s=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),s.ri.copy(n.ri),s.rj.copy(n.rj)}}new o,new o,new o,new o,new o,new o,new o,new o,new o,new o;class Qt extends Ft{constructor(t,e,n){super(t,e,-n,n),this.ri=new o,this.rj=new o,this.t=new o}computeB(t){this.a;const e=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,s=Kt,o=Jt,r=this.t;n.cross(r,s),i.cross(r,o);const a=this.jacobianElementA,l=this.jacobianElementB;return r.negate(a.spatial),s.negate(a.rotational),l.spatial.copy(r),l.rotational.copy(o),-this.computeGW()*e-t*this.computeGiMf()}}const Kt=new o,Jt=new o;class te{constructor(t,e,n){n=kt.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=te.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}te.idCounter=0;class ee{constructor(t){void 0===t&&(t={});let e="";"string"==typeof t&&(e=t,t={}),this.name=e,this.id=ee.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}}ee.idCounter=0,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new nt,new o,new o,new o,new o(1,0,0),new o(0,1,0),new o(0,0,1),new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o;class ne extends g{constructor(t){if(super({type:g.types.SPHERE}),this.radius=void 0!==t?t:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(t,e){void 0===e&&(e=new o);const n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(t,e,n,i){const s=this.radius,o=["x","y","z"];for(let e=0;e<o.length;e++){const r=o[e];n[r]=t[r]-s,i[r]=t[r]+s}}}new o,new o,new o,new o,new o,new o,new o,new o,new o;class ie extends b{constructor(t,e,n,i){if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===i&&(i=8),t<0)throw new Error("The cylinder radiusTop cannot be negative.");if(e<0)throw new Error("The cylinder radiusBottom cannot be negative.");const s=i,r=[],a=[],l=[],c=[],h=[],u=Math.cos,d=Math.sin;r.push(new o(-e*d(0),.5*-n,e*u(0))),c.push(0),r.push(new o(-t*d(0),.5*n,t*u(0))),h.push(1);for(let i=0;i<s;i++){const p=2*Math.PI/s*(i+1),f=2*Math.PI/s*(i+.5);i<s-1?(r.push(new o(-e*d(p),.5*-n,e*u(p))),c.push(2*i+2),r.push(new o(-t*d(p),.5*n,t*u(p))),h.push(2*i+3),l.push([2*i,2*i+1,2*i+3,2*i+2])):l.push([2*i,2*i+1,1,0]),(s%2==1||i<s/2)&&a.push(new o(-d(f),0,u(f)))}l.push(c),a.push(new o(0,1,0));const p=[];for(let t=0;t<h.length;t++)p.push(h[h.length-t-1]);l.push(p),super({vertices:r,faces:l,axes:a}),this.type=g.types.CYLINDER,this.radiusTop=t,this.radiusBottom=e,this.height=n,this.numSegments=i}}class se extends g{constructor(){super({type:g.types.PLANE}),this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(t){const e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(t,e){return void 0===e&&(e=new o),e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,n,i){oe.set(0,0,1),e.vmult(oe,oe);const s=Number.MAX_VALUE;n.set(-s,-s,-s),i.set(s,s,s),1===oe.x?i.x=t.x:-1===oe.x&&(n.x=t.x),1===oe.y?i.y=t.y:-1===oe.y&&(n.y=t.y),1===oe.z?i.z=t.z:-1===oe.z&&(n.z=t.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const oe=new o;new o,new o,new o,new o,new o,new o,new o,new o,new o;class re{constructor(t){void 0===t&&(t={}),this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new c,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(t,e,n){void 0===n&&(n=0);const i=this.data;if(!this.aabb.contains(t))return!1;const s=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let i=!1;s.length||(this.subdivide(),i=!0);for(let i=0;8!==i;i++)if(s[i].insert(t,e,n+1))return!0;i&&(s.length=0)}return i.push(e),!0}subdivide(){const t=this.aabb,e=t.lowerBound,n=t.upperBound,i=this.children;i.push(new re({aabb:new c({lowerBound:new o(0,0,0)})}),new re({aabb:new c({lowerBound:new o(1,0,0)})}),new re({aabb:new c({lowerBound:new o(1,1,0)})}),new re({aabb:new c({lowerBound:new o(1,1,1)})}),new re({aabb:new c({lowerBound:new o(0,1,1)})}),new re({aabb:new c({lowerBound:new o(0,0,1)})}),new re({aabb:new c({lowerBound:new o(1,0,1)})}),new re({aabb:new c({lowerBound:new o(0,1,0)})})),n.vsub(e,le),le.scale(.5,le);const s=this.root||this;for(let t=0;8!==t;t++){const n=i[t];n.root=s;const o=n.aabb.lowerBound;o.x*=le.x,o.y*=le.y,o.z*=le.z,o.vadd(e,o),o.vadd(le,n.aabb.upperBound)}}aabbQuery(t,e){this.data,this.children;const n=[this];for(;n.length;){const i=n.pop();i.aabb.overlaps(t)&&Array.prototype.push.apply(e,i.data),Array.prototype.push.apply(n,i.children)}return e}rayQuery(t,e,n){return t.getAABB(ce),ce.toLocalFrame(e,ce),this.aabbQuery(ce,n),n}removeEmptyNodes(){for(let t=this.children.length-1;t>=0;t--)this.children[t].removeEmptyNodes(),this.children[t].children.length||this.children[t].data.length||this.children.splice(t,1)}}class ae extends re{constructor(t,e){void 0===e&&(e={}),super({root:null,aabb:t}),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}}const le=new o,ce=new c;class he extends g{constructor(t,e){super({type:g.types.TRIMESH}),this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new c,this.edges=null,this.scale=new o(1,1,1),this.tree=new ae,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const t=this.tree;t.reset(),t.aabb.copy(this.aabb);const e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;const n=new c,i=new o,s=new o,r=new o,a=[i,s,r];for(let e=0;e<this.indices.length/3;e++){const o=3*e;this._getUnscaledVertex(this.indices[o],i),this._getUnscaledVertex(this.indices[o+1],s),this._getUnscaledVertex(this.indices[o+2],r),n.setFromPoints(a),t.insert(n,e)}t.removeEmptyNodes()}getTrianglesInAABB(t,e){de.copy(t);const n=this.scale,i=n.x,s=n.y,o=n.z,r=de.lowerBound,a=de.upperBound;return r.x/=i,r.y/=s,r.z/=o,a.x/=i,a.y/=s,a.z/=o,this.tree.aabbQuery(de,e)}setScale(t){const e=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=t.x===t.y&&t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const t=ue,e=this.normals;for(let n=0;n<this.indices.length/3;n++){const i=3*n,s=this.indices[i],o=this.indices[i+1],r=this.indices[i+2];this.getVertex(s,ge),this.getVertex(o,we),this.getVertex(r,ve),he.computeNormal(we,ge,ve,t),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z}}updateEdges(){const t={},e=(e,n)=>{t[e<n?`${e}_${n}`:`${n}_${e}`]=!0};for(let t=0;t<this.indices.length/3;t++){const n=3*t,i=this.indices[n],s=this.indices[n+1],o=this.indices[n+2];e(i,s),e(s,o),e(o,i)}const n=Object.keys(t);this.edges=new Int16Array(2*n.length);for(let t=0;t<n.length;t++){const e=n[t].split("_");this.edges[2*t]=parseInt(e[0],10),this.edges[2*t+1]=parseInt(e[1],10)}}getEdgeVertex(t,e,n){const i=this.edges[2*t+(e?1:0)];this.getVertex(i,n)}getEdgeVector(t,e){const n=pe,i=fe;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,i),i.vsub(n,e)}static computeNormal(t,e,n,i){e.vsub(t,me),n.vsub(e,ye),ye.cross(me,i),i.isZero()||i.normalize()}getVertex(t,e){const n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e}_getUnscaledVertex(t,e){const n=3*t,i=this.vertices;return e.set(i[n],i[n+1],i[n+2])}getWorldVertex(t,e,n,i){return this.getVertex(t,i),w.pointToWorldFrame(e,n,i,i),i}getTriangleVertices(t,e,n,i){const s=3*t;this.getVertex(this.indices[s],e),this.getVertex(this.indices[s+1],n),this.getVertex(this.indices[s+2],i)}getNormal(t,e){const n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(t,e){this.computeLocalAABB(be);const n=be.upperBound.x-be.lowerBound.x,i=be.upperBound.y-be.lowerBound.y,s=be.upperBound.z-be.lowerBound.z;return e.set(1/12*t*(2*i*2*i+2*s*2*s),1/12*t*(2*n*2*n+2*s*2*s),1/12*t*(2*i*2*i+2*n*2*n))}computeLocalAABB(t){const e=t.lowerBound,n=t.upperBound,i=this.vertices.length;this.vertices;const s=xe;this.getVertex(0,s),e.copy(s),n.copy(s);for(let t=0;t!==i;t++)this.getVertex(t,s),s.x<e.x?e.x=s.x:s.x>n.x&&(n.x=s.x),s.y<e.y?e.y=s.y:s.y>n.y&&(n.y=s.y),s.z<e.z?e.z=s.z:s.z>n.z&&(n.z=s.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let t=0;const e=this.vertices,n=new o;for(let i=0,s=e.length/3;i!==s;i++){this.getVertex(i,n);const e=n.lengthSquared();e>t&&(t=e)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,i){const s=Ae,o=Ee;s.position=t,s.quaternion=e,this.aabb.toWorldFrame(s,o),n.copy(o.lowerBound),i.copy(o.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(t,e,n,i,s){void 0===t&&(t=1),void 0===e&&(e=.5),void 0===n&&(n=8),void 0===i&&(i=6),void 0===s&&(s=2*Math.PI);const o=[],r=[];for(let r=0;r<=n;r++)for(let a=0;a<=i;a++){const l=a/i*s,c=r/n*Math.PI*2,h=(t+e*Math.cos(c))*Math.cos(l),u=(t+e*Math.cos(c))*Math.sin(l),d=e*Math.sin(c);o.push(h,u,d)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,s=(i+1)*(t-1)+e-1,o=(i+1)*(t-1)+e,a=(i+1)*t+e;r.push(n,s,a),r.push(s,o,a)}return new he(o,r)}}const ue=new o,de=new c,pe=new o,fe=new o,ye=new o,me=new o,ge=new o,we=new o,ve=new o,be=new c,xe=new o,Ae=new w,Ee=new c;class Be{constructor(){this.equations=[]}solve(t,e){return 0}addEquation(t){!t.enabled||t.bi.isTrigger||t.bj.isTrigger||this.equations.push(t)}removeEquation(t){const e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)}removeAllEquations(){this.equations.length=0}}class Se extends Be{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(t,e){let n=0;const i=this.iterations,s=this.tolerance*this.tolerance,o=this.equations,r=o.length,a=e.bodies,l=a.length,c=t;let h,u,d,p,f,y;if(0!==r)for(let t=0;t!==l;t++)a[t].updateSolveMassProperties();const m=Ce,g=Pe,w=Te;m.length=r,g.length=r,w.length=r;for(let t=0;t!==r;t++){const e=o[t];w[t]=0,g[t]=e.computeB(c),m[t]=1/e.computeC()}if(0!==r){for(let t=0;t!==l;t++){const e=a[t],n=e.vlambda,i=e.wlambda;n.set(0,0,0),i.set(0,0,0)}for(n=0;n!==i;n++){p=0;for(let t=0;t!==r;t++){const e=o[t];h=g[t],u=m[t],y=w[t],f=e.computeGWlambda(),d=u*(h-f-e.eps*y),y+d<e.minForce?d=e.minForce-y:y+d>e.maxForce&&(d=e.maxForce-y),w[t]+=d,p+=d>0?d:-d,e.addToWlambda(d)}if(p*p<s)break}for(let t=0;t!==l;t++){const e=a[t],n=e.velocity,i=e.angularVelocity;e.vlambda.vmul(e.linearFactor,e.vlambda),n.vadd(e.vlambda,n),e.wlambda.vmul(e.angularFactor,e.wlambda),i.vadd(e.wlambda,i)}let t=o.length;const e=1/c;for(;t--;)o[t].multiplier=w[t]*e}return n}}const Te=[],Ce=[],Pe=[];P.STATIC;class ze{constructor(){this.objects=[],this.type=Object}release(){const t=arguments.length;for(let e=0;e!==t;e++)this.objects.push(e<0||arguments.length<=e?void 0:arguments[e]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(t){const e=this.objects;for(;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}}class Me extends ze{constructor(){super(...arguments),this.type=o}constructObject(){return new o}}const ke=g.types.SPHERE,Ie=g.types.SPHERE|g.types.PLANE,je=g.types.BOX|g.types.BOX,Fe=g.types.SPHERE|g.types.BOX,Ne=g.types.PLANE|g.types.BOX,Le=g.types.CONVEXPOLYHEDRON,Re=g.types.SPHERE|g.types.CONVEXPOLYHEDRON,Oe=g.types.PLANE|g.types.CONVEXPOLYHEDRON,qe=g.types.BOX|g.types.CONVEXPOLYHEDRON,_e=g.types.SPHERE|g.types.HEIGHTFIELD,De=g.types.BOX|g.types.HEIGHTFIELD,Ve=g.types.CONVEXPOLYHEDRON|g.types.HEIGHTFIELD,Ue=g.types.PARTICLE|g.types.SPHERE,He=g.types.PLANE|g.types.PARTICLE,We=g.types.BOX|g.types.PARTICLE,Ge=g.types.PARTICLE|g.types.CONVEXPOLYHEDRON,Xe=g.types.CYLINDER,Ze=g.types.SPHERE|g.types.CYLINDER,Ye=g.types.PLANE|g.types.CYLINDER,$e=g.types.BOX|g.types.CYLINDER,Qe=g.types.CONVEXPOLYHEDRON|g.types.CYLINDER,Ke=g.types.HEIGHTFIELD|g.types.CYLINDER,Je=g.types.PARTICLE|g.types.CYLINDER,tn=g.types.SPHERE|g.types.TRIMESH,en=g.types.PLANE|g.types.TRIMESH;class nn{get[ke](){return this.sphereSphere}get[Ie](){return this.spherePlane}get[je](){return this.boxBox}get[Fe](){return this.sphereBox}get[Ne](){return this.planeBox}get[Le](){return this.convexConvex}get[Re](){return this.sphereConvex}get[Oe](){return this.planeConvex}get[qe](){return this.boxConvex}get[_e](){return this.sphereHeightfield}get[De](){return this.boxHeightfield}get[Ve](){return this.convexHeightfield}get[Ue](){return this.sphereParticle}get[He](){return this.planeParticle}get[We](){return this.boxParticle}get[Ge](){return this.convexParticle}get[Xe](){return this.convexConvex}get[Ze](){return this.sphereConvex}get[Ye](){return this.planeConvex}get[$e](){return this.boxConvex}get[Qe](){return this.convexConvex}get[Ke](){return this.heightfieldCylinder}get[Je](){return this.particleCylinder}get[tn](){return this.sphereTrimesh}get[en](){return this.planeTrimesh}constructor(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new Me,this.world=t,this.currentContactMaterial=t.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(t,e,n,i,s,o){let r;this.contactPointPool.length?(r=this.contactPointPool.pop(),r.bi=t,r.bj=e):r=new Dt(t,e),r.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&i.collisionResponse;const a=this.currentContactMaterial;r.restitution=a.restitution,r.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);const l=n.material||t.material,c=i.material||e.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(r.restitution=l.restitution*c.restitution),r.si=s||n,r.sj=o||i,r}createFrictionEquationsFromContact(t,e){const n=t.bi,i=t.bj,s=t.si,o=t.sj,r=this.world,a=this.currentContactMaterial;let l=a.friction;const c=s.material||n.material,h=o.material||i.material;if(c&&h&&c.friction>=0&&h.friction>=0&&(l=c.friction*h.friction),l>0){const s=l*r.gravity.length();let o=n.invMass+i.invMass;o>0&&(o=1/o);const c=this.frictionEquationPool,h=c.length?c.pop():new Qt(n,i,s*o),u=c.length?c.pop():new Qt(n,i,s*o);return h.bi=u.bi=n,h.bj=u.bj=i,h.minForce=u.minForce=-s*o,h.maxForce=u.maxForce=s*o,h.ri.copy(t.ri),h.rj.copy(t.rj),u.ri.copy(t.ri),u.rj.copy(t.rj),t.ni.tangents(h.t,u.t),h.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,r.dt),u.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,r.dt),h.enabled=u.enabled=t.enabled,e.push(h,u),!0}return!1}createFrictionFromAverage(t){let e=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(e,this.frictionResult)||1===t)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];sn.setZero(),on.setZero(),rn.setZero();const s=e.bi;e.bj;for(let n=0;n!==t;n++)e=this.result[this.result.length-1-n],e.bi!==s?(sn.vadd(e.ni,sn),on.vadd(e.ri,on),rn.vadd(e.rj,rn)):(sn.vsub(e.ni,sn),on.vadd(e.rj,on),rn.vadd(e.ri,rn));const o=1/t;on.scale(o,n.ri),rn.scale(o,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),sn.normalize(),sn.tangents(n.t,i.t)}getContacts(t,e,n,i,s,o,r){this.contactPointPool=s,this.frictionEquationPool=r,this.result=i,this.frictionResult=o;const a=cn,l=hn,c=an,h=ln;for(let i=0,s=t.length;i!==s;i++){const s=t[i],o=e[i];let r=null;s.material&&o.material&&(r=n.getContactMaterial(s.material,o.material)||null);const u=s.type&P.KINEMATIC&&o.type&P.STATIC||s.type&P.STATIC&&o.type&P.KINEMATIC||s.type&P.KINEMATIC&&o.type&P.KINEMATIC;for(let t=0;t<s.shapes.length;t++){s.quaternion.mult(s.shapeOrientations[t],a),s.quaternion.vmult(s.shapeOffsets[t],c),c.vadd(s.position,c);const e=s.shapes[t];for(let t=0;t<o.shapes.length;t++){o.quaternion.mult(o.shapeOrientations[t],l),o.quaternion.vmult(o.shapeOffsets[t],h),h.vadd(o.position,h);const i=o.shapes[t];if(!(e.collisionFilterMask&i.collisionFilterGroup&&i.collisionFilterMask&e.collisionFilterGroup))continue;if(c.distanceTo(h)>e.boundingSphereRadius+i.boundingSphereRadius)continue;let d=null;e.material&&i.material&&(d=n.getContactMaterial(e.material,i.material)||null),this.currentContactMaterial=d||r||n.defaultContactMaterial;const p=this[e.type|i.type];if(p){let t=!1;t=e.type<i.type?p.call(this,e,i,c,h,a,l,s,o,e,i,u):p.call(this,i,e,h,c,l,a,o,s,e,i,u),t&&u&&(n.shapeOverlapKeeper.set(e.id,i.id),n.bodyOverlapKeeper.set(s.id,o.id))}}}}}sphereSphere(t,e,n,i,s,o,r,a,l,c,h){if(h)return n.distanceSquared(i)<(t.radius+e.radius)**2;const u=this.createContactEquation(r,a,t,e,l,c);i.vsub(n,u.ni),u.ni.normalize(),u.ri.copy(u.ni),u.rj.copy(u.ni),u.ri.scale(t.radius,u.ri),u.rj.scale(-e.radius,u.rj),u.ri.vadd(n,u.ri),u.ri.vsub(r.position,u.ri),u.rj.vadd(i,u.rj),u.rj.vsub(a.position,u.rj),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}spherePlane(t,e,n,i,s,o,r,a,l,c,h){const u=this.createContactEquation(r,a,t,e,l,c);if(u.ni.set(0,0,1),o.vmult(u.ni,u.ni),u.ni.negate(u.ni),u.ni.normalize(),u.ni.scale(t.radius,u.ri),n.vsub(i,zn),u.ni.scale(u.ni.dot(zn),Mn),zn.vsub(Mn,u.rj),-zn.dot(u.ni)<=t.radius){if(h)return!0;const t=u.ri,e=u.rj;t.vadd(n,t),t.vsub(r.position,t),e.vadd(i,e),e.vsub(a.position,e),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}}boxBox(t,e,n,i,s,o,r,a,l,c,h){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,i,s,o,r,a,t,e,h)}sphereBox(t,e,n,i,s,o,r,a,l,c,h){const u=this.v3pool,d=qn;n.vsub(i,Nn),e.getSideNormals(d,o);const p=t.radius;let f=!1;const y=Dn,m=Vn,g=Un;let w=null,v=0,b=0,x=0,A=null;for(let t=0,e=d.length;t!==e&&!1===f;t++){const e=Ln;e.copy(d[t]);const n=e.length();e.normalize();const i=Nn.dot(e);if(i<n+p&&i>0){const s=Rn,o=On;s.copy(d[(t+1)%3]),o.copy(d[(t+2)%3]);const r=s.length(),a=o.length();s.normalize(),o.normalize();const l=Nn.dot(s),c=Nn.dot(o);if(l<r&&l>-r&&c<a&&c>-a){const t=Math.abs(i-n-p);if((null===A||t<A)&&(A=t,b=l,x=c,w=n,y.copy(e),m.copy(s),g.copy(o),v++,h))return!0}}}if(v){f=!0;const s=this.createContactEquation(r,a,t,e,l,c);y.scale(-p,s.ri),s.ni.copy(y),s.ni.negate(s.ni),y.scale(w,y),m.scale(b,m),y.vadd(m,y),g.scale(x,g),y.vadd(g,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(r.position,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}let E=u.get();const B=_n;for(let s=0;2!==s&&!f;s++)for(let o=0;2!==o&&!f;o++)for(let u=0;2!==u&&!f;u++)if(E.set(0,0,0),s?E.vadd(d[0],E):E.vsub(d[0],E),o?E.vadd(d[1],E):E.vsub(d[1],E),u?E.vadd(d[2],E):E.vsub(d[2],E),i.vadd(E,B),B.vsub(n,B),B.lengthSquared()<p*p){if(h)return!0;f=!0;const s=this.createContactEquation(r,a,t,e,l,c);s.ri.copy(B),s.ri.normalize(),s.ni.copy(s.ri),s.ri.scale(p,s.ri),s.rj.copy(E),s.ri.vadd(n,s.ri),s.ri.vsub(r.position,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}u.release(E),E=null;const S=u.get(),T=u.get(),C=u.get(),P=u.get(),z=u.get(),M=d.length;for(let s=0;s!==M&&!f;s++)for(let o=0;o!==M&&!f;o++)if(s%3!=o%3){d[o].cross(d[s],S),S.normalize(),d[s].vadd(d[o],T),C.copy(n),C.vsub(T,C),C.vsub(i,C);const u=C.dot(S);S.scale(u,P);let y=0;for(;y===s%3||y===o%3;)y++;z.copy(n),z.vsub(P,z),z.vsub(T,z),z.vsub(i,z);const m=Math.abs(u),g=z.length();if(m<d[y].length()&&g<p){if(h)return!0;f=!0;const s=this.createContactEquation(r,a,t,e,l,c);T.vadd(P,s.rj),s.rj.copy(s.rj),z.negate(s.ni),s.ni.normalize(),s.ri.copy(s.rj),s.ri.vadd(i,s.ri),s.ri.vsub(n,s.ri),s.ri.normalize(),s.ri.scale(p,s.ri),s.ri.vadd(n,s.ri),s.ri.vsub(r.position,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}}u.release(S,T,C,P,z)}planeBox(t,e,n,i,s,o,r,a,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,n,i,s,o,r,a,t,e,h)}convexConvex(t,e,n,i,s,o,r,a,l,c,h,u,d){const p=si;if(!(n.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,s,i,o,p,u,d)){const u=[],d=oi;t.clipAgainstHull(n,s,e,i,o,p,-100,100,u);let f=0;for(let s=0;s!==u.length;s++){if(h)return!0;const o=this.createContactEquation(r,a,t,e,l,c),y=o.ri,m=o.rj;p.negate(o.ni),u[s].normal.negate(d),d.scale(u[s].depth,d),u[s].point.vadd(d,y),m.copy(u[s].point),y.vsub(n,y),m.vsub(i,m),y.vadd(n,y),y.vsub(r.position,y),m.vadd(i,m),m.vsub(a.position,m),this.result.push(o),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(o,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(t,e,n,i,s,o,r,a,l,c,h){const u=this.v3pool;n.vsub(i,Hn);const d=e.faceNormals,p=e.faces,f=e.vertices,y=t.radius;let m=!1;for(let s=0;s!==f.length;s++){const u=f[s],d=Zn;o.vmult(u,d),i.vadd(d,d);const p=Xn;if(d.vsub(n,p),p.lengthSquared()<y*y){if(h)return!0;m=!0;const s=this.createContactEquation(r,a,t,e,l,c);return s.ri.copy(p),s.ri.normalize(),s.ni.copy(s.ri),s.ri.scale(y,s.ri),d.vsub(i,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(r.position,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),this.result.push(s),void this.createFrictionEquationsFromContact(s,this.frictionResult)}}for(let s=0,g=p.length;s!==g&&!1===m;s++){const g=d[s],w=p[s],v=Yn;o.vmult(g,v);const b=$n;o.vmult(f[w[0]],b),b.vadd(i,b);const x=Qn;v.scale(-y,x),n.vadd(x,x);const A=Kn;x.vsub(b,A);const E=A.dot(v),B=Jn;if(n.vsub(b,B),E<0&&B.dot(v)>0){const s=[];for(let t=0,e=w.length;t!==e;t++){const e=u.get();o.vmult(f[w[t]],e),i.vadd(e,e),s.push(e)}if(Fn(s,v,n)){if(h)return!0;m=!0;const o=this.createContactEquation(r,a,t,e,l,c);v.scale(-y,o.ri),v.negate(o.ni);const d=u.get();v.scale(-E,d);const p=u.get();v.scale(-y,p),n.vsub(i,o.rj),o.rj.vadd(p,o.rj),o.rj.vadd(d,o.rj),o.rj.vadd(i,o.rj),o.rj.vsub(a.position,o.rj),o.ri.vadd(n,o.ri),o.ri.vsub(r.position,o.ri),u.release(d),u.release(p),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult);for(let t=0,e=s.length;t!==e;t++)u.release(s[t]);return}for(let d=0;d!==w.length;d++){const p=u.get(),m=u.get();o.vmult(f[w[(d+1)%w.length]],p),o.vmult(f[w[(d+2)%w.length]],m),i.vadd(p,p),i.vadd(m,m);const g=Wn;m.vsub(p,g);const v=Gn;g.unit(v);const b=u.get(),x=u.get();n.vsub(p,x);const A=x.dot(v);v.scale(A,b),b.vadd(p,b);const E=u.get();if(b.vsub(n,E),A>0&&A*A<g.lengthSquared()&&E.lengthSquared()<y*y){if(h)return!0;const o=this.createContactEquation(r,a,t,e,l,c);b.vsub(i,o.rj),b.vsub(n,o.ni),o.ni.normalize(),o.ni.scale(y,o.ri),o.rj.vadd(i,o.rj),o.rj.vsub(a.position,o.rj),o.ri.vadd(n,o.ri),o.ri.vsub(r.position,o.ri),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult);for(let t=0,e=s.length;t!==e;t++)u.release(s[t]);return u.release(p),u.release(m),u.release(b),u.release(E),void u.release(x)}u.release(p),u.release(m),u.release(b),u.release(E),u.release(x)}for(let t=0,e=s.length;t!==e;t++)u.release(s[t])}}}planeConvex(t,e,n,i,s,o,r,a,l,c,h){const u=ti,d=ei;d.set(0,0,1),s.vmult(d,d);let p=0;const f=ni;for(let s=0;s!==e.vertices.length;s++)if(u.copy(e.vertices[s]),o.vmult(u,u),i.vadd(u,u),u.vsub(n,f),d.dot(f)<=0){if(h)return!0;const s=this.createContactEquation(r,a,t,e,l,c),o=ii;d.scale(d.dot(f),o),u.vsub(o,o),o.vsub(n,s.ri),s.ni.copy(d),u.vsub(i,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(r.position,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),this.result.push(s),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(s,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(t,e,n,i,s,o,r,a,l,c,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,i,s,o,r,a,t,e,h)}sphereHeightfield(t,e,n,i,s,o,r,a,l,c,h){const u=e.data,d=t.radius,p=e.elementSize,f=vi,y=wi;w.pointToLocalFrame(i,o,n,y);let m=Math.floor((y.x-d)/p)-1,g=Math.ceil((y.x+d)/p)+1,v=Math.floor((y.y-d)/p)-1,b=Math.ceil((y.y+d)/p)+1;if(g<0||b<0||m>u.length||v>u[0].length)return;m<0&&(m=0),g<0&&(g=0),v<0&&(v=0),b<0&&(b=0),m>=u.length&&(m=u.length-1),g>=u.length&&(g=u.length-1),b>=u[0].length&&(b=u[0].length-1),v>=u[0].length&&(v=u[0].length-1);const x=[];e.getRectMinMax(m,v,g,b,x);const A=x[0],E=x[1];if(y.z-d>E||y.z+d<A)return;const B=this.result;for(let l=m;l<g;l++)for(let c=v;c<b;c++){const u=B.length;let d=!1;if(e.getConvexTrianglePillar(l,c,!1),w.pointToWorldFrame(i,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(d=this.sphereConvex(t,e.pillarConvex,n,f,s,o,r,a,t,e,h)),h&&d)return!0;if(e.getConvexTrianglePillar(l,c,!0),w.pointToWorldFrame(i,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(d=this.sphereConvex(t,e.pillarConvex,n,f,s,o,r,a,t,e,h)),h&&d)return!0;if(B.length-u>2)return}}boxHeightfield(t,e,n,i,s,o,r,a,l,c,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,i,s,o,r,a,t,e,h)}convexHeightfield(t,e,n,i,s,o,r,a,l,c,h){const u=e.data,d=e.elementSize,p=t.boundingSphereRadius,f=mi,y=gi,m=yi;w.pointToLocalFrame(i,o,n,m);let g=Math.floor((m.x-p)/d)-1,v=Math.ceil((m.x+p)/d)+1,b=Math.floor((m.y-p)/d)-1,x=Math.ceil((m.y+p)/d)+1;if(v<0||x<0||g>u.length||b>u[0].length)return;g<0&&(g=0),v<0&&(v=0),b<0&&(b=0),x<0&&(x=0),g>=u.length&&(g=u.length-1),v>=u.length&&(v=u.length-1),x>=u[0].length&&(x=u[0].length-1),b>=u[0].length&&(b=u[0].length-1);const A=[];e.getRectMinMax(g,b,v,x,A);const E=A[0],B=A[1];if(!(m.z-p>B||m.z+p<E))for(let l=g;l<v;l++)for(let c=b;c<x;c++){let u=!1;if(e.getConvexTrianglePillar(l,c,!1),w.pointToWorldFrame(i,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(u=this.convexConvex(t,e.pillarConvex,n,f,s,o,r,a,null,null,h,y,null)),h&&u)return!0;if(e.getConvexTrianglePillar(l,c,!0),w.pointToWorldFrame(i,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(u=this.convexConvex(t,e.pillarConvex,n,f,s,o,r,a,null,null,h,y,null)),h&&u)return!0}}sphereParticle(t,e,n,i,s,o,r,a,l,c,h){const u=ci;if(u.set(0,0,1),i.vsub(n,u),u.lengthSquared()<=t.radius*t.radius){if(h)return!0;const n=this.createContactEquation(a,r,e,t,l,c);u.normalize(),n.rj.copy(u),n.rj.scale(t.radius,n.rj),n.ni.copy(u),n.ni.negate(n.ni),n.ri.set(0,0,0),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}planeParticle(t,e,n,i,s,o,r,a,l,c,h){const u=ri;u.set(0,0,1),r.quaternion.vmult(u,u);const d=ai;if(i.vsub(r.position,d),u.dot(d)<=0){if(h)return!0;const n=this.createContactEquation(a,r,e,t,l,c);n.ni.copy(u),n.ni.negate(n.ni),n.ri.set(0,0,0);const s=li;u.scale(u.dot(i),s),i.vsub(s,s),n.rj.copy(s),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}boxParticle(t,e,n,i,s,o,r,a,l,c,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,i,s,o,r,a,t,e,h)}convexParticle(t,e,n,i,s,o,r,a,l,c,h){let u=-1;const d=di,p=fi;let f=null;const y=ui;if(y.copy(i),y.vsub(n,y),s.conjugate(hi),hi.vmult(y,y),t.pointIsInside(y)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,s),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(s);for(let e=0,n=t.faces.length;e!==n;e++){const n=[t.worldVertices[t.faces[e][0]]],s=t.worldFaceNormals[e];i.vsub(n[0],pi);const o=-s.dot(pi);if(null===f||Math.abs(o)<Math.abs(f)){if(h)return!0;f=o,u=e,d.copy(s)}}if(-1!==u){const s=this.createContactEquation(a,r,e,t,l,c);d.scale(f,p),p.vadd(i,p),p.vsub(n,p),s.rj.copy(p),d.negate(s.ni),s.ri.set(0,0,0);const o=s.ri,h=s.rj;o.vadd(i,o),o.vsub(a.position,o),h.vadd(n,h),h.vsub(r.position,h),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(t,e,n,i,s,o,r,a,l,c,h){return this.convexHeightfield(e,t,i,n,o,s,a,r,l,c,h)}particleCylinder(t,e,n,i,s,o,r,a,l,c,h){return this.convexParticle(e,t,i,n,o,s,a,r,l,c,h)}sphereTrimesh(t,e,n,i,s,o,r,a,l,c,h){const u=wn,d=vn,p=bn,f=xn,y=An,m=En,g=Cn,v=gn,b=yn,x=Pn;w.pointToLocalFrame(i,o,n,y);const A=t.radius;g.lowerBound.set(y.x-A,y.y-A,y.z-A),g.upperBound.set(y.x+A,y.y+A,y.z+A),e.getTrianglesInAABB(g,x);const E=mn,B=t.radius*t.radius;for(let s=0;s<x.length;s++)for(let u=0;u<3;u++)if(e.getVertex(e.indices[3*x[s]+u],E),E.vsub(y,b),b.lengthSquared()<=B){if(v.copy(E),w.pointToWorldFrame(i,o,v,E),E.vsub(n,b),h)return!0;let s=this.createContactEquation(r,a,t,e,l,c);s.ni.copy(b),s.ni.normalize(),s.ri.copy(s.ni),s.ri.scale(t.radius,s.ri),s.ri.vadd(n,s.ri),s.ri.vsub(r.position,s.ri),s.rj.copy(E),s.rj.vsub(a.position,s.rj),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}for(let s=0;s<x.length;s++)for(let g=0;g<3;g++){e.getVertex(e.indices[3*x[s]+g],u),e.getVertex(e.indices[3*x[s]+(g+1)%3],d),d.vsub(u,p),y.vsub(d,m);const v=m.dot(p);y.vsub(u,m);let b=m.dot(p);if(b>0&&v<0&&(y.vsub(u,m),f.copy(p),f.normalize(),b=m.dot(f),f.scale(b,m),m.vadd(u,m),m.distanceTo(y)<t.radius)){if(h)return!0;const s=this.createContactEquation(r,a,t,e,l,c);m.vsub(y,s.ni),s.ni.normalize(),s.ni.scale(t.radius,s.ri),s.ri.vadd(n,s.ri),s.ri.vsub(r.position,s.ri),w.pointToWorldFrame(i,o,m,m),m.vsub(a.position,s.rj),w.vectorToWorldFrame(o,s.ni,s.ni),w.vectorToWorldFrame(o,s.ri,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}}const S=Bn,T=Sn,C=Tn,P=fn;for(let s=0,u=x.length;s!==u;s++){e.getTriangleVertices(x[s],S,T,C),e.getNormal(x[s],P),y.vsub(S,m);let u=m.dot(P);if(P.scale(u,m),y.vsub(m,m),u=m.distanceTo(y),nt.pointInTriangle(m,S,T,C)&&u<t.radius){if(h)return!0;let s=this.createContactEquation(r,a,t,e,l,c);m.vsub(y,s.ni),s.ni.normalize(),s.ni.scale(t.radius,s.ri),s.ri.vadd(n,s.ri),s.ri.vsub(r.position,s.ri),w.pointToWorldFrame(i,o,m,m),m.vsub(a.position,s.rj),w.vectorToWorldFrame(o,s.ni,s.ni),w.vectorToWorldFrame(o,s.ri,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}}x.length=0}planeTrimesh(t,e,n,i,s,r,a,l,c,h,u){const d=new o,p=un;p.set(0,0,1),s.vmult(p,p);for(let s=0;s<e.vertices.length/3;s++){e.getVertex(s,d);const f=new o;f.copy(d),w.pointToWorldFrame(i,r,f,d);const y=dn;if(d.vsub(n,y),p.dot(y)<=0){if(u)return!0;const n=this.createContactEquation(a,l,t,e,c,h);n.ni.copy(p);const i=pn;p.scale(y.dot(p),i),d.vsub(i,i),n.ri.copy(i),n.ri.vsub(a.position,n.ri),n.rj.copy(d),n.rj.vsub(l.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}}}const sn=new o,on=new o,rn=new o,an=new o,ln=new o,cn=new f,hn=new f,un=new o,dn=new o,pn=new o,fn=new o,yn=new o;new o;const mn=new o,gn=new o,wn=new o,vn=new o,bn=new o,xn=new o,An=new o,En=new o,Bn=new o,Sn=new o,Tn=new o,Cn=new c,Pn=[],zn=new o,Mn=new o,kn=new o,In=new o,jn=new o;function Fn(t,e,n){let i=null;const s=t.length;for(let o=0;o!==s;o++){const r=t[o],a=kn;t[(o+1)%s].vsub(r,a);const l=In;a.cross(e,l);const c=jn;n.vsub(r,c);const h=l.dot(c);if(!(null===i||h>0&&!0===i||h<=0&&!1===i))return!1;null===i&&(i=h>0)}return!0}const Nn=new o,Ln=new o,Rn=new o,On=new o,qn=[new o,new o,new o,new o,new o,new o],_n=new o,Dn=new o,Vn=new o,Un=new o,Hn=new o,Wn=new o,Gn=new o,Xn=new o,Zn=new o,Yn=new o,$n=new o,Qn=new o,Kn=new o,Jn=new o;new o,new o;const ti=new o,ei=new o,ni=new o,ii=new o,si=new o,oi=new o,ri=new o,ai=new o,li=new o,ci=new o,hi=new f,ui=new o;new o;const di=new o,pi=new o,fi=new o,yi=new o,mi=new o,gi=[0],wi=new o,vi=new o;class bi{constructor(){this.current=[],this.previous=[]}getKey(t,e){if(e<t){const n=e;e=t,t=n}return t<<16|e}set(t,e){const n=this.getKey(t,e),i=this.current;let s=0;for(;n>i[s];)s++;if(n!==i[s]){for(let t=i.length-1;t>=s;t--)i[t+1]=i[t];i[s]=n}}tick(){const t=this.current;this.current=this.previous,this.previous=t,this.current.length=0}getDiff(t,e){const n=this.current,i=this.previous,s=n.length,o=i.length;let r=0;for(let e=0;e<s;e++){let s=!1;const o=n[e];for(;o>i[r];)r++;s=o===i[r],s||xi(t,o)}r=0;for(let t=0;t<o;t++){let s=!1;const o=i[t];for(;o>n[r];)r++;s=n[r]===o,s||xi(e,o)}}}function xi(t,e){t.push((4294901760&e)>>16,65535&e)}const Ai=(t,e)=>t<e?`${t}-${e}`:`${e}-${t}`;class Ei{constructor(){this.data={keys:[]}}get(t,e){const n=Ai(t,e);return this.data[n]}set(t,e,n){const i=Ai(t,e);this.get(t,e)||this.data.keys.push(i),this.data[i]=n}delete(t,e){const n=Ai(t,e),i=this.data.keys.indexOf(n);-1!==i&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const t=this.data,e=t.keys;for(;e.length>0;)delete t[e.pop()]}}class Bi extends p{constructor(t){void 0===t&&(t={}),super(),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==t.quatNormalizeSkip?t.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==t.quatNormalizeFast&&t.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,t.gravity&&this.gravity.copy(t.gravity),this.broadphase=void 0!==t.broadphase?t.broadphase:new X,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==t.solver?t.solver:new Se,this.constraints=[],this.narrowphase=new nn(this),this.collisionMatrix=new d,this.collisionMatrixPrevious=new d,this.bodyOverlapKeeper=new bi,this.shapeOverlapKeeper=new bi,this.contactmaterials=[],this.contactMaterialTable=new Ei,this.defaultMaterial=new ee("default"),this.defaultContactMaterial=new te(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(t,e){return this.contactMaterialTable.get(t.id,e.id)}collisionMatrixTick(){const t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(t){this.constraints.push(t)}removeConstraint(t){const e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)}rayTest(t,e,n){n instanceof Z?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)}raycastAll(t,e,n,i){return void 0===n&&(n={}),n.mode=nt.ALL,n.from=t,n.to=e,n.callback=i,Si.intersectWorld(this,n)}raycastAny(t,e,n,i){return void 0===n&&(n={}),n.mode=nt.ANY,n.from=t,n.to=e,n.result=i,Si.intersectWorld(this,n)}raycastClosest(t,e,n,i){return void 0===n&&(n={}),n.mode=nt.CLOSEST,n.from=t,n.to=e,n.result=i,Si.intersectWorld(this,n)}addBody(t){this.bodies.includes(t)||(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof P&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))}removeBody(t){t.world=null;const e=this.bodies.length-1,n=this.bodies,i=n.indexOf(t);if(-1!==i){n.splice(i,1);for(let t=0;t!==n.length;t++)n[t].index=t;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(t){return this.idToBodyMap[t]}getShapeById(t){const e=this.bodies;for(let n=0;n<e.length;n++){const i=e[n].shapes;for(let e=0;e<i.length;e++){const n=i[e];if(n.id===t)return n}}return null}addContactMaterial(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)}removeContactMaterial(t){const e=this.contactmaterials.indexOf(t);-1!==e&&(this.contactmaterials.splice(e,1),this.contactMaterialTable.delete(t.materials[0].id,t.materials[1].id))}fixedStep(t,e){void 0===t&&(t=1/60),void 0===e&&(e=10);const n=Ti.now()/1e3;if(this.lastCallTime){const i=n-this.lastCallTime;this.step(t,i,e)}else this.step(t,void 0,e);this.lastCallTime=n}step(t,e,n){if(void 0===n&&(n=10),void 0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;const i=Ti.now();let s=0;for(;this.accumulator>=t&&s<n&&(this.internalStep(t),this.accumulator-=t,s++,!(Ti.now()-i>1e3*t)););this.accumulator=this.accumulator%t;const o=this.accumulator/t;for(let t=0;t!==this.bodies.length;t++){const e=this.bodies[t];e.previousPosition.lerp(e.position,o,e.interpolatedPosition),e.previousQuaternion.slerp(e.quaternion,o,e.interpolatedQuaternion),e.previousQuaternion.normalize()}this.time+=e}}internalStep(t){this.dt=t;const e=this.contacts,n=Ii,i=ji,s=this.bodies.length,o=this.bodies,r=this.solver,a=this.gravity,l=this.doProfiling,c=this.profile,h=P.DYNAMIC;let u=-1/0;const d=this.constraints,p=ki;a.length();const f=a.x,y=a.y,m=a.z;let g=0;for(l&&(u=Ti.now()),g=0;g!==s;g++){const t=o[g];if(t.type===h){const e=t.force,n=t.mass;e.x+=n*f,e.y+=n*y,e.z+=n*m}}for(let t=0,e=this.subsystems.length;t!==e;t++)this.subsystems[t].update();l&&(u=Ti.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),l&&(c.broadphase=Ti.now()-u);let w=d.length;for(g=0;g!==w;g++){const t=d[g];if(!t.collideConnected)for(let e=n.length-1;e>=0;e-=1)(t.bodyA===n[e]&&t.bodyB===i[e]||t.bodyB===n[e]&&t.bodyA===i[e])&&(n.splice(e,1),i.splice(e,1))}this.collisionMatrixTick(),l&&(u=Ti.now());const v=Mi,b=e.length;for(g=0;g!==b;g++)v.push(e[g]);e.length=0;const x=this.frictionEquations.length;for(g=0;g!==x;g++)p.push(this.frictionEquations[g]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,e,v,this.frictionEquations,p),l&&(c.narrowphase=Ti.now()-u),l&&(u=Ti.now()),g=0;g<this.frictionEquations.length;g++)r.addEquation(this.frictionEquations[g]);const A=e.length;for(let t=0;t!==A;t++){const n=e[t],i=n.bi,s=n.bj,o=n.si,a=n.sj;let l;l=i.material&&s.material&&this.getContactMaterial(i.material,s.material)||this.defaultContactMaterial,l.friction,i.material&&s.material&&(i.material.friction>=0&&s.material.friction>=0&&(i.material.friction,s.material.friction),i.material.restitution>=0&&s.material.restitution>=0&&(n.restitution=i.material.restitution*s.material.restitution)),r.addEquation(n),i.allowSleep&&i.type===P.DYNAMIC&&i.sleepState===P.SLEEPING&&s.sleepState===P.AWAKE&&s.type!==P.STATIC&&s.velocity.lengthSquared()+s.angularVelocity.lengthSquared()>=2*s.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0),s.allowSleep&&s.type===P.DYNAMIC&&s.sleepState===P.SLEEPING&&i.sleepState===P.AWAKE&&i.type!==P.STATIC&&i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(s.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(i,s,!0),this.collisionMatrixPrevious.get(i,s)||(zi.body=s,zi.contact=n,i.dispatchEvent(zi),zi.body=i,s.dispatchEvent(zi)),this.bodyOverlapKeeper.set(i.id,s.id),this.shapeOverlapKeeper.set(o.id,a.id)}for(this.emitContactEvents(),l&&(c.makeContactConstraints=Ti.now()-u,u=Ti.now()),g=0;g!==s;g++){const t=o[g];t.wakeUpAfterNarrowphase&&(t.wakeUp(),t.wakeUpAfterNarrowphase=!1)}for(w=d.length,g=0;g!==w;g++){const t=d[g];t.update();for(let e=0,n=t.equations.length;e!==n;e++){const n=t.equations[e];r.addEquation(n)}}r.solve(t,this),l&&(c.solve=Ti.now()-u),r.removeAllEquations();const E=Math.pow;for(g=0;g!==s;g++){const e=o[g];if(e.type&h){const n=E(1-e.linearDamping,t),i=e.velocity;i.scale(n,i);const s=e.angularVelocity;if(s){const n=E(1-e.angularDamping,t);s.scale(n,s)}}}this.dispatchEvent(Pi),l&&(u=Ti.now());const B=this.stepnumber%(this.quatNormalizeSkip+1)==0,S=this.quatNormalizeFast;for(g=0;g!==s;g++)o[g].integrate(t,B,S);this.clearForces(),this.broadphase.dirty=!0,l&&(c.integrate=Ti.now()-u),this.stepnumber+=1,this.dispatchEvent(Ci);let T=!0;if(this.allowSleep)for(T=!1,g=0;g!==s;g++){const t=o[g];t.sleepTick(this.time),t.sleepState!==P.SLEEPING&&(T=!0)}this.hasActiveBodies=T}emitContactEvents(){const t=this.hasAnyEventListener("beginContact"),e=this.hasAnyEventListener("endContact");if((t||e)&&this.bodyOverlapKeeper.getDiff(Fi,Ni),t){for(let t=0,e=Fi.length;t<e;t+=2)Li.bodyA=this.getBodyById(Fi[t]),Li.bodyB=this.getBodyById(Fi[t+1]),this.dispatchEvent(Li);Li.bodyA=Li.bodyB=null}if(e){for(let t=0,e=Ni.length;t<e;t+=2)Ri.bodyA=this.getBodyById(Ni[t]),Ri.bodyB=this.getBodyById(Ni[t+1]),this.dispatchEvent(Ri);Ri.bodyA=Ri.bodyB=null}Fi.length=Ni.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(Fi,Ni),n){for(let t=0,e=Fi.length;t<e;t+=2){const e=this.getShapeById(Fi[t]),n=this.getShapeById(Fi[t+1]);Oi.shapeA=e,Oi.shapeB=n,e&&(Oi.bodyA=e.body),n&&(Oi.bodyB=n.body),this.dispatchEvent(Oi)}Oi.bodyA=Oi.bodyB=Oi.shapeA=Oi.shapeB=null}if(i){for(let t=0,e=Ni.length;t<e;t+=2){const e=this.getShapeById(Ni[t]),n=this.getShapeById(Ni[t+1]);qi.shapeA=e,qi.shapeB=n,e&&(qi.bodyA=e.body),n&&(qi.bodyB=n.body),this.dispatchEvent(qi)}qi.bodyA=qi.bodyB=qi.shapeA=qi.shapeB=null}}clearForces(){const t=this.bodies,e=t.length;for(let n=0;n!==e;n++){const e=t[n];e.force,e.torque,e.force.set(0,0,0),e.torque.set(0,0,0)}}}new c;const Si=new nt,Ti=globalThis.performance||{};if(!Ti.now){let t=Date.now();Ti.timing&&Ti.timing.navigationStart&&(t=Ti.timing.navigationStart),Ti.now=()=>Date.now()-t}new o;const Ci={type:"postStep"},Pi={type:"preStep"},zi={type:P.COLLIDE_EVENT_NAME,body:null,contact:null},Mi=[],ki=[],Ii=[],ji=[],Fi=[],Ni=[],Li={type:"beginContact",bodyA:null,bodyB:null},Ri={type:"endContact",bodyA:null,bodyB:null},Oi={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},qi={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null}},3330:function(t,e,n){"use strict";n.d(e,{y:function(){return u}});var i=n(2988);class s{constructor(t){this.top=0,this.array=new Float32Array(t)}write(t){this.array[this.top++]=t.x,this.array[this.top++]=t.y,this.array[this.top++]=t.z}}class o{constructor(t){this.top=0,this.array=new Float32Array(t)}write(t){this.array[this.top++]=t.x,this.array[this.top++]=t.y}}class r{constructor(t){this.plane=null,this.front=null,this.back=null,this.polygons=[],t&&this.build(t)}clone(){const t=new r;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map((t=>t.clone())),t}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const t=this.front;this.front=this.back,this.back=t}clipPolygons(t){if(!this.plane)return t.slice();let e=new Array,n=new Array;for(let i=0;i<t.length;i++)this.plane.splitPolygon(t[i],e,n,e,n);return this.front&&(e=this.front.clipPolygons(e)),n=this.back?this.back.clipPolygons(n):[],e.concat(n)}clipTo(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)}allPolygons(){let t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t}build(t){if(!t.length)return;this.plane||(this.plane=t[0].plane.clone());const e=[],n=[];for(let i=0;i<t.length;i++)this.plane.splitPolygon(t[i],this.polygons,this.polygons,e,n);e.length&&(this.front||(this.front=new r),this.front.build(e)),n.length&&(this.back||(this.back=new r),this.back.build(n))}}class a{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new a(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}times(t){return this.x*=t,this.y*=t,this.z*=t,this}dividedBy(t){return this.x/=t,this.y/=t,this.z/=t,this}lerp(t,e){return this.add((new a).copy(t).sub(this).times(e))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(t){const e=this.clone(),n=e.x,i=e.y,s=e.z,o=t.x,r=t.y,a=t.z;return this.x=i*a-s*r,this.y=s*o-n*a,this.z=n*r-i*o,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}toVector3(){return new i.Pa4(this.x,this.y,this.z)}}class l{constructor(t,e){this.normal=t,this.w=e,this.normal=t,this.w=e}clone(){return new l(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(t,e,n,i,s){let o=0;const r=[];for(let e=0;e<t.vertices.length;e++){const n=this.normal.dot(t.vertices[e].pos)-this.w,i=n<-l.EPSILON?2:n>l.EPSILON?1:0;o|=i,r.push(i)}switch(o){case 0:(this.normal.dot(t.plane.normal)>0?e:n).push(t);break;case 1:i.push(t);break;case 2:s.push(t);break;case 3:{const e=[],n=[];for(let i=0;i<t.vertices.length;i++){const s=(i+1)%t.vertices.length,o=r[i],l=r[s],c=t.vertices[i],h=t.vertices[s];if(2!=o&&e.push(c),1!=o&&n.push(2!=o?c.clone():c),3==(o|l)){const t=(this.w-this.normal.dot(c.pos))/this.normal.dot((new a).copy(h.pos).sub(c.pos)),i=c.interpolate(h,t);e.push(i),n.push(i.clone())}}e.length>=3&&i.push(new c(e,t.shared)),n.length>=3&&s.push(new c(n,t.shared));break}}}static fromPoints(t,e,n){const i=(new a).copy(e).sub(t).cross((new a).copy(n).sub(t)).normalize();return new l(i.clone(),i.dot(t))}}l.EPSILON=1e-5;class c{constructor(t,e){this.vertices=t,this.shared=e,this.plane=l.fromPoints(t[0].pos,t[1].pos,t[2].pos)}clone(){return new c(this.vertices.map((t=>t.clone())),this.shared)}flip(){this.vertices.reverse().map((t=>t.flip())),this.plane.flip()}}class h{constructor(t,e,n,i){this.pos=(new a).copy(t),this.normal=(new a).copy(e),this.uv=(new a).copy(n),this.uv.z=0,i&&(this.color=(new a).copy(i))}clone(){return new h(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(t,e){return new h(this.pos.clone().lerp(t.pos,e),this.normal.clone().lerp(t.normal,e),this.uv.clone().lerp(t.uv,e),this.color&&t.color&&this.color.clone().lerp(t.color,e))}}class u{constructor(){this.polygons=new Array}static fromPolygons(t){const e=new u;return e.polygons=t,e}static fromGeometry(t,e){let n=[];const i=t.attributes.position,s=t.attributes.normal,o=t.attributes.uv,r=t.attributes.color,l=t.groups;let d;if(t.index)d=t.index.array;else{d=new Array(i.array.length/i.itemSize|0);for(let t=0;t<d.length;t++)d[t]=t}const p=d.length/3|0;n=new Array(p);for(let t=0,u=0,p=d.length;t<p;t+=3,u++){const p=new Array(3);for(let e=0;e<3;e++){const n=d[t+e],l=3*n,c=2*n,u=i.array[l],f=i.array[l+1],y=i.array[l+2],m=s.array[l],g=s.array[l+1],w=s.array[l+2],v=null==o?void 0:o.array[c],b=null==o?void 0:o.array[c+1];p[e]=new h(new a(u,f,y),new a(m,g,w),new a(v,b,0),r&&new a(r.array[c],r.array[c+1],r.array[c+2]))}if(void 0===e&&l&&l.length>0)for(const e of l)t>=e.start&&t<e.start+e.count&&(n[u]=new c(p,e.materialIndex));else n[u]=new c(p,e)}return u.fromPolygons(n.filter((t=>!isNaN(t.plane.normal.x))))}static toGeometry(t,e){let n=0;const r=t.polygons;for(const t of r)n+=t.vertices.length-2;const a=new i.u9r,l=new s(3*n*3),c=new s(3*n*3),h=new o(2*n*3);let u;const d=[],p=[];for(const t of r){const e=t.vertices,i=e.length;void 0!==t.shared&&(d[t.shared]||(d[t.shared]=[])),i&&void 0!==e[0].color&&(u||(u=new s(3*n*3)));for(let n=3;n<=i;n++)(void 0===t.shared?p:d[t.shared]).push(l.top/3,l.top/3+1,l.top/3+2),l.write(e[0].pos),l.write(e[n-2].pos),l.write(e[n-1].pos),c.write(e[0].normal),c.write(e[n-2].normal),c.write(e[n-1].normal),h&&(h.write(e[0].uv),h.write(e[n-2].uv),h.write(e[n-1].uv)),u&&(u.write(e[0].color),u.write(e[n-2].color),u.write(e[n-1].color))}a.setAttribute("position",new i.TlE(l.array,3)),a.setAttribute("normal",new i.TlE(c.array,3)),h&&a.setAttribute("uv",new i.TlE(h.array,2)),u&&a.setAttribute("color",new i.TlE(u.array,3));for(let t=0;t<d.length;t++)void 0===d[t]&&(d[t]=[]);if(d.length){let t=[],e=0;for(let n=0;n<d.length;n++)a.addGroup(e,d[n].length,n),e+=d[n].length,t=t.concat(d[n]);a.addGroup(e,p.length,d.length),t=t.concat(p),a.setIndex(t)}const f=(new i.yGw).copy(e).invert();return a.applyMatrix4(f),a.computeBoundingSphere(),a.computeBoundingBox(),a}static fromMesh(t,e){const n=u.fromGeometry(t.geometry,e),s=new i.Pa4,o=new i.Vkp;o.getNormalMatrix(t.matrix);for(let e=0;e<n.polygons.length;e++){const i=n.polygons[e];for(let e=0;e<i.vertices.length;e++){const n=i.vertices[e];n.pos.copy(s.copy(n.pos.toVector3()).applyMatrix4(t.matrix)),n.normal.copy(s.copy(n.normal.toVector3()).applyMatrix3(o))}}return n}static toMesh(t,e,n){const s=u.toGeometry(t,e),o=new i.Kj0(s,n);return o.matrix.copy(e),o.matrix.decompose(o.position,o.quaternion,o.scale),o.rotation.setFromQuaternion(o.quaternion),o.updateMatrixWorld(),o.castShadow=o.receiveShadow=!0,o}static union(t,e){const n=u.fromMesh(t),i=u.fromMesh(e);return u.toMesh(n.union(i),t.matrix,t.material)}static subtract(t,e){const n=u.fromMesh(t),i=u.fromMesh(e);return u.toMesh(n.subtract(i),t.matrix,t.material)}static intersect(t,e){const n=u.fromMesh(t),i=u.fromMesh(e);return u.toMesh(n.intersect(i),t.matrix,t.material)}clone(){const t=new u;return t.polygons=this.polygons.map((t=>t.clone())).filter((t=>Number.isFinite(t.plane.w))),t}toPolygons(){return this.polygons}union(t){const e=new r(this.clone().polygons),n=new r(t.clone().polygons);return e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),u.fromPolygons(e.allPolygons())}subtract(t){const e=new r(this.clone().polygons),n=new r(t.clone().polygons);return e.invert(),e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),e.invert(),u.fromPolygons(e.allPolygons())}intersect(t){const e=new r(this.clone().polygons),n=new r(t.clone().polygons);return e.invert(),n.clipTo(e),n.invert(),e.clipTo(n),n.clipTo(e),e.build(n.allPolygons()),e.invert(),u.fromPolygons(e.allPolygons())}inverse(){const t=this.clone();for(const e of t.polygons)e.flip();return t}toMesh(t,e){return u.toMesh(this,t,e)}toGeometry(t){return u.toGeometry(this,t)}}},1:function(t){self,t.exports=function(){"use strict";var t={820:function(t,e,n){var i=n(537),s=n.n(i),o=n(645),r=n.n(o)()(s());r.push([t.id,".treejs {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  font-size: 14px;\n  margin-left: -18px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.treejs *:after,\n.treejs *:before {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.treejs > .treejs-node {\n  padding-left: 0;\n}\n.treejs .treejs-nodes {\n  list-style: none;\n  padding-left: 18px;\n  margin: 0;\n  overflow: hidden;\n  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;\n  -o-transition: height 150ms ease-out, opacity 150ms ease-out;\n  transition: height 150ms ease-out, opacity 150ms ease-out;\n}\n.treejs .treejs-node {\n  cursor: pointer;\n  overflow: hidden;\n}\n.treejs .treejs-node.treejs-placeholder {\n  padding-left: 18px;\n}\n.treejs .treejs-switcher {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n  -webkit-transition: -webkit-transform 150ms ease-out;\n  transition: -webkit-transform 150ms ease-out;\n  -o-transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;\n}\n.treejs .treejs-switcher:before {\n  position: absolute;\n  top: 8px;\n  left: 6px;\n  display: block;\n  content: ' ';\n  border: 4px solid transparent;\n  border-top: 4px solid rgba(245, 245, 245, 0.7);\n  -webkit-transition: border-color 150ms;\n  -o-transition: border-color 150ms;\n  transition: border-color 150ms;\n}\n.treejs .treejs-switcher:hover:before {\n  border-top: 4px solid rgba(245, 245, 245, 0.96);\n}\n.treejs .treejs-node__close > .treejs-switcher {\n  -webkit-transform: rotate(-90deg);\n      -ms-transform: rotate(-90deg);\n          transform: rotate(-90deg);\n}\n.treejs .treejs-node__close > .treejs-nodes {\n  height: 0;\n}\n.treejs .treejs-checkbox {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n}\n.treejs .treejs-checkbox:before {\n  -webkit-transition: all 0.3s;\n  -o-transition: all 0.3s;\n  transition: all 0.3s;\n  cursor: pointer;\n  position: absolute;\n  top: 2px;\n  content: ' ';\n  display: block;\n  width: 16px;\n  height: 16px;\n  border: 1px solid #d9d9d9;\n  border-radius: 2px;\n}\n.treejs .treejs-checkbox:hover:before {\n  -webkit-box-shadow: 0 0 2px 1px #1890ff;\n          box-shadow: 0 0 2px 1px #1890ff;\n}\n.treejs .treejs-node__checked > .treejs-checkbox:before {\n  background-color: #1890ff;\n  border-color: #1890ff;\n}\n.treejs .treejs-node__checked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 4px;\n  left: 5px;\n  width: 5px;\n  height: 9px;\n  border: 2px solid #fff;\n  border-top: none;\n  border-left: none;\n  -webkit-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n          transform: rotate(45deg);\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:before {\n  background-color: #1890ff;\n  border-color: #1890ff;\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 9px;\n  left: 3px;\n  width: 10px;\n  height: 2px;\n  background-color: #fff;\n}\n.treejs .treejs-node__disabled {\n  cursor: not-allowed;\n  color: rgba(255, 255, 255, 0.25);\n}\n.treejs .treejs-node__disabled .treejs-checkbox {\n  cursor: not-allowed;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:before {\n  cursor: not-allowed;\n  border-color: #d9d9d9 !important;\n  background-color: #f5f5f5 !important;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:hover:before {\n  -webkit-box-shadow: none !important;\n          box-shadow: none !important;\n}\n.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {\n  border-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {\n  border-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: #d9d9d9;\n}\n.treejs .treejs-label {\n  vertical-align: middle;\n}\n","",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:["@color-disable: #d4d4d4;\n@bgcolor-disable: #f5f5f5;\n@greyborder: #d9d9d9;\n@bluebg: #1890ff;\n\n.treejs {\n  box-sizing: border-box;\n  font-size: 14px;\n  margin-left: -18px;\n  user-select: none;\n\n  *:after,\n  *:before {\n    box-sizing: border-box;\n  }\n\n  & > .treejs-node {\n    padding-left: 0;\n  }\n\n  .treejs-nodes {\n    list-style: none;\n    padding-left: 18px;\n    margin: 0; //  for default ul...\n    overflow: hidden;\n    transition: height 150ms ease-out, opacity 150ms ease-out;\n  }\n\n  .treejs-node {\n    cursor: pointer;\n    overflow: hidden;\n\n    &.treejs-placeholder {\n      padding-left: 18px;\n    }\n  }\n\n  .treejs-switcher {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    position: relative;\n    transition: transform 150ms ease-out;\n\n    &:before {\n      position: absolute;\n      top: 8px;\n      left: 6px;\n      display: block;\n      content: ' ';\n      border: 4px solid transparent;\n      border-top: 4px solid rgba(245, 245, 245, 0.7);\n      transition: border-color 150ms;\n    }\n    &:hover:before {\n      border-top: 4px solid rgba(245, 245, 245, 0.96);\n    }\n  }\n  .treejs-node__close > .treejs-switcher {\n    transform: rotate(-90deg);\n  }\n  .treejs-node__close > .treejs-nodes {\n    height: 0;\n  }\n\n  .treejs-checkbox {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    position: relative;\n\n    &:before {\n      transition: all 0.3s;\n      cursor: pointer;\n      position: absolute;\n      top: 2px;\n      content: ' ';\n      display: block;\n      width: 16px;\n      height: 16px;\n      border: 1px solid @greyborder;\n      border-radius: 2px;\n    }\n    &:hover:before {\n      box-shadow: 0 0 2px 1px @bluebg;\n    }\n  }\n  .treejs-node__checked {\n    & > .treejs-checkbox {\n      &:before {\n        background-color: @bluebg;\n        border-color: @bluebg;\n      }\n      &:after {\n        position: absolute;\n        content: ' ';\n        display: block;\n        top: 4px;\n        left: 5px;\n        width: 5px;\n        height: 9px;\n        border: 2px solid #fff;\n        border-top: none;\n        border-left: none;\n        transform: rotate(45deg);\n      }\n    }\n  }\n  .treejs-node__halfchecked {\n    & > .treejs-checkbox {\n      &:before {\n        background-color: @bluebg;\n        border-color: @bluebg;\n      }\n      &:after {\n        position: absolute;\n        content: ' ';\n        display: block;\n        top: 9px;\n        left: 3px;\n        width: 10px;\n        height: 2px;\n        background-color: #fff;\n      }\n    }\n  }\n\n  .treejs-node__disabled {\n    cursor: not-allowed;\n    color: rgba(255, 255, 255, 0.25);\n    .treejs-checkbox {\n      cursor: not-allowed;\n      &:before {\n        cursor: not-allowed;\n        border-color: @greyborder !important;\n        background-color: @bgcolor-disable !important;\n      }\n      &:hover:before {\n        box-shadow: none !important;\n      }\n    }\n    .treejs-node__checked {\n      & > .treejs-checkbox {\n        &:after {\n          border-color: @greyborder;\n        }\n      }\n    }\n    .treejs-node__halfchecked {\n      & > .treejs-checkbox {\n        &:after {\n          background-color: @greyborder;\n        }\n      }\n    }\n  }\n  .treejs-node__disabled.treejs-node__checked {\n    & > .treejs-checkbox {\n      &:after {\n        border-color: @greyborder;\n      }\n    }\n  }\n  .treejs-node__disabled.treejs-node__halfchecked {\n    & > .treejs-checkbox {\n      &:after {\n        background-color: @greyborder;\n      }\n    }\n  }\n\n  .treejs-label {\n    vertical-align: middle;\n  }\n}\n"],sourceRoot:""}]),e.Z=r},645:function(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,s,o){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var c=0;c<t.length;c++){var h=[].concat(t[c]);i&&r[h[0]]||(void 0!==o&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=o),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),s&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=s):h[4]="".concat(s)),e.push(h))}},e}},537:function(t){t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(s," */"),r=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(r).concat([o]).join("\n")}return[e].join("\n")}},379:function(t){var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var o={},r=[],a=0;a<t.length;a++){var l=t[a],c=i.base?l[0]+i.base:l[0],h=o[c]||0,u="".concat(c," ").concat(h);o[c]=h+1;var d=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var f=s(p,i);i.byIndex=a,e.splice(a,0,{identifier:u,updater:f,references:1})}r.push(u)}return r}function s(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,s){var o=i(t=t||[],s=s||{});return function(t){t=t||[];for(var r=0;r<o.length;r++){var a=n(o[r]);e[a].references--}for(var l=i(t,s),c=0;c<o.length;c++){var h=n(o[c]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}o=l}}},216:function(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},636:function(t,e,n){t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:function(t){t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,s&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/",i+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," *"),i+="/"),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:function(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={id:i,exports:{}};return t[i](o,o.exports,n),o.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.nc=void 0;var i={};return function(){n.d(i,{default:function(){return P}});var t=n(379),e=n.n(t),s=n(795),o=n.n(s),r=n(636),a=n.n(r),l=n(216),c=n.n(l),h=n(589),u=n.n(h),d=n(820),p={};d.Z&&d.Z.locals&&(p.locals=d.Z.locals);var f,y=0,m={};m.styleTagTransform=u(),m.setAttributes=a(),m.insert=function(t,e){(e.target||document.head).appendChild(t)},m.domAPI=o(),m.insertStyleElement=c(),p.use=function(t){return m.options=t||{},y++||(f=e()(d.Z,m)),p},p.unuse=function(){y>0&&!--y&&(f(),f=null)};var g=p;function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,s,o=[],r=!0,a=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);r=!0);}catch(t){a=!0,s=t}finally{try{r||null==n.return||n.return()}finally{if(a)throw s}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){A(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function A(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function E(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function B(t){var e={};return t.reduce((function(t,n){return e[n]||(e[n]=!0,t.push(n)),t}),[])}function S(t,e){requestAnimationFrame((function(){e.enter(),requestAnimationFrame((function(){e.active(),setTimeout((function(){e.leave()}),t)}))}))}function T(t,e){try{var n=t.liElementsById[e.parent.id];n.classList.contains("treejs-node__close")||n.getElementsByClassName("treejs-switcher")[0].click()}catch(t){return}Object.prototype.hasOwnProperty.call(e,"parent")&&T(t,e.parent)}function C(t,e){var n=t.liElementsById[e.id];n.classList.contains("treejs-node__close")&&n.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(e,"children")&&e.children.forEach((function(e){return C(t,e)}))}var P=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),g.use({target:"string"==typeof this.container?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=e,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},n),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(t){this.setValues(B(t))}},disables:{get:function(){return this.getDisables()},set:function(t){this.setDisables(B(t))}},selectedNodes:{get:function(){var t=[],e=this.nodesById;return Object.keys(e).forEach((function(n){if(Object.prototype.hasOwnProperty.call(e,n)&&(1===e[n].status||2===e[n].status)){var i=x({},e[n]);delete i.parent,delete i.children,t.push(i)}})),t}},disabledNodes:{get:function(){var t=[],e=this.nodesById;return Object.keys(e).forEach((function(n){if(Object.prototype.hasOwnProperty.call(e,n)&&e[n].disabled){var i=x({},e[n]);delete i.parent,t.push(i)}})),t}}}),this.init(this.options.data)}var e,n,i;return e=t,i=[{key:"onSwitcherClick",value:function(t){var e=t.parentNode,n=e.lastChild,i=n.scrollHeight;e.classList.contains("treejs-node__close")?S(150,{enter:function(){n.style.height=0,n.style.opacity=0},active:function(){n.style.height="".concat(i,"px"),n.style.opacity=1},leave:function(){n.style.height="",n.style.opacity="",e.classList.remove("treejs-node__close")}}):S(150,{enter:function(){n.style.height="".concat(i,"px"),n.style.opacity=1},active:function(){n.style.height=0,n.style.opacity=0},leave:function(){n.style.height="",n.style.opacity="",e.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(t){var e,n=(e=t,JSON.parse(JSON.stringify(e))),i={},s={},o=[],r=[];return function t(e,n){e.forEach((function(e){i[e.id]=e,e.checked&&o.push(e.id),e.disabled&&r.push(e.id),n&&(e.parent=n),e.children&&e.children.length?t(e.children,e):s[e.id]=e}))}(n),{treeNodes:n,nodesById:i,leafNodesById:s,defaultValues:o,defaultDisables:r}}},{key:"createRootEle",value:function(){var t=document.createElement("div");return t.classList.add("treejs"),t}},{key:"createUlEle",value:function(){var t=document.createElement("ul");return t.classList.add("treejs-nodes"),t}},{key:"createLiEle",value:function(t,e){var n=document.createElement("li");if(n.classList.add("treejs-node"),e&&n.classList.add("treejs-node__close"),t.children&&t.children.length){var i=document.createElement("span");i.classList.add("treejs-switcher"),n.appendChild(i)}else n.classList.add("treejs-placeholder");var s=document.createElement("span");s.classList.add("treejs-checkbox"),n.appendChild(s);var o=document.createElement("span");o.classList.add("treejs-label");var r=document.createTextNode(t.text);return o.appendChild(r),n.appendChild(o),n.nodeId=t.id,n}}],(n=[{key:"init",value:function(e){var n=t.parseTreeData(e),i=n.treeNodes,s=n.nodesById,o=n.leafNodesById,r=n.defaultValues,a=n.defaultDisables;this.treeNodes=i,this.nodesById=s,this.leafNodesById=o,this.render(this.treeNodes);var l=this.options,c=l.values,h=l.disables,u=l.loaded;c&&c.length?this.setValues(c):r&&r.length&&this.setValues(r),h&&h.length?this.setDisables(h):a&&a.length&&this.setDisables(a),"function"==typeof u&&u.call(this)}},{key:"render",value:function(e){var n=t.createRootEle();n.appendChild(this.buildTree(e,0)),this.bindEvent(n);var i="string"==typeof this.container?document.querySelector(this.container):this.container;!function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(i),i.appendChild(n)}},{key:"buildTree",value:function(e,n){var i=this,s=t.createUlEle();return e&&e.length&&e.forEach((function(e){var o=t.createLiEle(e,n===i.options.closeDepth-1);i.liElementsById[e.id]=o;var r=null;e.children&&e.children.length&&(r=i.buildTree(e.children,n+1)),r&&o.appendChild(r),s.appendChild(o)})),s}},{key:"bindEvent",value:function(e){var n=this;e.addEventListener("click",(function(e){var i=e.target;"SPAN"===i.nodeName&&i.classList.contains("treejs-checkbox")?n.onItemClick(i.parentNode.nodeId):"SPAN"===i.nodeName&&i.classList.contains("treejs-label")?n.onItemLabelClick(i.parentNode.nodeId):"LI"===i.nodeName&&i.classList.contains("treejs-node")?n.onItemClick(i.nodeId):"SPAN"===i.nodeName&&i.classList.contains("treejs-switcher")&&t.onSwitcherClick(i)}),!1)}},{key:"onItemClick",value:function(t){var e=this.nodesById[t],n=this.options.onChange;e.disabled||(this.setValue(t),this.updateLiElements()),n&&n.call(this)}},{key:"onItemLabelClick",value:function(t){var e=this.options.onItemLabelClick;e&&e.call(this,t)}},{key:"setValue",value:function(t){var e=this.nodesById[t];if(e){var n=e.status,i=1===n||2===n?0:2;e.status=i,this.markWillUpdateNode(e),this.walkUp(e,"status"),this.walkDown(e,"status")}}},{key:"getValues",value:function(){var t=this,e=[];return Object.keys(this.leafNodesById).forEach((function(n){Object.prototype.hasOwnProperty.call(t.leafNodesById,n)&&(1!==t.leafNodesById[n].status&&2!==t.leafNodesById[n].status||e.push(n))})),e}},{key:"setValues",value:function(t){var e=this;this.emptyNodesCheckStatus(),t.forEach((function(t){e.setValue(t)})),this.updateLiElements();var n=this.options.onChange;n&&n.call(this)}},{key:"setDisable",value:function(t){var e=this.nodesById[t];e&&(e.disabled||(e.disabled=!0,this.markWillUpdateNode(e),this.walkUp(e,"disabled"),this.walkDown(e,"disabled")))}},{key:"getDisables",value:function(){var t=this,e=[];return Object.keys(this.leafNodesById).forEach((function(n){Object.prototype.hasOwnProperty.call(t.leafNodesById,n)&&t.leafNodesById[n].disabled&&e.push(n)})),e}},{key:"setDisables",value:function(t){var e=this;this.emptyNodesDisable(),t.forEach((function(t){e.setDisable(t)})),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach((function(t){t.disabled||(t.status=0)}))}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach((function(t){t.disabled=!1}))}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce((function(t,e){var n=w(e,2),i=n[0],s=n[1];return 1!==s.status&&2!==s.status||(t[i]=s),t}),{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce((function(t,e){var n=w(e,2),i=n[0],s=n[1];return s.disabled&&(t[i]=s),t}),{})}},{key:"updateLiElements",value:function(){var t=this;Object.values(this.willUpdateNodesById).forEach((function(e){t.updateLiElement(e)})),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(t){this.willUpdateNodesById[t.id]=t}},{key:"walkUp",value:function(t,e){var n=t.parent;if(n){if("status"===e){var i,s=n.children.reduce((function(t,e){return Number.isNaN(e.status)?t:t+e.status}),0);if(i=s?s===2*n.children.length?2:1:0,n.status===i)return;n.status=i}else{var o=n.children.reduce((function(t,e){return t&&e.disabled}),!0);if(n.disabled===o)return;n.disabled=o}this.markWillUpdateNode(n),this.walkUp(n,e)}}},{key:"walkDown",value:function(t,e){var n=this;t.children&&t.children.length&&t.children.forEach((function(i){"status"===e&&i.disabled||(i[e]=t[e],n.markWillUpdateNode(i),n.walkDown(i,e))}))}},{key:"updateLiElement",value:function(t){var e=this.liElementsById[t.id].classList;switch(t.status){case 0:e.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:e.remove("treejs-node__checked"),e.add("treejs-node__halfchecked");break;case 2:e.remove("treejs-node__halfchecked"),e.add("treejs-node__checked")}switch(t.disabled){case!0:e.contains("treejs-node__disabled")||e.add("treejs-node__disabled");break;case!1:e.contains("treejs-node__disabled")&&e.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var t=this;Object.keys(this.leafNodesById).forEach((function(e){var n=t.leafNodesById[e];T(t,n)}))}},{key:"expandAll",value:function(){C(this,this.treeNodes[0])}}])&&E(e.prototype,n),i&&E(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}()}(),i.default}()},8466:function(t,e,n){"use strict";var i=n(1),s=n.n(i);e.Z=s()},1196:function(t,e,n){"use strict";var i=n(7282),s=n(3615);let o={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},r={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};e.Z=class{constructor(t){this.options=JSON.parse(JSON.stringify(o));for(let e in t)null!=t[e]&&(this.options[e]=t[e]);let e=this.options,n=JSON.parse(JSON.stringify(r));for(let t in n)e.hasOwnProperty(t)&&(n[t]=e[t]);let a=[];e.showCancel&&a.push({key:27,text:e.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),a.push({key:13,text:e.okText,onClick:this.handleOk.bind(this)}),n.buttons=a,this.input=i.Z.createElement("input","input",null,{placeholder:e.placeholder}),this.error=i.Z.createDiv("error"),n.content=i.Z.createDomTree({dom:i.Z.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new s.Z(n)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then((()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))}),(t=>{this.error.innerText=t})):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let t=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise(((t,e)=>{this.promiseResolve=t,this.promiseReject=e})),t}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}},3615:function(t,e,n){"use strict";n.d(e,{Z:function(){return d}});var i=n(7282),s=n(5476);var o={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let r={};r.overlay_in=[new s.Frame(o["wwise-overlay-in-1"],0),new s.Frame(o["wwise-overlay-in-2"],400)],r.overlay_out=[new s.Frame(o["wwise-overlay-out-1"],300)],r.pop_in=[new s.Frame(o["wwise-pop-in-1"],0),new s.Frame(o["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new s.Frame(o["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new s.Frame(o["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],r.pop_out=[new s.Frame(o["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],r.flip_in=[new s.Frame(o["wwise-flip-in-1"],0),new s.Frame(o["wwise-flip-in-2"],500)],r.flip_out=[new s.Frame(o["wwise-flip-out-1"],400)],r.min_in=[new s.Frame(o["wwise-min-in-1"],0),new s.Frame(o["wwise-min-in-2"],350)],r.min_out=[new s.Frame(o["wwise-min-out-1"],400)];let a=["top","bottom","left","right"];for(let t in a){let e=a[t];r[e+"_in"]=[new s.Frame(o["wwise-"+e+"-in-1"],0),new s.Frame(o["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],r[e+"_out"]=[new s.Frame(o["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var l=r;let c={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class h{static create(t,e){let n=t.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let s=t.getElementsByClassName("content")[0];return s&&(s=s.innerHTML),i.Z.removeElement(t),e.title=n,e.content=s,new h(e)}constructor(t){this.options=JSON.parse(JSON.stringify(c));for(let e in t)null!=t[e]&&(this.options[e]=t[e]);let e=this.options.position;if(-1==e.indexOf(" ")&&("left"==e||"right"==e?e+=" center":e="top"==e||"bottom"==e?"center "+e:e+" "+e),this.options.position=e,this.options.overlay){let t=document.getElementsByClassName("wwise-overlay");t.length?(this.overlay=t[0],this.hasOverlay=!0):(this.overlay=i.Z.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let t=[];this.options.topbar.showMin&&(t.push(i.Z.createDiv(null,i.Z.makeIconHTML("min"))),t[t.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(t.push(i.Z.createDiv(null,i.Z.makeIconHTML("close"))),t[t.length-1].addEventListener("click",this.close.bind(this,void 0)));let e=null;e="string"==typeof this.options.title?i.Z.createDiv("title",this.options.title):i.Z.createDomTree({dom:i.Z.createDiv("title"),children:[this.options.title]}),this.topbar=i.Z.createDomTree({dom:i.Z.createDiv("topbar"),children:[{dom:i.Z.createDiv("control"),children:t.map((t=>({dom:t})))},{dom:e},{dom:i.Z.createDiv("clear")}]})}else n+=" no-topbar";"string"==typeof this.options.content?this.content=i.Z.createDomTree({dom:i.Z.createDiv(n,this.options.content)}):this.content=i.Z.createDomTree({dom:i.Z.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=i.Z.createDomTree({dom:i.Z.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let s=i.Z.createDiv("wwise-wrapper");this.options.zIndex&&(s.style.zIndex=this.options.zIndex),this.wrapper=i.Z.createDomTree({dom:s,children:[this.window]}),this.dom=i.Z.createDomTree({dom:i.Z.createDiv(),children:[this.wrapper]});let o=this.options.position.split(" "),r=-50,a=-50;if("left"==o[0]?(r=0,this.wrapper.classList.add("left")):"right"==o[0]?(r=-100,this.wrapper.classList.add("right")):"center"==o[0]?this.wrapper.classList.add("h-center"):this.wrapper.style.left=o[0],"top"==o[1]?(a=0,this.wrapper.classList.add("top")):"bottom"==o[1]?(a=-100,this.wrapper.classList.add("bottom")):"center"==o[1]?this.wrapper.classList.add("v-center"):this.wrapper.style.top=e[1],this.window.style.transform=`translate(${r}%, ${a}%)`,this.options.style)for(let t in this.options.style)this.window.style[t]=this.options.style[t];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(t){if(this.opened)return;this.promise=new Promise((t=>{this.promiseResolve=t})),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let e=t?"min":this.options.animation;if(e){"min"!=e&&"flip"!=e||this.dom.classList.add("wwise-perspective");let t=[new s.Queue(this.wrapper,l[e+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&t.push(new s.Queue(this.overlay,l.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(t).then((()=>{this.dom.classList.remove("wwise-perspective")}))}return Promise.resolve()}close(t){if(!this.opened)return;this.opened=!1;let e=t?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),e){"min"!=e&&"flip"!=e||this.dom.classList.add("wwise-perspective");let t=[new s.Queue(this.wrapper,l[e+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&t.push(new s.Queue(this.overlay,l.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(t).then((()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()}))}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(i.Z.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",(t=>{t.preventDefault()}))),i.Z.appendToBody(this.dom)}removeDoms(){i.Z.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(i.Z.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(t=!0){this.topbar&&(t?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(t){if(this.inDragging){let e={x:t.clientX-this.dragPrev.x,y:t.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),i=this.options.draggable,s=parseFloat(n.left),o=parseFloat(n.top);if(-1!=n.left.indexOf("%")){s=n.left,s=s.substr(0,s.length-1),s=parseInt(s);let t=window,e=document,i=e.documentElement,o=e.getElementsByTagName("body")[0];s=s*(t.innerWidth||i.clientWidth||o.clientWidth)/100}if(-1!=n.top.indexOf("%")){o=n.top,o=o.substr(0,o.length-1),o=parseInt(o);let t=window,e=document,i=e.documentElement,s=e.getElementsByTagName("body")[0];o=o*(t.innerHeight||i.clientHeight||s.clientHeight)/100}1!=i&&"horizontal"!=i||(this.wrapper.style.left=s+e.x+"px"),1!=i&&"vertical"!=i||(this.wrapper.style.top=o+e.y+"px"),this.dragPrev={x:t.clientX,y:t.clientY}}}handleDraggableMouseDown(t){this.inDragging=!0,this.dragPrev={x:t.clientX,y:t.clientY}}handleDraggableMouseUp(t){this.inDragging=!1}handleDraggableMouseOut(t){let e=t.relatedTarget;e&&"HTML"!=e.nodeName||(this.inDragging=!1)}}var u=h,d=class{constructor(t){let e=this.options=t;!e.type&&(e.type="ok");let n={topbar:!1};n.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),n.overlay=!0,n.keepOverlay=e.keepOverlay,n.clickOverlayToClose=!1,n.animation=e.animation,n.zIndex=e.zIndex,this.wwise=new u(n)}constructContent(t){let e=i.Z.createDiv("modal"),n=i.Z.createDomTree({dom:i.Z.createDiv("main "+t.type),children:[i.Z.createDiv(null,i.Z.makeIconHTML(t.type)),i.Z.createDiv("title",t.title),i.Z.createDiv("text",t.text)]});this.buttonArr=i.Z.standardizeButtons(this,t);let s=i.Z.makeButtons(this.buttonArr),o=null;t.content&&(o="string"==typeof t.content?i.Z.createDiv(null,t.content):t.content);let r=null;return s.innerHTML&&(r=i.Z.createDomTree({dom:i.Z.createDiv("operation "+t.type),children:[s]})),o||r||n.classList.add("no-op"),i.Z.createDomTree({dom:e,children:[n,o,r]})}open(){if(this.wwise.opened)return;let t=this.wwise.open();return this.value=void 0,this.promise=new Promise((t=>{this.promiseResolve=t})),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=i.Z.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout((()=>{this.close("timer")}),this.options.closeAfter),t}close(t){if(this.wwise.opened)return this.value=t,i.Z.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}}},7282:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var i={create:t=>{let e="button"+(t.type?" "+t.type:""),n=o.createDiv(e,t.text);return n.addEventListener("click",t.onClick),n}};let s={createElement:(t,e,n,i)=>{let s=document.createElement(t);if(e&&(s.className=e),n&&(s.innerHTML=n),i)for(let t in i)s.setAttribute(t,i[t]);return s},createDiv:(t,e,n)=>s.createElement("div",t,e,n),createDomTree:t=>{if(!t||!t.hasOwnProperty("dom"))return t;let e=t.dom;if(t.children)for(let n in t.children)t.children[n]&&e.appendChild(s.createDomTree(t.children[n]));return e},removeElement:t=>{null!=t&&t.parentNode.removeChild(t)},appendToBody:t=>{document.body.appendChild(t)},makeIconHTML:t=>{let e="";return"ok"==t&&(e="#tick"),"error"==t&&(e="#cancel"),"info"==t&&(e="#info-button"),"caution"==t&&(e="#danger"),"min"==t&&(e="#line"),"close"==t&&(e="#close"),`<svg class="icon ${t}"><use xlink:href="${e}" /></svg>`},makeNftContent:t=>{let e=null;if(t.type){let n=null;n="string"==typeof t.content?s.createDiv("inner-content",t.content):s.createDomTree({dom:s.createDiv("inner-content"),children:[t.content]}),e="text"==t.type?s.createDomTree({dom:s.createDiv("content text"),children:[n]}):s.createDomTree({dom:s.createDiv("content"),children:[s.createDiv("state",s.makeIconHTML(t.type)),n]})}else"string"==typeof t.content&&(e=s.createDiv("content",t.content));return e},standardizeButtons:(t,e)=>{let n=[];if(void 0===e.buttons)return"caution"!=e.type&&"info"!=e.type||n.push({key:27,text:"Cancel",onClick:t.close.bind(t,"cancel")}),n.push({key:13,text:"OK",type:"main",onClick:t.close.bind(t,"ok")}),n;n=e.buttons,n.constructor!==Array&&(n=[n]);for(let e in n)!n[e].onClick&&(n[e].onClick=t.close.bind(t,n[e].id));return n},makeButtons:t=>{let e=[];if(t)for(let n in t)e.push(i.create({text:t[n].text?t[n].text:"OK",type:t[n].normal?null:"main",onClick:t[n].onClick}));return s.createDomTree({dom:s.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:t=>{let e=e=>{for(let n in t)if(t[n].key===e.keyCode)return void t[n].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:t=>{window.removeEventListener("keydown",t)}};var o=s},2778:function(t,e,n){"use strict";n.d(e,{Q:function(){return S}});var i={d:(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},s={};i.d(s,{Q:()=>B});var o=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};const r=Symbol("Comlink.proxy"),a=Symbol("Comlink.endpoint"),l=Symbol("Comlink.releaseProxy"),c=Symbol("Comlink.thrown"),h=t=>"object"==typeof t&&null!==t||"function"==typeof t,u=new Map([["proxy",{canHandle:t=>h(t)&&t[r],serialize(t){const{port1:e,port2:n}=new MessageChannel;return d(t,e),[n,[n]]},deserialize:t=>(t.start(),f(t))}],["throw",{canHandle:t=>h(t)&&c in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function d(t,e=self){e.addEventListener("message",(function n(i){if(!i||!i.data)return;const{id:s,type:o,path:r}=Object.assign({path:[]},i.data),a=(i.data.argumentList||[]).map(x);let l;try{const e=r.slice(0,-1).reduce(((t,e)=>t[e]),t),n=r.reduce(((t,e)=>t[e]),t);switch(o){case"GET":l=n;break;case"SET":e[r.slice(-1)[0]]=x(i.data.value),l=!0;break;case"APPLY":l=n.apply(e,a);break;case"CONSTRUCT":l=v(new n(...a));break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;d(t,n),l=function(t,e){return w.set(t,e),t}(e,[e])}break;case"RELEASE":l=void 0;break;default:return}}catch(t){l={value:t,[c]:0}}Promise.resolve(l).catch((t=>({value:t,[c]:0}))).then((t=>{const[i,r]=b(t);e.postMessage(Object.assign(Object.assign({},i),{id:s}),r),"RELEASE"===o&&(e.removeEventListener("message",n),p(e))}))})),e.start&&e.start()}function p(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function f(t,e){return m(t,[],e)}function y(t){if(t)throw new Error("Proxy has been released and is not useable")}function m(t,e=[],n=function(){}){let i=!1;const s=new Proxy(n,{get(n,o){if(y(i),o===l)return()=>A(t,{type:"RELEASE",path:e.map((t=>t.toString()))}).then((()=>{p(t),i=!0}));if("then"===o){if(0===e.length)return{then:()=>s};const n=A(t,{type:"GET",path:e.map((t=>t.toString()))}).then(x);return n.then.bind(n)}return m(t,[...e,o])},set(n,s,o){y(i);const[r,a]=b(o);return A(t,{type:"SET",path:[...e,s].map((t=>t.toString())),value:r},a).then(x)},apply(n,s,o){y(i);const r=e[e.length-1];if(r===a)return A(t,{type:"ENDPOINT"}).then(x);if("bind"===r)return m(t,e.slice(0,-1));const[l,c]=g(o);return A(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:l},c).then(x)},construct(n,s){y(i);const[o,r]=g(s);return A(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:o},r).then(x)}});return s}function g(t){const e=t.map(b);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const w=new WeakMap;function v(t){return Object.assign(t,{[r]:!0})}function b(t){for(const[e,n]of u)if(n.canHandle(t)){const[i,s]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},s]}return[{type:"RAW",value:t},w.get(t)||[]]}function x(t){switch(t.type){case"HANDLER":return u.get(t.name).deserialize(t.value);case"RAW":return t.value}}function A(t,e,n){return new Promise((i=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===s&&(t.removeEventListener("message",e),i(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),n)}))}class E extends class{}{init(t,e,n,i){if(!this.api){if(!i)throw new Error("workerFilePath is required");(()=>{var s,o,r;s=this,r=function*(){const s=yield fetch(i).then((t=>t.blob())),o=URL.createObjectURL(s),r=new Worker(o,{type:"module"});this.api=yield new(f(r))(v((()=>{t(),URL.revokeObjectURL(o)})),v(((t,e)=>"xatlas_web.wasm"===t?n:t+e)),v(e))},new((o=void 0)||(o=Promise))((function(t,e){function n(t){try{a(r.next(t))}catch(t){e(t)}}function i(t){try{a(r.throw(t))}catch(t){e(t)}}function a(e){var s;e.done?t(e.value):(s=e.value,s instanceof o?s:new o((function(t){t(s)}))).then(n,i)}a((r=r.apply(s,[])).next())}))})()}}}class B extends class{constructor(t,e={resolution:2048},n={},i=!1,s=!1,o=!1){this.THREE=t,this.packOptions=e,this.chartOptions=n,this.useNormals=i,this.timeUnwrap=s,this.logProgress=o,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(t,e,n){return o(this,void 0,void 0,(function*(){if(!this._libraryLoaded){for(yield new Promise(((i,s)=>{try{this.xAtlas.init((()=>{i()}),t,e,n)}catch(t){s(t)}}));!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise((t=>setTimeout(t,100)));this._libraryLoaded=!0}}))}packAtlas(t,e="uv2",n="uv"){return o(this,void 0,void 0,(function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!t)return[];if(t.length<1)return[];const i=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise((t=>setTimeout(t,100)));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let s=[],o="";for(let e of t){let{uuid:t,index:n,attributes:r}=e;const a=e.userData.worldScale||1;s.push(t),n&&r.position&&3===r.position.itemSize?(o="Mesh"+s.length+" added to atlas: "+t,this.timeUnwrap&&console.time(o),yield this.xAtlas.api.addMesh(n.array,r.position.array,r.normal?r.normal.array:void 0,r.uv?r.uv.array:void 0,t,this.useNormals,i,a),this.timeUnwrap&&console.timeEnd(o)):console.warn("xatlas-three: Geometry not supported: ",e)}o="Generated atlas with "+s.length+" meshes",this.timeUnwrap&&console.time(o);let r=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(o);let a=[];for(let i of r){let s=t.find((t=>t.uuid===i.mesh));s?(i.vertex.vertices&&s.setAttribute("position",new this.THREE.BufferAttribute(i.vertex.vertices,3,!1)),i.vertex.normals&&s.setAttribute("normal",new this.THREE.BufferAttribute(i.vertex.normals,3,!0)),i.vertex.coords1&&s.setAttribute(e,new this.THREE.BufferAttribute(i.vertex.coords1,2,!1)),i.vertex.coords&&e!==n&&s.setAttribute(n,new this.THREE.BufferAttribute(i.vertex.coords,2,!1)),i.index&&s.setIndex(new this.THREE.BufferAttribute(i.index,1,!1)),a.push(s)):console.error("xatlas-three: Mesh not found: ",i.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,a}))}unwrapGeometry(t,e="uv",n="uv2"){return o(this,void 0,void 0,(function*(){return this.packAtlas([t],e,n)}))}}{_createXAtlas(){return new E}}var S=s.Q},1815:function(t,e,n){"use strict";var i=n(5701),s=n.n(i),o=n(8236),r=n.n(o),a=n(6850),l=n.n(a),c=n(7182),h=n.n(c),u=n(9213),d=n.n(u),p=n(7109),f={};p.Z&&p.Z.locals&&(f.locals=p.Z.locals);var y,m=0,g={};g.styleTagTransform=d(),g.setAttributes=l(),g.insert=function(t,e){(e.target||document.head).appendChild(t)},g.domAPI=r(),g.insertStyleElement=h(),f.use=function(t){return g.options=t||{},m++||(y=s()(p.Z,g)),f},f.unuse=function(){m>0&&!--m&&(y(),y=null)},e.Z=f},7663:function(t,e,n){"use strict";n.d(e,{t:function(){return r}});const i=new TextEncoder,s={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},o=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class r{constructor({accessKeyId:t,secretAccessKey:e,sessionToken:n,service:i,region:s,cache:o,retries:r,initRetryMs:a}){if(null==t)throw new TypeError("accessKeyId is a required option");if(null==e)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=t,this.secretAccessKey=e,this.sessionToken=n,this.service=i,this.region=s,this.cache=o||new Map,this.retries=null!=r?r:10,this.initRetryMs=a||50}async sign(t,e){if(t instanceof Request){const{method:n,url:i,headers:s,body:o}=t;null==(e=Object.assign({method:n,url:i,headers:s},e)).body&&s.has("Content-Type")&&(e.body=null!=o&&s.has("X-Amz-Content-Sha256")?o:await t.clone().arrayBuffer()),t=i}const n=new a(Object.assign({url:t},e,this,e&&e.aws)),i=Object.assign({},e,await n.sign());delete i.aws;try{return new Request(i.url.toString(),i)}catch(t){if(t instanceof TypeError)return new Request(i.url.toString(),Object.assign({duplex:"half"},i));throw t}}async fetch(t,e){for(let n=0;n<=this.retries;n++){const i=fetch(await this.sign(t,e));if(n===this.retries)return i;const s=await i;if(s.status<500&&429!==s.status)return s;await new Promise((t=>setTimeout(t,Math.random()*this.initRetryMs*Math.pow(2,n))))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class a{constructor({method:t,url:e,headers:n,body:i,accessKeyId:r,secretAccessKey:a,sessionToken:l,service:c,region:h,cache:d,datetime:p,signQuery:f,appendSessionToken:y,allHeaders:m,singleEncode:g}){if(null==e)throw new TypeError("url is a required option");if(null==r)throw new TypeError("accessKeyId is a required option");if(null==a)throw new TypeError("secretAccessKey is a required option");let w,v;this.method=t||(i?"POST":"GET"),this.url=new URL(e),this.headers=new Headers(n||{}),this.body=i,this.accessKeyId=r,this.secretAccessKey=a,this.sessionToken=l,c&&h||([w,v]=function(t,e){const{hostname:n,pathname:i}=t;if(n.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(n.endsWith(".backblazeb2.com")){const t=n.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return null!=t?["s3",t[1]]:["",""]}const o=n.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[r,a]=(o||["",""]).slice(1,3);if("us-gov"===a)a="us-gov-west-1";else if("s3"===a||"s3-accelerate"===a)a="us-east-1",r="s3";else if("iot"===r)r=n.startsWith("iot.")?"execute-api":n.startsWith("data.jobs.iot.")?"iot-jobs-data":"/mqtt"===i?"iotdevicegateway":"iotdata";else if("autoscaling"===r){const t=(e.get("X-Amz-Target")||"").split(".")[0];"AnyScaleFrontendService"===t?r="application-autoscaling":"AnyScaleScalingPlannerFrontendService"===t&&(r="autoscaling-plans")}else null==a&&r.startsWith("s3-")?(a=r.slice(3).replace(/^fips-|^external-1/,""),r="s3"):r.endsWith("-fips")?r=r.slice(0,-5):a&&/-\d$/.test(r)&&!/-\d$/.test(a)&&([r,a]=[a,r]);return[s[r]||r,a]}(this.url,this.headers)),this.service=c||w||"",this.region=h||v||"us-east-1",this.cache=d||new Map,this.datetime=p||(new Date).toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=f,this.appendSessionToken=y||"iotdevicegateway"===this.service,this.headers.delete("Host"),"s3"!==this.service||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const b=this.signQuery?this.url.searchParams:this.headers;if(b.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&b.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter((t=>m||!o.has(t))).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map((t=>t+":"+("host"===t?this.url.host:(this.headers.get(t)||"").replace(/\s+/g," ")))).join("\n"),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&("s3"!==this.service||b.has("X-Amz-Expires")||b.set("X-Amz-Expires","86400"),b.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),b.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),b.set("X-Amz-SignedHeaders",this.signedHeaders)),"s3"===this.service)try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch(t){this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");g||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=u(this.encodedPath);const x=new Set;this.encodedSearch=[...this.url.searchParams].filter((([t])=>{if(!t)return!1;if("s3"===this.service){if(x.has(t))return!1;x.add(t)}return!0})).map((t=>t.map((t=>u(encodeURIComponent(t)))))).sort((([t,e],[n,i])=>t<n?-1:t>n?1:e<i?-1:e>i?1:0)).map((t=>t.join("="))).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const t=this.datetime.slice(0,8),e=[this.secretAccessKey,t,this.region,this.service].join();let n=this.cache.get(e);if(!n){const i=await l("AWS4"+this.secretAccessKey,t),s=await l(i,this.region),o=await l(s,this.service);n=await l(o,"aws4_request"),this.cache.set(e,n)}return h(await l(n,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,h(await c(await this.canonicalString()))].join("\n")}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+"\n",this.signedHeaders,await this.hexBodyHash()].join("\n")}async hexBodyHash(){let t=this.headers.get("X-Amz-Content-Sha256")||("s3"===this.service&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(null==t){if(this.body&&"string"!=typeof this.body&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");t=h(await c(this.body||""))}return t}}async function l(t,e){const n=await crypto.subtle.importKey("raw","string"==typeof t?i.encode(t):t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",n,i.encode(e))}async function c(t){return crypto.subtle.digest("SHA-256","string"==typeof t?i.encode(t):t)}function h(t){return Array.prototype.map.call(new Uint8Array(t),(t=>("0"+t.toString(16)).slice(-2))).join("")}function u(t){return t.replace(/[!'()*]/g,(t=>"%"+t.charCodeAt(0).toString(16).toUpperCase()))}},3319:function(t,e,n){"use strict";n.d(e,{B:function(){return u}});var i=n(2988),s=n(717);const o=1e6*(1+1e-7);function r(t){return~~(t*o)}function a(t){return`${r(t.x)},${r(t.y)},${r(t.z)}`}const l=[new i.Pa4,new i.Pa4,new i.Pa4];class c{constructor(t=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,t&&this.updateFrom(t)}getSiblingTriangleIndex(t,e){const n=this.data[3*t+e];return-1===n?-1:~~(n/3)}getSiblingEdgeIndex(t,e){const n=this.data[3*t+e];return-1===n?-1:n%3}updateFrom(t){const e=new Map,{attributes:n}=t,i=t.index,s=n.position;let o=i?i.count/3:s.count/3;const r=o;let c=0;this.useDrawRange&&(c=t.drawRange.start,t.drawRange.count!==1/0&&(o=~~(t.drawRange.count/3)));let h=this.data;(!h||h.length<3*r)&&(h=new Int32Array(3*r)),h.fill(-1);let u=0,d=0;for(let t=0;t<o;t++){const n=3*t+c;for(let t=0;t<3;t++){let e=n+t;i&&(e=i.getX(e)),l[t].fromBufferAttribute(s,e)}for(let t=0;t<3;t++){const i=(t+1)%3,s=l[t],o=l[i],r=a(s),c=a(o),p=`${c}_${r}`;if(e.has(p)){const i=e.get(p);h[n+t]=i,h[i]=n+t,e.delete(p),u--,d++}else{const i=`${r}_${c}`;e.set(i,n+t),u++}}}this.matchedEdges=d,this.unmatchedEdges=u,this.data=h}}var h=n(3460);class u extends i.Kj0{constructor(...t){super(...t),this.isBrush=!0,this._previousMatrix=new i.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:t,_previousMatrix:e}=this,n=t.elements,i=e.elements;for(let t=0;t<16;t++)if(n[t]!==i[t])return!0;return!1}prepareGeometry(){const t=this.geometry,e=t.attributes;if((0,h.E)())for(const t in e){const n=e[t];if(n.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");n.array=(0,h.i)(n.array)}if(t.boundsTree||(t.boundsTree=new s.r(t,{maxLeafTris:3}),t.halfEdges&&t.halfEdges.updateFrom(t)),t.halfEdges||(t.halfEdges=new c(t)),!t.groupIndices){const e=t.index.count/3,n=new Uint16Array(e),i=t.groups;for(let t=0,e=i.length;t<e;t++){const{start:e,count:s}=i[t];for(let i=e/3,o=(e+s)/3;i<o;i++)n[i]=t}t.groupIndices=n}}disposeCacheData(){const{geometry:t}=this;t.halfEdges=null,t.boundsTree=null,t.groupIndices=null}}},3558:function(t,e,n){"use strict";n.d(e,{v:function(){return ht}});var i=n(2988),s=n(7269);const o=1e-14,r=1e-10,a=new i.Zzh,l=new i.Zzh,c=new i.Pa4,h=new i.Pa4,u=new i.JOQ,d=new s.h;function p(t){return t.a.distanceToSquared(t.b)<o||t.a.distanceToSquared(t.c)<o||t.b.distanceToSquared(t.c)<o}class f{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new i.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class y{constructor(){this.trianglePool=new f,this.triangles=[],this.normal=new i.Pa4}initialize(t){const{triangles:e,trianglePool:n,normal:i}=this;if(e.length=0,n.clear(),Array.isArray(t))for(let s=0,r=t.length;s<r;s++){const r=t[s];if(0===s)r.getNormal(i);else if(Math.abs(1-r.getNormal(c).dot(i))>o)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const a=n.getTriangle();a.copy(r),e.push(a)}else{t.getNormal(i);const s=n.getTriangle();s.copy(t),e.push(s)}}splitByTriangle(t){const{normal:e,triangles:n}=this;if(t.getPlane(u),Math.abs(1-Math.abs(u.normal.dot(e)))<r){const i=[t.a,t.b,t.c];for(let n=0;n<3;n++){const s=(n+1)%3,o=i[n],r=i[s];c.subVectors(r,o).normalize(),h.crossVectors(e,c),u.setFromNormalAndCoplanarPoint(h,o),this.splitByPlane(u,t,n)}for(let t=0,e=n.length;t<e;t++)n[t].coplanarCount=0}else this.splitByPlane(u,t)}splitByPlane(t,e=null,n=-1){const{triangles:i,trianglePool:s}=this;let h=null;null!==e&&(h=d,h.copy(e),h.needsUpdate=!0);for(let e=0,n=i.length;e<n;e++){const u=i[e],{a:d,b:f,c:y}=u;if(h&&!h.intersectsTriangle(u,a,!0))continue;let m=0,g=-1,w=0,v=!1;const b=[d,f,y];for(let e=0;e<3;e++){const n=(e+1)%3;a.start.copy(b[e]),a.end.copy(b[n]);const i=t.distanceToPoint(a.start),s=t.distanceToPoint(a.end);if(Math.abs(i)<r&&Math.abs(s)<r){v=!0;break}if(Math.abs(i)<r)continue;i>0&&w++;let h=!!t.intersectLine(a,c);!h&&Math.abs(s)<r&&(c.copy(a.end),h=!0),!h||c.distanceTo(a.start)<o||(c.distanceTo(a.end)<o&&(g=e),0===m?l.start.copy(c):l.end.copy(c),m++)}if(!v)if(2===m&&l.distance()>r)if(-1!==g){g=(g+1)%3;let t=0;t===g&&(t=(t+1)%3);let o=t+1;o===g&&(o=(o+1)%3);const r=s.getTriangle();r.a.copy(b[o]),r.b.copy(l.end),r.c.copy(l.start),p(r)||i.push(r),u.a.copy(b[t]),u.b.copy(l.start),u.c.copy(l.end),p(u)&&(i.splice(e,1),e--,n--)}else{const o=b.findIndex((e=>w>=2?t.distanceToPoint(e)<0:t.distanceToPoint(e)>0));if(0===o){let t=l.start;l.start=l.end,l.end=t}else if(-1===o)continue;const r=(o+1)%3,a=(o+2)%3,c=s.getTriangle(),h=s.getTriangle();b[r].distanceToSquared(l.start)<b[a].distanceToSquared(l.end)?(c.a.copy(b[r]),c.b.copy(l.start),c.c.copy(l.end),h.a.copy(b[r]),h.b.copy(b[a]),h.c.copy(l.start)):(c.a.copy(b[a]),c.b.copy(l.start),c.c.copy(l.end),h.a.copy(b[r]),h.b.copy(b[a]),h.c.copy(l.end)),u.a.copy(b[o]),u.b.copy(l.end),u.c.copy(l.start),p(c)||i.push(c),p(h)||i.push(h),p(u)&&(i.splice(e,1),e--,n--)}else 3===m&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}var m=n(3460);class g{constructor(t,e=500){const n=(0,m.E)()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=t,this.array=new t(new n(e*t.BYTES_PER_ELEMENT)),this.length=0}expand(t=null){const{type:e,array:n,expansionFactor:i}=this;null===t&&(t=~~(n.length*i));const s=new e(t);s.set(n,0),this.array=s}push(...t){let{array:e,length:n}=this;n+t.length>e.length&&(this.expand(),e=this.array);for(let i=0,s=t.length;i<s;i++)e[n+i]=t[i];this.length+=t.length}clear(){this.length=0}}class w{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(t){return this.groupAttributes[0][t].type}getTotalLength(t){const{groupCount:e,groupAttributes:n}=this;let i=0;for(let s=0;s<e;s++)i+=n[s][t].length;return i}getGroupSet(t=0){const{groupAttributes:e}=this;if(e[t])return this.groupCount=Math.max(this.groupCount,t+1),e[t];const n=e[0];for(this.groupCount=Math.max(this.groupCount,t+1);t>=e.length;){const t={};e.push(t);for(const e in n)t[e]=new g(n[e].type)}return e[t]}getGroupArray(t,e=0){const{groupAttributes:n}=this;if(!n[0][t])throw new Error(`TypedAttributeData: Attribute with "${t}" has not been initialized`);return this.getGroupSet(e)[t]}initializeArray(t,e){const{groupAttributes:n}=this,i=n[0][t];if(i){if(i.type!==e)throw new Error(`TypedAttributeData: Array ${t} already initialized with a different type.`)}else for(let i=0,s=n.length;i<s;i++)n[i][t]=new g(e)}clear(){this.groupCount=0;const{groupAttributes:t}=this;t.forEach((t=>{for(const e in t)t[e].clear()}))}delete(t){this.groupAttributes.forEach((e=>{delete e[t]}))}reset(){this.groupAttributes=[]}}class v{constructor(t){this.triangle=(new i.CJI).copy(t),this.intersects={}}addTriangle(t,e){this.intersects[t]=(new i.CJI).copy(e)}getIntersectArray(){const t=[],{intersects:e}=this;for(const n in e)t.push(e[n]);return t}}class b{constructor(){this.data={}}addTriangleIntersection(t,e,n,i){const{data:s}=this;s[t]||(s[t]=new v(e)),s[t].addTriangle(n,i)}getTrianglesAsArray(t=null){const{data:e}=this,n=[];if(null!==t)t in e&&n.push(e[t].triangle);else for(const t in e)n.push(e[t].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map((t=>parseInt(t)))}getIntersectionIndices(t){const{data:e}=this;return e[t]?Object.keys(e[t].intersects).map((t=>parseInt(t))):[]}getIntersectionsAsArray(t=null,e=null){const{data:n}=this,i=new Set,s=[],o=t=>{if(n[t])if(null!==e)n[t].intersects[e]&&s.push(n[t].intersects[e]);else{const e=n[t].intersects;for(const t in e)i.has(t)||(i.add(t),s.push(e[t]))}};if(null!==t)o(t);else for(const t in n)o(t);return s}reset(){this.data={}}}class x{constructor(){this.enabled=!1,this.triangleIntersectsA=new b,this.triangleIntersectsB=new b,this.intersectionEdges=[]}addIntersectingTriangles(t,e,n,i){const{triangleIntersectsA:s,triangleIntersectsB:o}=this;s.addTriangleIntersection(t,e,n,i),o.addTriangleIntersection(n,i,t,e)}addEdge(t){this.intersectionEdges.push(t.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class A{constructor(){this.intersectionSet={},this.ids=[]}add(t,e){const{intersectionSet:n,ids:i}=this;n[t]||(n[t]=[],i.push(t)),n[t].push(e)}}var E=n(7551);const B=new i.zHn,S=new i.yGw,T=new i.CJI,C=new i.Pa4,P=new i.Ltg,z=new i.Ltg,M=new i.Ltg,k=new i.Ltg,I=new i.Ltg,j=new i.Ltg,F=new i.Zzh,N=new i.Pa4,L=1e-8,R=1e-15,O=-1,q=1,_=-2,D=2,V=0,U=1,H=2;let W=null;function G(t){W=t}function X(t,e){function n(){return Math.random()-.5}t.getNormal(N),B.direction.copy(N),t.getMidpoint(B.origin);let s=0,o=1/0;for(let t=0;t<3;t++){B.direction.x+=n()*L,B.direction.y+=n()*L,B.direction.z+=n()*L,B.direction.multiplyScalar(-1);const r=e.raycastFirst(B,i.ehD);if(Boolean(r&&B.direction.dot(r.face.normal)>0)&&s++,null!==r&&(o=Math.min(o,r.distance)),o<=R)return r.face.normal.dot(N)>0?D:_;if(s/3>.5||(t-s+1)/3>.5)break}return s/3>.5?O:q}function Z(t,e,n,i,s,o,r=!1){const a=n.attributes,l=n.index,c=3*t,h=l.getX(c+0),u=l.getX(c+1),d=l.getX(c+2);for(const t in o){const n=a[t],l=o[t];if(!(t in a))throw new Error(`CSG Operations: Attribute ${t} not available on geometry.`);const c=n.itemSize;"position"===t?(T.a.fromBufferAttribute(n,h).applyMatrix4(i),T.b.fromBufferAttribute(n,u).applyMatrix4(i),T.c.fromBufferAttribute(n,d).applyMatrix4(i),Q(T.a,T.b,T.c,e,3,l,r)):"normal"===t?(T.a.fromBufferAttribute(n,h).applyNormalMatrix(s),T.b.fromBufferAttribute(n,u).applyNormalMatrix(s),T.c.fromBufferAttribute(n,d).applyNormalMatrix(s),r&&(T.a.multiplyScalar(-1),T.b.multiplyScalar(-1),T.c.multiplyScalar(-1)),Q(T.a,T.b,T.c,e,3,l,r,!0)):(P.fromBufferAttribute(n,h),z.fromBufferAttribute(n,u),M.fromBufferAttribute(n,d),Q(P,z,M,e,c,l,r))}}function Y(t,e,n,i,s,o,r,a=!1){K(t,i,s,o,r,a),K(a?n:e,i,s,o,r,a),K(a?e:n,i,s,o,r,a)}function $(t,e,n=!1){switch(t){case E.UC:if(e===q||e===D&&!n)return U;break;case E.vC:if(n){if(e===O)return V}else if(e===q||e===_)return U;break;case E.tD:if(e===O)return V;if(e===q)return U;break;case E.TP:if(e===O||e===D&&!n)return U;break;default:throw new Error(`Unrecognized CSG operation enum "${t}".`)}return H}function Q(t,e,n,i,s,o,r=!1,a=!1){const l=t=>{o.push(t.x),s>1&&o.push(t.y),s>2&&o.push(t.z),s>3&&o.push(t.w)};k.set(0,0,0,0).addScaledVector(t,i.a.x).addScaledVector(e,i.a.y).addScaledVector(n,i.a.z),I.set(0,0,0,0).addScaledVector(t,i.b.x).addScaledVector(e,i.b.y).addScaledVector(n,i.b.z),j.set(0,0,0,0).addScaledVector(t,i.c.x).addScaledVector(e,i.c.y).addScaledVector(n,i.c.z),a&&(k.normalize(),I.normalize(),j.normalize()),l(k),r?(l(j),l(I)):(l(I),l(j))}function K(t,e,n,i,s,o=!1){for(const r in s){const a=e[r],l=s[r];if(!(r in e))throw new Error(`CSG Operations: Attribute ${r} no available on geometry.`);const c=a.itemSize;"position"===r?(C.fromBufferAttribute(a,t).applyMatrix4(n),l.push(C.x,C.y,C.z)):"normal"===r?(C.fromBufferAttribute(a,t).applyNormalMatrix(i),o&&C.multiplyScalar(-1),l.push(C.x,C.y,C.z)):(l.push(a.getX(t)),c>1&&l.push(a.getY(t)),c>2&&l.push(a.getZ(t)),c>3&&l.push(a.getW(t)))}}const J=new i.yGw,tt=new i.Vkp,et=new i.CJI,nt=new i.CJI,it=new i.CJI,st=new i.CJI;function ot(t){for(const e of t)return e}function rt(t,e,n,i,s,o,r,a=0){const l=t.matrixWorld.determinant()<0;J.copy(e.matrixWorld).invert().multiply(t.matrixWorld),tt.getNormalMatrix(t.matrixWorld).multiplyScalar(l?-1:1);const c=t.geometry.groupIndices,h=t.geometry.index,u=t.geometry.attributes.position,d=e.geometry.boundsTree,p=e.geometry.index,f=e.geometry.attributes.position,y=n.ids,m=n.intersectionSet;for(let e=0,n=y.length;e<n;e++){const n=y[e],g=-1===a?0:c[n]+a,w=r.getGroupSet(g),v=3*n,b=h.getX(v+0),x=h.getX(v+1),A=h.getX(v+2);et.a.fromBufferAttribute(u,b).applyMatrix4(J),et.b.fromBufferAttribute(u,x).applyMatrix4(J),et.c.fromBufferAttribute(u,A).applyMatrix4(J),o.initialize(et);const E=m[n];for(let t=0,e=E.length;t<e;t++){const e=3*E[t],n=p.getX(e+0),i=p.getX(e+1),s=p.getX(e+2);nt.a.fromBufferAttribute(f,n),nt.b.fromBufferAttribute(f,i),nt.c.fromBufferAttribute(f,s),o.splitByTriangle(nt)}const B=o.triangles;for(let e=0,o=B.length;e<o;e++){const o=B[e],r=$(i,X(o,d),s);if(r!==H){et.getBarycoord(o.a,st.a),et.getBarycoord(o.b,st.b),et.getBarycoord(o.c,st.c);const e=r===V;Z(n,st,t.geometry,t.matrixWorld,tt,w,l!==e)}}}return y.length}function at(t,e,n,i,s,o,r=0){const a=t.matrixWorld.determinant()<0;J.copy(e.matrixWorld).invert().multiply(t.matrixWorld),tt.getNormalMatrix(t.matrixWorld).multiplyScalar(a?-1:1);const l=e.geometry.boundsTree,c=t.geometry.groupIndices,h=t.geometry.index,u=t.geometry.attributes,d=u.position,p=[],f=t.geometry.halfEdges,y=new Set;for(let t=0,e=h.count/3;t<e;t++)t in n.intersectionSet||y.add(t);for(;y.size>0;){const e=ot(y);y.delete(e),p.push(e);const n=3*e,m=h.getX(n+0),g=h.getX(n+1),w=h.getX(n+2);it.a.fromBufferAttribute(d,m).applyMatrix4(J),it.b.fromBufferAttribute(d,g).applyMatrix4(J),it.c.fromBufferAttribute(d,w).applyMatrix4(J);const v=$(i,X(it,l),s);for(;p.length>0;){const e=p.pop(),n=-1===r?0:c[e]+r,i=o.getGroupSet(n);for(let t=0;t<3;t++){const n=f.getSiblingTriangleIndex(e,t);-1!==n&&y.has(n)&&(p.push(n),y.delete(n))}if(v===H)continue;const s=3*e,l=h.getX(s+0),d=h.getX(s+1),m=h.getX(s+2),g=v===V;Y(l,d,m,u,t.matrixWorld,tt,i,g!==a)}}}var lt=n(3319);function ct(t,e){let n=e;return Array.isArray(e)||(n=[],t.forEach((t=>{n[t.materialIndex]=e}))),n}class ht{constructor(){this.triangleSplitter=new y,this.attributeData=new w,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new x}evaluate(t,e,n,s=new lt.B){t.prepareGeometry(),e.prepareGeometry();const{triangleSplitter:o,attributeData:r,attributes:a,useGroups:l,debug:c}=this,h=s.geometry,u=t.geometry.attributes;for(let t=0,e=a.length;t<e;t++){const e=a[t],n=u[e];r.initializeArray(e,n.array.constructor)}for(const t in r.attributes)a.includes(t)||r.delete(t);for(const t in h.attributes)a.includes(t)||(h.deleteAttribute(t),h.dispose());r.clear(),c.enabled&&(c.reset(),G(c)),function(t,e,n,i,s,o){const{useGroups:r=!0}=o,{aIntersections:a,bIntersections:l}=function(t,e){const n=new A,i=new A;return S.copy(t.matrixWorld).invert().multiply(e.matrixWorld),t.geometry.boundsTree.bvhcast(e.geometry.boundsTree,S,{intersectsTriangles(t,e,s,o){if(t.intersectsTriangle(e,F,!0)){if(0===F.distanceSq()&&t.plane.normal.dot(e.plane.normal)<1-1e-10)return!1;n.add(s,o),i.add(o,s),W&&(W.addEdge(F),W.addIntersectingTriangles(s,t,o,e))}return!1}}),{aIntersections:n,bIntersections:i}}(t,e);let c;c=r?0:-1,at(t,e,a,n,!1,s,c),rt(t,e,a,n,!1,i,s,c),c=r?t.geometry.groups.length||1:-1,at(e,t,l,n,!0,s,c),rt(e,t,l,n,!0,i,s,c)}(t,e,n,o,r,{useGroups:l}),c.enabled&&G(null);const d=l&&0!==t.geometry.groups.length?t.geometry.groups.map((t=>({...t}))):[{start:0,count:1/0,materialIndex:0}],p=l&&0!==e.geometry.groups.length?e.geometry.groups.map((t=>({...t}))):[{start:0,count:1/0,materialIndex:0}],f=ct(d,t.material),y=ct(p,e.material);p.forEach((t=>{t.materialIndex+=f.length})),function(t,e,n,s){let o=!1,r=-1;const a=s.groupCount,l=t.attributes,c=s.groupAttributes[0];for(const n in c){const h=s.getTotalLength(n,a),u=c[n].type;let d=l[n];if(!d||d.array.length<h){const s=e.attributes[n];d=new i.TlE(new u(h),s.itemSize,s.normalized),t.setAttribute(n,d),o=!0}let p=0;for(let t=0;t<a;t++){const{array:e,type:i,length:o}=s.groupAttributes[t][n],r=new i(e.buffer,0,o);d.array.set(r,p),p+=r.length}d.needsUpdate=!0,r=h/d.itemSize}t.setDrawRange(0,r),t.clearGroups();let h=0;for(let e=0;e<a;e++){const i=s.getGroupArray("position",e).length/3;if(0!==i){const s=n[e];t.addGroup(h,i,s.materialIndex),h+=i}}if(t.index){const e=t.index.array;if(e.length<r)t.index=null,o=!0;else for(let t=0,n=e.length;t<n;t++)e[t]=t}t.boundsTree=null,o&&t.dispose()}(h,t.geometry,[...d,...p],r);const m=h.groups;if(l){const t=new Map,e=[...f,...y];let n=0;for(let i=0,s=e.length;i<s;i++)Boolean(m.find((t=>t.materialIndex===i)))?(t.set(i,n),n++):e[i]=null;for(let e=0,n=m.length;e<n;e++){const n=m[e];n.materialIndex=t.get(n.materialIndex)}s.material=e.filter((t=>t))}return s}evaluateHierarchy(t,e=new lt.B){t.updateMatrixWorld(!0);const n=(t,e)=>{const i=t.children;for(let t=0,s=i.length;t<s;t++){const s=i[t];s.isOperationGroup?n(s,e):e(s)}},i=t=>{const e=t.children;let s=!1;for(let t=0,n=e.length;t<n;t++){const n=e[t];s=i(n)||s}const o=t.isDirty();if(o&&t.markUpdated(),s&&!t.isOperationGroup){let e;return n(t,(n=>{e=e?this.evaluate(e,n,n.operation):this.evaluate(t,n,n.operation)})),t._cachedGeometry=e.geometry,t._cachedMaterials=e.material,!0}return s||o};return i(t),e.geometry=t._cachedGeometry,e.material=t._cachedMaterials,e}reset(){this.triangleSplitter.reset()}}},7551:function(t,e,n){"use strict";n.d(e,{TP:function(){return r},UC:function(){return i},tD:function(){return o},vC:function(){return s}});const i=0,s=1,o=3,r=4},3460:function(t,e,n){"use strict";function i(){return"undefined"!=typeof SharedArrayBuffer}function s(t){if(t.buffer instanceof SharedArrayBuffer)return t;const e=t.constructor,n=t.buffer,i=new SharedArrayBuffer(n.byteLength),s=new Uint8Array(n);return new Uint8Array(i).set(s,0),new e(i)}n.d(e,{E:function(){return i},i:function(){return s}})},8718:function(t,e,n){"use strict";n.d(e,{$V:function(){return s},EM:function(){return h},L4:function(){return a},Q_:function(){return l},VQ:function(){return u},dv:function(){return i},ms:function(){return o},wG:function(){return c},xJ:function(){return r}});const i=0,s=1,o=2,r=2,a=1.25,l=1,c=32,h=65535,u=Math.pow(2,-24)},717:function(t,e,n){"use strict";n.d(e,{r:function(){return at}});var i=n(2988),s=n(8718);class o{constructor(){}}function r(t,e,n){return n.min.x=e[t],n.min.y=e[t+1],n.min.z=e[t+2],n.max.x=e[t+3],n.max.y=e[t+4],n.max.z=e[t+5],n}function a(t){let e=-1,n=-1/0;for(let i=0;i<3;i++){const s=t[i+3]-t[i];s>n&&(n=s,e=i)}return e}function l(t,e){e.set(t)}function c(t,e,n){let i,s;for(let o=0;o<3;o++){const r=o+3;i=t[o],s=e[o],n[o]=i<s?i:s,i=t[r],s=e[r],n[r]=i>s?i:s}}function h(t,e,n){for(let i=0;i<3;i++){const s=e[t+2*i],o=e[t+2*i+1],r=s-o,a=s+o;r<n[i]&&(n[i]=r),a>n[i+3]&&(n[i+3]=a)}}function u(t){const e=t[3]-t[0],n=t[4]-t[1],i=t[5]-t[2];return 2*(e*n+n*i+i*e)}function d(t,e,n,i,s=null){let o=1/0,r=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,y=-1/0,m=-1/0;const g=null!==s;for(let i=6*e,s=6*(e+n);i<s;i+=6){const e=t[i+0],n=t[i+1],s=e-n,w=e+n;s<o&&(o=s),w>l&&(l=w),g&&e<u&&(u=e),g&&e>f&&(f=e);const v=t[i+2],b=t[i+3],x=v-b,A=v+b;x<r&&(r=x),A>c&&(c=A),g&&v<d&&(d=v),g&&v>y&&(y=v);const E=t[i+4],B=t[i+5],S=E-B,T=E+B;S<a&&(a=S),T>h&&(h=T),g&&E<p&&(p=E),g&&E>m&&(m=E)}i[0]=o,i[1]=r,i[2]=a,i[3]=l,i[4]=c,i[5]=h,g&&(s[0]=u,s[1]=d,s[2]=p,s[3]=f,s[4]=y,s[5]=m)}const p=32,f=(t,e)=>t.candidate-e.candidate,y=new Array(p).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),m=new Float32Array(6);var g=n(9571),w=n(7269),v=n(3153);class b{constructor(t,e,n){this.isOrientedBox=!0,this.min=new i.Pa4,this.max=new i.Pa4,this.matrix=new i.yGw,this.invMatrix=new i.yGw,this.points=new Array(8).fill().map((()=>new i.Pa4)),this.satAxes=new Array(3).fill().map((()=>new i.Pa4)),this.satBounds=new Array(3).fill().map((()=>new g.B)),this.alignedSatBounds=new Array(3).fill().map((()=>new g.B)),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}b.prototype.update=function(){const t=this.matrix,e=this.min,n=this.max,i=this.points;for(let s=0;s<=1;s++)for(let o=0;o<=1;o++)for(let r=0;r<=1;r++){const a=i[1*s|2*o|4*r];a.x=s?n.x:e.x,a.y=o?n.y:e.y,a.z=r?n.z:e.z,a.applyMatrix4(t)}const s=this.satBounds,o=this.satAxes,r=i[0];for(let t=0;t<3;t++){const e=o[t],n=s[t],a=i[1<<t];e.subVectors(r,a),n.setFromPoints(e,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},b.prototype.intersectsBox=function(){const t=new g.B;return function(e){this.needsUpdate&&this.update();const n=e.min,i=e.max,s=this.satBounds,o=this.satAxes,r=this.alignedSatBounds;if(t.min=n.x,t.max=i.x,r[0].isSeparated(t))return!1;if(t.min=n.y,t.max=i.y,r[1].isSeparated(t))return!1;if(t.min=n.z,t.max=i.z,r[2].isSeparated(t))return!1;for(let n=0;n<3;n++){const i=o[n],r=s[n];if(t.setFromBox(i,e),r.isSeparated(t))return!1}return!0}}(),b.prototype.intersectsTriangle=function(){const t=new w.h,e=new Array(3),n=new g.B,s=new g.B,o=new i.Pa4;return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(t.copy(i),t.update(),i=t);const r=this.satBounds,a=this.satAxes;e[0]=i.a,e[1]=i.b,e[2]=i.c;for(let t=0;t<3;t++){const i=r[t],s=a[t];if(n.setFromPoints(s,e),i.isSeparated(n))return!1}const l=i.satBounds,c=i.satAxes,h=this.points;for(let t=0;t<3;t++){const e=l[t],i=c[t];if(n.setFromPoints(i,h),e.isSeparated(n))return!1}for(let t=0;t<3;t++){const i=a[t];for(let t=0;t<4;t++){const r=c[t];if(o.crossVectors(i,r),n.setFromPoints(o,e),s.setFromPoints(o,h),n.isSeparated(s))return!1}}return!0}}(),b.prototype.closestPointToPoint=function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},b.prototype.distanceToPoint=function(){const t=new i.Pa4;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),b.prototype.distanceToBox=function(){const t=["x","y","z"],e=new Array(12).fill().map((()=>new i.Zzh)),n=new Array(12).fill().map((()=>new i.Zzh)),s=new i.Pa4,o=new i.Pa4;return function(i,r=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(a||l)&&(i.getCenter(o),this.closestPointToPoint(o,s),i.closestPointToPoint(s,o),a&&a.copy(s),l&&l.copy(o)),0;const c=r*r,h=i.min,u=i.max,d=this.points;let p=1/0;for(let t=0;t<8;t++){const e=d[t];o.copy(e).clamp(h,u);const n=e.distanceToSquared(o);if(n<p&&(p=n,a&&a.copy(e),l&&l.copy(o),n<c))return Math.sqrt(n)}let f=0;for(let i=0;i<3;i++)for(let s=0;s<=1;s++)for(let o=0;o<=1;o++){const r=(i+1)%3,a=(i+2)%3,l=1<<i|s<<r|o<<a,c=d[s<<r|o<<a],p=d[l];e[f].set(c,p);const y=t[i],m=t[r],g=t[a],w=n[f],v=w.start,b=w.end;v[y]=h[y],v[m]=s?h[m]:u[m],v[g]=o?h[g]:u[m],b[y]=u[y],b[m]=s?h[m]:u[m],b[g]=o?h[g]:u[m],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let n=0;n<=1;n++){o.x=t?u.x:h.x,o.y=e?u.y:h.y,o.z=n?u.z:h.z,this.closestPointToPoint(o,s);const i=o.distanceToSquared(s);if(i<p&&(p=i,a&&a.copy(s),l&&l.copy(o),i<c))return Math.sqrt(i)}for(let t=0;t<12;t++){const i=e[t];for(let t=0;t<12;t++){const e=n[t];(0,v.UX)(i,e,s,o);const r=s.distanceToSquared(o);if(r<p&&(p=r,a&&a.copy(s),l&&l.copy(o),r<c))return Math.sqrt(r)}}return Math.sqrt(p)}}();const x=new i.Pa4,A=new i.Pa4,E=new i.Pa4,B=new i.FM8,S=new i.FM8,T=new i.FM8,C=new i.Pa4;function P(t,e,n,s,o){const r=3*s,a=t.index.getX(r),l=t.index.getX(r+1),c=t.index.getX(r+2),h=function(t,e,n,s,o,r,a){x.fromBufferAttribute(e,s),A.fromBufferAttribute(e,o),E.fromBufferAttribute(e,r);const l=function(t,e,n,s,o,r){let a;return a=r===i._Li?t.intersectTriangle(s,n,e,!0,o):t.intersectTriangle(e,n,s,r!==i.ehD,o),null===a?null:{distance:t.origin.distanceTo(o),point:o.clone()}}(t,x,A,E,C,a);if(l){n&&(B.fromBufferAttribute(n,s),S.fromBufferAttribute(n,o),T.fromBufferAttribute(n,r),l.uv=i.CJI.getUV(C,x,A,E,B,S,T,new i.FM8));const t={a:s,b:o,c:r,normal:new i.Pa4,materialIndex:0};i.CJI.getNormal(x,A,E,t.normal),l.face=t,l.faceIndex=s}return l}(n,t.attributes.position,t.attributes.uv,a,l,c,e);return h?(h.faceIndex=s,o&&o.push(h),h):null}function z(t,e,n,i){const s=t.a,o=t.b,r=t.c;let a=e,l=e+1,c=e+2;n&&(a=n.getX(e),l=n.getX(e+1),c=n.getX(e+2)),s.x=i.getX(a),s.y=i.getY(a),s.z=i.getZ(a),o.x=i.getX(l),o.y=i.getY(l),o.z=i.getZ(l),r.x=i.getX(c),r.y=i.getY(c),r.z=i.getZ(c)}function M(t,e,n,i,s,o,r){const a=n.index,l=n.attributes.position;for(let n=t,c=e+t;n<c;n++)if(z(r,3*n,a,l),r.needsUpdate=!0,i(r,n,s,o))return!0;return!1}class k{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}var I=n(129);const j=new i.ZzF,F=new i.Pa4,N=["x","y","z"];function L(t,e,n,i,s){let o=2*t,r=U,a=H,l=W;if((0,I.ee)(o,a))!function(t,e,n,i,s,o){for(let r=i,a=i+s;r<a;r++)P(t,e,n,r,o)}(e,n,i,(0,I.ew)(t,l),(0,I.ai)(o,a),s);else{const o=(0,I.lB)(t);_(o,r,i,F)&&L(o,e,n,i,s);const a=(0,I.J8)(t,l);_(a,r,i,F)&&L(a,e,n,i,s)}}function R(t,e,n,i){let s=2*t,o=U,r=H,a=W;if((0,I.ee)(s,r))return function(t,e,n,i,s){let o=1/0,r=null;for(let a=i,l=i+s;a<l;a++){const i=P(t,e,n,a);i&&i.distance<o&&(r=i,o=i.distance)}return r}(e,n,i,(0,I.ew)(t,a),(0,I.ai)(s,r));{const s=(0,I.ki)(t,a),r=N[s],l=i.direction[r]>=0;let c,h;l?(c=(0,I.lB)(t),h=(0,I.J8)(t,a)):(c=(0,I.J8)(t,a),h=(0,I.lB)(t));const u=_(c,o,i,F)?R(c,e,n,i):null;if(u){const t=u.point[r];if(l?t<=o[h+s]:t>=o[h+s+3])return u}const d=_(h,o,i,F)?R(h,e,n,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const O=function(){let t,e;const n=[],o=new k((()=>new i.ZzF));return function(...i){t=o.getPrimitive(),e=o.getPrimitive(),n.push(t,e);const s=a(...i);o.releasePrimitive(t),o.releasePrimitive(e),n.pop(),n.pop();const r=n.length;return r>0&&(e=n[r-1],t=n[r-2]),s};function a(n,i,o,l,c=null,h=0,u=0){function d(t){let e=2*t,n=H,i=W;for(;!(0,I.ee)(e,n);)e=2*(t=(0,I.lB)(t));return(0,I.ew)(t,i)}function p(t){let e=2*t,n=H,i=W;for(;!(0,I.ee)(e,n);)e=2*(t=(0,I.J8)(t,i));return(0,I.ew)(t,i)+(0,I.ai)(e,n)}let f=2*n,y=U,m=H,g=W;if((0,I.ee)(f,m)){const e=(0,I.ew)(n,g),i=(0,I.ai)(f,m);return r((0,I.V4)(n),y,t),l(e,i,!1,u,h+n,t)}{const f=(0,I.lB)(n),w=(0,I.J8)(n,g);let v,b,x,A,E=f,B=w;if(c&&(x=t,A=e,r((0,I.V4)(E),y,x),r((0,I.V4)(B),y,A),v=c(x),b=c(A),b<v)){E=w,B=f;const t=v;v=b,b=t,x=A}x||(x=t,r((0,I.V4)(E),y,x));const S=o(x,(0,I.ee)(2*E,m),v,u+1,h+E);let T;if(S===s.xJ){const t=d(E);T=l(t,p(E)-t,!0,u+1,h+E,x)}else T=S&&a(E,i,o,l,c,h,u+1);if(T)return!0;A=e,r((0,I.V4)(B),y,A);const C=o(A,(0,I.ee)(2*B,m),b,u+1,h+B);let P;if(C===s.xJ){const t=d(B);P=l(t,p(B)-t,!0,u+1,h+B,A)}else P=C&&a(B,i,o,l,c,h,u+1);return!!P}}}(),q=function(){const t=new w.h,e=new w.h,n=new i.yGw,s=new b,o=new b;return function i(a,l,c,h,u=null){let d=2*a,p=U,f=H,y=W;if(null===u&&(c.boundingBox||c.computeBoundingBox(),s.set(c.boundingBox.min,c.boundingBox.max,h),u=s),!(0,I.ee)(d,f)){const t=a+8,e=y[a+6];return r((0,I.V4)(t),p,j),u.intersectsBox(j)&&i(t,l,c,h,u)?!0:(r((0,I.V4)(e),p,j),!(!u.intersectsBox(j)||!i(e,l,c,h,u)))}{const i=l,s=i.index,u=i.attributes.position,m=c.index,g=c.attributes.position,w=(0,I.ew)(a,y),v=(0,I.ai)(d,f);if(n.copy(h).invert(),c.boundsTree)return r((0,I.V4)(a),p,o),o.matrix.copy(n),o.needsUpdate=!0,c.boundsTree.shapecast({intersectsBounds:t=>o.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(h),t.b.applyMatrix4(h),t.c.applyMatrix4(h),t.needsUpdate=!0;for(let n=3*w,i=3*(v+w);n<i;n+=3)if(z(e,n,s,u),e.needsUpdate=!0,t.intersectsTriangle(e))return!0;return!1}});for(let i=3*w,o=v+3*w;i<o;i+=3){z(t,i,s,u),t.a.applyMatrix4(n),t.b.applyMatrix4(n),t.c.applyMatrix4(n),t.needsUpdate=!0;for(let n=0,i=m.count;n<i;n+=3)if(z(e,n,m,g),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}}}();function _(t,e,n,i){return r(t,e,j),n.intersectBox(j,i)}const D=[];let V,U,H,W;function G(t){V&&D.push(V),V=t,U=new Float32Array(t),H=new Uint16Array(t),W=new Uint32Array(t)}function X(){V=null,U=null,H=null,W=null,D.length&&G(D.pop())}const Z=Symbol("skip tree generation"),Y=new i.ZzF,$=new i.ZzF,Q=new i.yGw,K=new b,J=new b,tt=new i.Pa4,et=new i.Pa4,nt=new i.Pa4,it=new i.Pa4,st=new i.Pa4,ot=new i.ZzF,rt=new k((()=>new w.h));class at{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),at.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});e={cloneBuffers:!0,...e};const n=t.geometry,i=t._roots,s=n.getIndex();let o;return o=e.cloneBuffers?{roots:i.map((t=>t.slice())),index:s.array.slice()}:{roots:i,index:s.array},o}static deserialize(t,e,n={}){if("boolean"==typeof n)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),at.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});n={setIndex:!0,...n};const{index:s,roots:o}=t,r=new at(e,{...n,[Z]:!0});if(r._roots=o,n.setIndex){const n=e.getIndex();if(null===n){const n=new i.TlE(t.index,1,!1);e.setIndex(n)}else n.array!==s&&(n.array.set(s),n.needsUpdate=!0)}return r}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({strategy:s.dv,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Z]:!1},e)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[Z]||(this._roots=function(t,e){const n=function(t,e){function n(t){S&&S(t/T)}function r(e,i,g,S=null,T=0){if(!C&&T>=x&&(C=!0,A&&(console.warn(`MeshBVH: Max depth of ${x} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),g<=E||T>=x)return n(i+g),e.offset=i,e.count=g,e;const P=function(t,e,n,i,o,r){let d=-1,g=0;if(r===s.dv)d=a(e),-1!==d&&(g=(e[d]+e[d+3])/2);else if(r===s.$V)d=a(t),-1!==d&&(g=function(t,e,n,i){let s=0;for(let o=e,r=e+n;o<r;o++)s+=t[6*o+2*i];return s/n}(n,i,o,d));else if(r===s.ms){const r=u(t);let a=s.L4*o;const w=6*i,v=6*(i+o);for(let t=0;t<3;t++){const i=e[t],b=(e[t+3]-i)/p;if(o<p/4){const e=[...y];e.length=o;let i=0;for(let s=w;s<v;s+=6,i++){const o=e[i];o.candidate=n[s+2*t],o.count=0;const{bounds:r,leftCacheBounds:a,rightCacheBounds:l}=o;for(let t=0;t<3;t++)l[t]=1/0,l[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0,r[t]=1/0,r[t+3]=-1/0;h(s,n,r)}e.sort(f);let l=o;for(let t=0;t<l;t++){const n=e[t];for(;t+1<l&&e[t+1].candidate===n.candidate;)e.splice(t+1,1),l--}for(let i=w;i<v;i+=6){const s=n[i+2*t];for(let t=0;t<l;t++){const o=e[t];s>=o.candidate?h(i,n,o.rightCacheBounds):(h(i,n,o.leftCacheBounds),o.count++)}}for(let n=0;n<l;n++){const i=e[n],l=i.count,c=o-i.count,h=i.leftCacheBounds,p=i.rightCacheBounds;let f=0;0!==l&&(f=u(h)/r);let y=0;0!==c&&(y=u(p)/r);const m=s.Q_+s.L4*(f*l+y*c);m<a&&(d=t,a=m,g=i.candidate)}}else{for(let t=0;t<p;t++){const e=y[t];e.count=0,e.candidate=i+b+t*b;const n=e.bounds;for(let t=0;t<3;t++)n[t]=1/0,n[t+3]=-1/0}for(let e=w;e<v;e+=6){let s=~~((n[e+2*t]-i)/b);s>=p&&(s=p-1);const o=y[s];o.count++,h(e,n,o.bounds)}const e=y[p-1];l(e.bounds,e.rightCacheBounds);for(let t=p-2;t>=0;t--){const e=y[t],n=y[t+1];c(e.bounds,n.rightCacheBounds,e.rightCacheBounds)}let f=0;for(let e=0;e<p-1;e++){const n=y[e],i=n.count,h=n.bounds,p=y[e+1].rightCacheBounds;0!==i&&(0===f?l(h,m):c(h,m,m)),f+=i;let w=0,v=0;0!==f&&(w=u(m)/r);const b=o-f;0!==b&&(v=u(p)/r);const x=s.Q_+s.L4*(w*f+v*b);x<a&&(d=t,a=x,g=n.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:d,pos:g}}(e.boundingData,S,v,i,g,B);if(-1===P.axis)return n(i+g),e.offset=i,e.count=g,e;const z=function(t,e,n,i,s){let o=n,r=n+i-1;const a=s.pos,l=2*s.axis;for(;;){for(;o<=r&&e[6*o+l]<a;)o++;for(;o<=r&&e[6*r+l]>=a;)r--;if(!(o<r))return o;for(let n=0;n<3;n++){let i=t[3*o+n];t[3*o+n]=t[3*r+n],t[3*r+n]=i;let s=e[6*o+2*n+0];e[6*o+2*n+0]=e[6*r+2*n+0],e[6*r+2*n+0]=s;let a=e[6*o+2*n+1];e[6*o+2*n+1]=e[6*r+2*n+1],e[6*r+2*n+1]=a}o++,r--}}(b,v,i,g,P);if(z===i||z===i+g)n(i+g),e.offset=i,e.count=g;else{e.splitAxis=P.axis;const t=new o,n=i,s=z-i;e.left=t,t.boundingData=new Float32Array(6),d(v,n,s,t.boundingData,w),r(t,n,s,w,T+1);const a=new o,l=z,c=g-s;e.right=a,a.boundingData=new Float32Array(6),d(v,l,c,a.boundingData,w),r(a,l,c,w,T+1)}return e}!function(t,e){if(!t.index){const n=t.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let o;o=n>65535?new Uint32Array(new s(4*n)):new Uint16Array(new s(2*n)),t.setIndex(new i.TlE(o,1));for(let t=0;t<n;t++)o[t]=t}}(t,e);const g=new Float32Array(6),w=new Float32Array(6),v=function(t,e){const n=t.attributes.position,i=t.index.array,o=i.length/3,r=new Float32Array(6*o),a=n.normalized,l=n.array,c=n.offset||0;let h=3;n.isInterleavedBufferAttribute&&(h=n.data.stride);const u=["getX","getY","getZ"];for(let t=0;t<o;t++){const o=3*t,d=6*t;let p,f,y;a?(p=i[o+0],f=i[o+1],y=i[o+2]):(p=i[o+0]*h+c,f=i[o+1]*h+c,y=i[o+2]*h+c);for(let t=0;t<3;t++){let i,o,c;a?(i=n[u[t]](p),o=n[u[t]](f),c=n[u[t]](y)):(i=l[p+t],o=l[f+t],c=l[y+t]);let h=i;o<h&&(h=o),c<h&&(h=c);let m=i;o>m&&(m=o),c>m&&(m=c);const g=(m-h)/2,w=2*t;r[d+w+0]=h+g,r[d+w+1]=g+(Math.abs(h)+g)*s.VQ,h<e[t]&&(e[t]=h),m>e[t+3]&&(e[t+3]=m)}}return r}(t,g),b=t.index.array,x=e.maxDepth,A=e.verbose,E=e.maxLeafTris,B=e.strategy,S=e.onProgress,T=t.index.count/3;let C=!1;const P=[],z=function(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];const e=[],n=new Set;for(const e of t.groups)n.add(e.start),n.add(e.start+e.count);const i=Array.from(n.values()).sort(((t,e)=>t-e));for(let t=0;t<i.length-1;t++){const n=i[t],s=i[t+1];e.push({offset:n/3,count:(s-n)/3})}return e}(t);if(1===z.length){const t=z[0],e=new o;e.boundingData=g,function(t,e,n,i){let s=1/0,o=1/0,r=1/0,a=-1/0,l=-1/0,c=-1/0;for(let i=6*e,h=6*(e+n);i<h;i+=6){const e=t[i+0];e<s&&(s=e),e>a&&(a=e);const n=t[i+2];n<o&&(o=n),n>l&&(l=n);const h=t[i+4];h<r&&(r=h),h>c&&(c=h)}i[0]=s,i[1]=o,i[2]=r,i[3]=a,i[4]=l,i[5]=c}(v,t.offset,t.count,w),r(e,t.offset,t.count,w),P.push(e)}else for(let t of z){const e=new o;e.boundingData=new Float32Array(6),d(v,t.offset,t.count,e.boundingData,w),r(e,t.offset,t.count,w),P.push(e)}return P}(t,e);let r,g,w;const v=[],b=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let t=0;t<n.length;t++){const e=n[t];let i=x(e);const o=new b(s.wG*i);r=new Float32Array(o),g=new Uint32Array(o),w=new Uint16Array(o),A(0,e),v.push(o)}return v;function x(t){return t.count?1:1+x(t.left)+x(t.right)}function A(t,e){const n=t/4,i=t/2,o=!!e.count,a=e.boundingData;for(let t=0;t<6;t++)r[n+t]=a[t];if(o){const o=e.offset,r=e.count;return g[n+6]=o,w[i+14]=r,w[i+15]=s.EM,t+s.wG}{const i=e.left,o=e.right,r=e.splitAxis;let a;if(a=A(t+s.wG,i),a/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return g[n+6]=a/4,a=A(a,o),g[n+7]=r,a}}}(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new i.ZzF))),this.geometry=t}refit(t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=this.geometry,n=e.index.array,i=e.attributes.position;let o,r,a,l,c=0;const h=this._roots;for(let t=0,e=h.length;t<e;t++)o=h[t],r=new Uint32Array(o),a=new Uint16Array(o),l=new Float32Array(o),u(0,c),c+=o.byteLength;function u(e,o,c=!1){const h=2*e;if(a[h+15]===s.EM){const t=r[e+6];let s=1/0,o=1/0,c=1/0,u=-1/0,d=-1/0,p=-1/0;for(let e=3*t,r=3*(t+a[h+14]);e<r;e++){const t=n[e],r=i.getX(t),a=i.getY(t),l=i.getZ(t);r<s&&(s=r),r>u&&(u=r),a<o&&(o=a),a>d&&(d=a),l<c&&(c=l),l>p&&(p=l)}return(l[e+0]!==s||l[e+1]!==o||l[e+2]!==c||l[e+3]!==u||l[e+4]!==d||l[e+5]!==p)&&(l[e+0]=s,l[e+1]=o,l[e+2]=c,l[e+3]=u,l[e+4]=d,l[e+5]=p,!0)}{const n=e+8,i=r[e+6],s=n+o,a=i+o;let h=c,d=!1,p=!1;t?h||(d=t.has(s),p=t.has(a),h=!d&&!p):(d=!0,p=!0);const f=h||p;let y=!1;(h||d)&&(y=u(n,o,h));let m=!1;f&&(m=u(i,o,h));const g=y||m;if(g)for(let t=0;t<3;t++){const s=n+t,o=i+t,r=l[s],a=l[s+3],c=l[o],h=l[o+3];l[e+t]=r<c?r:c,l[e+t+3]=a>h?a:h}return g}}}traverse(t,e=0){const n=this._roots[e],i=new Uint32Array(n),o=new Uint16Array(n);!function e(r,a=0){const l=2*r,c=o[l+15]===s.EM;if(c){const e=i[r+6],s=o[l+14];t(a,c,new Float32Array(n,4*r,6),e,s)}else{const o=r+s.wG/4,l=i[r+6],h=i[r+7];t(a,c,new Float32Array(n,4*r,6),h)||(e(o,a+1),e(l,a+1))}}(0)}raycast(t,e=i.Wl3){const n=this._roots,s=this.geometry,o=[],r=e.isMaterial,a=Array.isArray(e),l=s.groups,c=r?e.side:e;for(let i=0,r=n.length;i<r;i++){const r=a?e[l[i].materialIndex].side:c,h=o.length;if(G(n[i]),L(0,s,r,t,o),X(),a){const t=l[i].materialIndex;for(let e=h,n=o.length;e<n;e++)o[e].face.materialIndex=t}}return o}raycastFirst(t,e=i.Wl3){const n=this._roots,s=this.geometry,o=e.isMaterial,r=Array.isArray(e);let a=null;const l=s.groups,c=o?e.side:e;for(let i=0,o=n.length;i<o;i++){const o=r?e[l[i].materialIndex].side:c;G(n[i]);const h=R(0,s,o,t);X(),null!=h&&(null==a||h.distance<a.distance)&&(a=h,r&&(h.face.materialIndex=l[i].materialIndex))}return a}intersectsGeometry(t,e){const n=this.geometry;let i=!1;for(const s of this._roots)if(G(s),i=q(0,n,t,e),X(),i)break;return i}shapecast(t,e,n){const i=this.geometry;if(t instanceof Function){if(e){const t=e;e=(e,n,i,s)=>{const o=3*n;return t(e,o,o+1,o+2,i,s)}}t={boundsTraverseOrder:n,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const s=rt.getPrimitive();let{boundsTraverseOrder:o,intersectsBounds:r,intersectsRange:a,intersectsTriangle:l}=t;if(a&&l){const t=a;a=(e,n,o,r,a)=>!!t(e,n,o,r,a)||M(e,n,i,l,o,r,s)}else a||(a=l?(t,e,n,o)=>M(t,e,i,l,n,o,s):(t,e,n)=>n);let c=!1,h=0;for(const t of this._roots){if(G(t),c=O(0,i,r,a,o,h),X(),c)break;h+=t.byteLength}return rt.releasePrimitive(s),c}bvhcast(t,e,n){let{intersectsRanges:i,intersectsTriangles:s}=n;const o=this.geometry.index,r=this.geometry.attributes.position,a=t.geometry.index,l=t.geometry.attributes.position;Q.copy(e).invert();const c=rt.getPrimitive(),h=rt.getPrimitive();if(s){function d(t,n,i,u,d,p,f,y){for(let m=i,g=i+u;m<g;m++){z(h,3*m,a,l),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let e=t,i=t+n;e<i;e++)if(z(c,3*e,o,r),c.needsUpdate=!0,s(c,h,e,m,d,p,f,y))return!0}return!1}if(i){const p=i;i=function(t,e,n,i,s,o,r,a){return!!p(t,e,n,i,s,o,r,a)||d(t,e,n,i,s,o,r,a)}}else i=d}t.getBoundingBox($),$.applyMatrix4(e);const u=this.shapecast({intersectsBounds:t=>$.intersectsBox(t),intersectsRange:(e,n,s,o,r,a)=>(Y.copy(a),Y.applyMatrix4(Q),t.shapecast({intersectsBounds:t=>Y.intersectsBox(t),intersectsRange:(t,s,a,l,c)=>i(e,n,t,s,o,r,l,c)}))});return rt.releasePrimitive(c),rt.releasePrimitive(h),u}intersectsBox(t,e){return K.set(t.min,t.max,e),K.needsUpdate=!0,this.shapecast({intersectsBounds:t=>K.intersectsBox(t),intersectsTriangle:t=>K.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,n={},i={},s=0,o=1/0){t.boundingBox||t.computeBoundingBox(),K.set(t.boundingBox.min,t.boundingBox.max,e),K.needsUpdate=!0;const r=this.geometry,a=r.attributes.position,l=r.index,c=t.attributes.position,h=t.index,u=rt.getPrimitive(),d=rt.getPrimitive();let p=et,f=nt,y=null,m=null;i&&(y=it,m=st);let g=1/0,w=null,v=null;return Q.copy(e).invert(),J.matrix.copy(Q),this.shapecast({boundsTraverseOrder:t=>K.distanceToBox(t),intersectsBounds:(t,e,n)=>n<g&&n<o&&(e&&(J.min.copy(t.min),J.max.copy(t.max),J.needsUpdate=!0),!0),intersectsRange:(n,i)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:t=>J.distanceToBox(t),intersectsBounds:(t,e,n)=>n<g&&n<o,intersectsRange:(t,o)=>{for(let r=3*t,b=3*(t+o);r<b;r+=3){z(d,r,h,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let t=3*n,e=3*(n+i);t<e;t+=3){z(u,t,l,a),u.needsUpdate=!0;const e=u.distanceToTriangle(d,p,y);if(e<g&&(f.copy(p),m&&m.copy(y),g=e,w=t/3,v=r/3),e<s)return!0}}}});for(let t=0,o=h?h.count:c.count;t<o;t+=3){z(d,t,h,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let e=3*n,o=3*(n+i);e<o;e+=3){z(u,e,l,a),u.needsUpdate=!0;const n=u.distanceToTriangle(d,p,y);if(n<g&&(f.copy(p),m&&m.copy(y),g=n,w=e/3,v=t/3),n<s)return!0}}}}),rt.releasePrimitive(u),rt.releasePrimitive(d),g===1/0?null:(n.point?n.point.copy(f):n.point=f.clone(),n.distance=g,n.faceIndex=w,i&&(i.point?i.point.copy(m):i.point=m.clone(),i.point.applyMatrix4(Q),f.applyMatrix4(Q),i.distance=f.sub(i.point).length(),i.faceIndex=v),n)}closestPointToPoint(t,e={},n=0,i=1/0){const s=n*n,o=i*i;let r=1/0,a=null;if(this.shapecast({boundsTraverseOrder:e=>(tt.copy(t).clamp(e.min,e.max),tt.distanceToSquared(t)),intersectsBounds:(t,e,n)=>n<r&&n<o,intersectsTriangle:(e,n)=>{e.closestPointToPoint(t,tt);const i=t.distanceToSquared(tt);return i<r&&(et.copy(tt),r=i,a=n),i<s}}),r===1/0)return null;const l=Math.sqrt(r);return e.point?e.point.copy(et):e.point=et.clone(),e.distance=l,e.faceIndex=a,e}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach((e=>{r(0,new Float32Array(e),ot),t.union(ot)})),t}}},129:function(t,e,n){"use strict";function i(t,e){return 65535===e[t+15]}function s(t,e){return e[t+6]}function o(t,e){return e[t+14]}function r(t){return t+8}function a(t,e){return e[t+6]}function l(t,e){return e[t+7]}function c(t){return t}n.d(e,{J8:function(){return a},V4:function(){return c},ai:function(){return o},ee:function(){return i},ew:function(){return s},ki:function(){return l},lB:function(){return r}})},7269:function(t,e,n){"use strict";n.d(e,{h:function(){return l}});var i=n(2988),s=n(9571),o=n(3153);const r=1e-15;function a(t){return Math.abs(t)<r}class l extends i.CJI{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new i.Pa4)),this.satBounds=new Array(4).fill().map((()=>new s.B)),this.points=[this.a,this.b,this.c],this.sphere=new i.aLr,this.plane=new i.JOQ,this.needsUpdate=!0}intersectsSphere(t){return(0,o.s_)(t,this)}update(){const t=this.a,e=this.b,n=this.c,i=this.points,s=this.satAxes,o=this.satBounds,r=s[0],a=o[0];this.getNormal(r),a.setFromPoints(r,i);const l=s[1],c=o[1];l.subVectors(t,e),c.setFromPoints(l,i);const h=s[2],u=o[2];h.subVectors(e,n),u.setFromPoints(h,i);const d=s[3],p=o[3];d.subVectors(n,t),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(r,t),this.needsUpdate=!1}}l.prototype.closestPointToSegment=function(){const t=new i.Pa4,e=new i.Pa4,n=new i.Zzh;return function(i,s=null,r=null){const{start:a,end:l}=i,c=this.points;let h,u=1/0;for(let a=0;a<3;a++){const l=(a+1)%3;n.start.copy(c[a]),n.end.copy(c[l]),(0,o.UX)(n,i,t,e),h=t.distanceToSquared(e),h<u&&(u=h,s&&s.copy(t),r&&r.copy(e))}return this.closestPointToPoint(a,t),h=a.distanceToSquared(t),h<u&&(u=h,s&&s.copy(t),r&&r.copy(a)),this.closestPointToPoint(l,t),h=l.distanceToSquared(t),h<u&&(u=h,s&&s.copy(t),r&&r.copy(l)),Math.sqrt(u)}}(),l.prototype.intersectsTriangle=function(){const t=new l,e=new Array(3),n=new Array(3),o=new s.B,r=new s.B,c=new i.Pa4,h=new i.Pa4,u=new i.Pa4,d=new i.Pa4,p=new i.Zzh,f=new i.Zzh,y=new i.Zzh;return function(i,s=null,l=!1){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(t.copy(i),t.update(),i=t);const m=this.plane,g=i.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){const t=this.satBounds,a=this.satAxes;n[0]=i.a,n[1]=i.b,n[2]=i.c;for(let e=0;e<4;e++){const i=t[e],s=a[e];if(o.setFromPoints(s,n),i.isSeparated(o))return!1}const h=i.satBounds,u=i.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){const n=h[t],i=u[t];if(o.setFromPoints(i,e),n.isSeparated(o))return!1}for(let t=0;t<4;t++){const i=a[t];for(let t=0;t<4;t++){const s=u[t];if(c.crossVectors(i,s),o.setFromPoints(c,e),r.setFromPoints(c,n),o.isSeparated(r))return!1}}return s&&(l||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),s.start.set(0,0,0),s.end.set(0,0,0)),!0}{const t=this.points;let e=!1,n=0;for(let i=0;i<3;i++){const s=t[i],o=t[(i+1)%3];p.start.copy(s),p.end.copy(o),p.delta(h);const r=e?f.start:f.end,l=a(g.distanceToPoint(s));if(a(g.normal.dot(h))&&l){f.copy(p),n=2;break}if((g.intersectLine(p,r)||l)&&!a(r.distanceTo(o))){if(n++,e)break;e=!0}}if(1===n&&i.containsPoint(f.end))return s&&(s.start.copy(f.end),s.end.copy(f.end)),!0;if(2!==n)return!1;const o=i.points;let r=!1,l=0;for(let t=0;t<3;t++){const e=o[t],n=o[(t+1)%3];p.start.copy(e),p.end.copy(n),p.delta(u);const i=r?y.start:y.end,s=a(m.distanceToPoint(e));if(a(m.normal.dot(u))&&s){y.copy(p),l=2;break}if((m.intersectLine(p,i)||s)&&!a(i.distanceTo(n))){if(l++,r)break;r=!0}}if(1===l&&this.containsPoint(y.end))return s&&(s.start.copy(y.end),s.end.copy(y.end)),!0;if(2!==l)return!1;if(f.delta(h),y.delta(u),h.dot(u)<0){let t=y.start;y.start=y.end,y.end=t}const c=f.start.dot(h),w=f.end.dot(h),v=y.start.dot(h),b=y.end.dot(h);return(c===b||v===w||w<v!=c<b)&&(s&&(d.subVectors(f.start,y.start),d.dot(h)>0?s.start.copy(f.start):s.start.copy(y.start),d.subVectors(f.end,y.end),d.dot(h)<0?s.end.copy(f.end):s.end.copy(y.end)),!0)}}}(),l.prototype.distanceToPoint=function(){const t=new i.Pa4;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),l.prototype.distanceToTriangle=function(){const t=new i.Pa4,e=new i.Pa4,n=["a","b","c"],s=new i.Zzh,r=new i.Zzh;return function(i,a=null,l=null){const c=a||l?s:null;if(this.intersectsTriangle(i,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let h=1/0;for(let e=0;e<3;e++){let s;const o=n[e],r=i[o];this.closestPointToPoint(r,t),s=r.distanceToSquared(t),s<h&&(h=s,a&&a.copy(t),l&&l.copy(r));const c=this[o];i.closestPointToPoint(c,t),s=c.distanceToSquared(t),s<h&&(h=s,a&&a.copy(c),l&&l.copy(t))}for(let c=0;c<3;c++){const u=n[c],d=n[(c+1)%3];s.set(this[u],this[d]);for(let c=0;c<3;c++){const u=n[c],d=n[(c+1)%3];r.set(i[u],i[d]),(0,o.UX)(s,r,t,e);const p=t.distanceToSquared(e);p<h&&(h=p,a&&a.copy(t),l&&l.copy(e))}}return Math.sqrt(h)}}()},3153:function(t,e,n){"use strict";n.d(e,{UX:function(){return o},s_:function(){return r}});var i=n(2988);const s=function(){const t=new i.Pa4,e=new i.Pa4,n=new i.Pa4;return function(i,s,o){const r=i.start,a=t,l=s.start,c=e;n.subVectors(r,l),t.subVectors(i.end,i.start),e.subVectors(s.end,s.start);const h=n.dot(c),u=c.dot(a),d=c.dot(c),p=n.dot(a),f=a.dot(a)*d-u*u;let y,m;y=0!==f?(h*u-p*d)/f:0,m=(h+y*u)/d,o.x=y,o.y=m}}(),o=function(){const t=new i.FM8,e=new i.Pa4,n=new i.Pa4;return function(i,o,r,a){s(i,o,t);let l=t.x,c=t.y;if(l>=0&&l<=1&&c>=0&&c<=1)return i.at(l,r),void o.at(c,a);if(l>=0&&l<=1)return c<0?o.at(0,a):o.at(1,a),void i.closestPointToPoint(a,!0,r);if(c>=0&&c<=1)return l<0?i.at(0,r):i.at(1,r),void o.closestPointToPoint(r,!0,a);{let t,s;t=l<0?i.start:i.end,s=c<0?o.start:o.end;const h=e,u=n;return i.closestPointToPoint(s,!0,e),o.closestPointToPoint(t,!0,n),h.distanceToSquared(s)<=u.distanceToSquared(t)?(r.copy(h),void a.copy(s)):(r.copy(t),void a.copy(u))}}}(),r=function(){const t=new i.Pa4,e=new i.Pa4,n=new i.JOQ,s=new i.Zzh;return function(i,o){const{radius:r,center:a}=i,{a:l,b:c,c:h}=o;if(s.start=l,s.end=c,s.closestPointToPoint(a,!0,t).distanceTo(a)<=r)return!0;if(s.start=l,s.end=h,s.closestPointToPoint(a,!0,t).distanceTo(a)<=r)return!0;if(s.start=c,s.end=h,s.closestPointToPoint(a,!0,t).distanceTo(a)<=r)return!0;const u=o.getPlane(n);if(Math.abs(u.distanceToPoint(a))<=r){const t=u.projectPoint(a,e);if(o.containsPoint(t))return!0}return!1}}()},9571:function(t,e,n){"use strict";n.d(e,{B:function(){return s}});var i=n(2988);class s{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,i=-1/0;for(let s=0,o=t.length;s<o;s++){const o=t[s][e];n=o<n?o:n,i=o>i?o:i}this.min=n,this.max=i}setFromPoints(t,e){let n=1/0,i=-1/0;for(let s=0,o=e.length;s<o;s++){const o=e[s],r=t.dot(o);n=r<n?r:n,i=r>i?r:i}this.min=n,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}s.prototype.setFromBox=function(){const t=new i.Pa4;return function(e,n){const i=n.min,s=n.max;let o=1/0,r=-1/0;for(let n=0;n<=1;n++)for(let a=0;a<=1;a++)for(let l=0;l<=1;l++){t.x=i.x*n+s.x*(1-n),t.y=i.y*a+s.y*(1-a),t.z=i.z*l+s.z*(1-l);const c=e.dot(t);o=Math.min(c,o),r=Math.max(c,r)}this.min=o,this.max=r}}(),new s},500:function(t,e,n){"use strict";n.d(e,{DY:function(){return y},J7:function(){return m}});var i=n(3653),s=n(2988),o=function(){var t,e,n,i,o=0,r=new s.Pa4;function a(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new u,this.unassigned=new u,this.vertices=[]}function l(){this.normal=new s.Pa4,this.midpoint=new s.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=o,this.edge=null}function c(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function h(t,e){this.point=t,this.index=e,this.prev=null,this.next=null,this.face=null}function u(){this.head=null,this.tail=null}return Object.assign(a.prototype,{toJSON:function(){const t=this.faces.map((t=>t.toArray())),e=Array.from(new Set(t.flat())).sort(),n=[];for(let t=0;t<e.length;t++)n.push(this.vertices[e[t]].point.x,this.vertices[e[t]].point.y,this.vertices[e[t]].point.z);const i=new Map;for(let t=0;t<e.length;t++)i.set(e[t],t);const s=[];for(let e=0;e<t.length;e++)s.push([i.get(t[e][0]),i.get(t[e][1]),i.get(t[e][2])]);return[n,s]},setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("THREE.ConvexHull: Points parameter is not an array."),t.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.vertices.push(new h(t[e],e));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse((function(t){var n,i,o,r=t.geometry;if(void 0!==r&&(r.isGeometry&&(r=r.toBufferGeometry?r.toBufferGeometry():(new BufferGeometry).fromGeometry(r)),r.isBufferGeometry)){var a=r.attributes.position;if(void 0!==a)for(n=0,i=a.count;n<i;n++)(o=new s.Pa4).fromBufferAttribute(a,n).applyMatrix4(t.matrixWorld),e.push(o)}})),this.setFromPoints(e)},containsPoint:function(t){for(var e=this.faces,n=0,i=e.length;n<i;n++)if(e[n].distanceToPoint(t)>this.tolerance)return!1;return!0},intersectRay:function(t,e){for(var n=this.faces,i=-1/0,s=1/0,o=0,r=n.length;o<r;o++){var a=n[o],l=a.distanceToPoint(t.origin),c=a.normal.dot(t.direction);if(l>0&&c>=0)return null;var h=0!==c?-l/c:0;if(!(h<=0)&&(c>0?s=Math.min(h,s):i=Math.max(h,i),i>s))return null}return i!==-1/0?t.at(i,e):t.at(s,e),e},intersectsRay:function(t){return null!==this.intersectRay(t,r)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,n=t.outside;null!==n.next&&n.next.face===t;)n=n.next;return this.assigned.removeSubList(e,n),e.prev=n.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var n=this.removeAllVerticesFromFace(t);if(void 0!==n)if(void 0===e)this.unassigned.appendChain(n);else{var i=n;do{var s=i.next;e.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,e):this.unassigned.append(i),i=s}while(null!==i)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var n=e.next,i=this.tolerance,s=null,r=0;r<t.length;r++){var a=t[r];if(a.mark===o){var l=a.distanceToPoint(e.point);if(l>i&&(i=l,s=a),i>1e3*this.tolerance)break}}null!==s&&this.addVertexToFace(e,s),e=n}while(null!==e)}return this},computeExtremes:function(){var t,e,n,i=new s.Pa4,o=new s.Pa4,r=[],a=[];for(t=0;t<3;t++)r[t]=a[t]=this.vertices[0];for(i.copy(this.vertices[0].point),o.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var l=this.vertices[t],c=l.point;for(n=0;n<3;n++)c.getComponent(n)<i.getComponent(n)&&(i.setComponent(n,c.getComponent(n)),r[n]=l);for(n=0;n<3;n++)c.getComponent(n)>o.getComponent(n)&&(o.setComponent(n,c.getComponent(n)),a[n]=l)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(i.x),Math.abs(o.x))+Math.max(Math.abs(i.y),Math.abs(o.y))+Math.max(Math.abs(i.z),Math.abs(o.z))),{min:r,max:a}},computeInitialHull:function(){void 0===t&&(t=new s.Zzh,e=new s.JOQ,n=new s.Pa4);var i,o,r,a,c,h,u,d,p,f=this.vertices,y=this.computeExtremes(),m=y.min,g=y.max,w=0,v=0;for(h=0;h<3;h++)(p=g[h].point.getComponent(h)-m[h].point.getComponent(h))>w&&(w=p,v=h);for(o=m[v],r=g[v],w=0,t.set(o.point,r.point),h=0,u=this.vertices.length;h<u;h++)(i=f[h])!==o&&i!==r&&(t.closestPointToPoint(i.point,!0,n),(p=n.distanceToSquared(i.point))>w&&(w=p,a=i));for(w=-1,e.setFromCoplanarPoints(o.point,r.point,a.point),h=0,u=this.vertices.length;h<u;h++)(i=f[h])!==o&&i!==r&&i!==a&&(p=Math.abs(e.distanceToPoint(i.point)))>w&&(w=p,c=i);var b=[];if(e.distanceToPoint(c.point)<0)for(b.push(l.create(o,r,a),l.create(c,r,o),l.create(c,a,r),l.create(c,o,a)),h=0;h<3;h++)d=(h+1)%3,b[h+1].getEdge(2).setTwin(b[0].getEdge(d)),b[h+1].getEdge(1).setTwin(b[d+1].getEdge(0));else for(b.push(l.create(o,a,r),l.create(c,o,r),l.create(c,r,a),l.create(c,a,o)),h=0;h<3;h++)d=(h+1)%3,b[h+1].getEdge(2).setTwin(b[0].getEdge((3-h)%3)),b[h+1].getEdge(0).setTwin(b[d+1].getEdge(1));for(h=0;h<4;h++)this.faces.push(b[h]);for(h=0,u=f.length;h<u;h++)if((i=f[h])!==o&&i!==r&&i!==a&&i!==c){w=this.tolerance;var x=null;for(d=0;d<4;d++)(p=this.faces[d].distanceToPoint(i.point))>w&&(w=p,x=this.faces[d]);null!==x&&this.addVertexToFace(i,x)}return this},reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var n=this.faces[e];n.mark===o&&t.push(n)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,n=this.assigned.first().face,i=n.outside;do{var s=n.distanceToPoint(i.point);s>e&&(e=s,t=i),i=i.next}while(null!==i&&i.face===n);return t}},computeHorizon:function(t,e,n,i){var s;this.deleteFaceVertices(n),n.mark=1,s=null===e?e=n.getEdge(0):e.next;do{var r=s.twin,a=r.face;a.mark===o&&(a.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,r,a,i):i.push(s)),s=s.next}while(s!==e);return this},addAdjoiningFace:function(t,e){var n=l.create(t,e.tail(),e.head());return this.faces.push(n),n.getEdge(-1).setTwin(e.twin),n.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var n=null,i=null,s=0;s<e.length;s++){var o=e[s],r=this.addAdjoiningFace(t,o);null===n?n=r:r.next.setTwin(i),this.newFaces.push(r.face),i=r}return n.next.setTwin(i),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(l,{create:function(t,e,n){var i=new l,s=new c(t,i),o=new c(e,i),r=new c(n,i);return s.next=r.prev=o,o.next=s.prev=r,r.next=o.prev=s,i.edge=s,i.compute()}}),Object.assign(l.prototype,{toArray:function(){const t=[];let e=this.edge;do{t.push(e.head().index),e=e.next}while(e!==this.edge);return t},getEdge:function(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){void 0===i&&(i=new s.CJI);var t=this.edge.tail(),e=this.edge.head(),n=this.edge.next.head();return i.set(t.point,e.point,n.point),i.getNormal(this.normal),i.getMidpoint(this.midpoint),this.area=i.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(c.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return this.twin=t,t.twin=this,this}}),Object.assign(u.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),a}();const r=new s.Pa4,a=new s.Pa4,l=new s._fP;function c(t){const e=function(t){const e=[];return t.traverse((function(t){t.isMesh&&e.push(t)})),e}(t);if(0===e.length)return null;if(1===e.length)return h(e[0]);let n;const i=[];for(;n=e.pop();)i.push(p(h(n)));return function(t){let e=0;for(let n=0;n<t.length;n++){const i=t[n].attributes.position;i&&3===i.itemSize&&(e+=i.count)}const n=new Float32Array(3*e);let i=0;for(let e=0;e<t.length;e++){const s=t[e].attributes.position;if(s&&3===s.itemSize)for(let t=0;t<s.count;t++)n[i++]=s.getX(t),n[i++]=s.getY(t),n[i++]=s.getZ(t)}return(new s.u9r).setAttribute("position",new s.TlE(n,3))}(i)}function h(t){let e=t.geometry;return e=e.toBufferGeometry?e.toBufferGeometry():e.clone(),t.updateMatrixWorld(),t.matrixWorld.decompose(r,l,a),e.scale(a.x,a.y,a.z),e}function u(t){const e=t.attributes.position,n=new Float32Array(3*e.count);for(let t=0;t<e.count;t++)n[3*t]=e.getX(t),n[3*t+1]=e.getY(t),n[3*t+2]=e.getZ(t);return n}function d(t,e){switch(e){case"x":return t.x;case"y":return t.y;case"z":return t.z}throw new Error(`Unexpected component ${e}`)}function p(t,e=1e-4){e=Math.max(e,Number.EPSILON);const n={},i=t.getIndex(),o=t.getAttribute("position"),r=i?i.count:o.count;let a=0;const l=[],c=[],h=Math.log10(1/e),u=Math.pow(10,h);for(let t=0;t<r;t++){const e=i?i.getX(t):t;let s="";s+=~~(o.getX(e)*u)+",",s+=~~(o.getY(e)*u)+",",s+=~~(o.getZ(e)*u)+",",s in n?l.push(n[s]):(c.push(o.getX(e)),c.push(o.getY(e)),c.push(o.getZ(e)),n[s]=a,l.push(a),a++)}const d=new s.TlE(new Float32Array(c),o.itemSize,o.normalized),p=new s.u9r;return p.setAttribute("position",d),p.setIndex(l),p}const f=Math.PI/2;var y;!function(t){t.BOX="Box",t.CYLINDER="Cylinder",t.SPHERE="Sphere",t.HULL="ConvexPolyhedron",t.MESH="Trimesh"}(y||(y={}));const m=function(t,e={}){const n=function(t,e={}){let n;if(e.type===y.BOX)return w(t);if(e.type===y.CYLINDER)return function(t,e){const n=["x","y","z"],o=e.cylinderAxis||"y",r=n.splice(n.indexOf(o),1)&&n,a=(new s.ZzF).setFromObject(t);if(!isFinite(a.min.lengthSq()))return null;const l=a.max[o]-a.min[o],c=.5*Math.max(d(a.max,r[0])-d(a.min,r[0]),d(a.max,r[1])-d(a.min,r[1])),h="y"===o?f:0,u="z"===o?f:0;return{type:y.CYLINDER,params:{radiusTop:c,radiusBottom:c,height:l,segments:12},orientation:(new i._f).setFromEuler(h,u,0,"XYZ").normalize()}}(t,e);if(e.type===y.SPHERE)return function(t,e){if(e.sphereRadius)return{type:y.SPHERE,params:{radius:e.sphereRadius}};const n=c(t);return n?(n.computeBoundingSphere(),{type:y.SPHERE,params:{radius:n.boundingSphere.radius}}):null}(t,e);if(e.type===y.HULL)return function(t){const e=c(t);if(!e)return null;const n=1e-4;for(let t=0;t<e.attributes.position.count;t++)e.attributes.position.setXYZ(t,e.attributes.position.getX(t)+(Math.random()-.5)*n,e.attributes.position.getY(t)+(Math.random()-.5)*n,e.attributes.position.getZ(t)+(Math.random()-.5)*n);const[i,r]=(new o).setFromObject(new s.Kj0(e)).toJSON();return{type:y.HULL,params:{vertices:new Float32Array(i),faces:r}}}(t);if(e.type===y.MESH)return n=c(t),n?function(t){const e=u(t);if(!e.length)return null;const n=new Uint32Array(e.length);for(let t=0;t<e.length;t++)n[t]=t;return{type:y.MESH,params:{vertices:e,indices:n}}}(n):null;if(e.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${e.type}".`);if(n=c(t),!n)return null;switch(n.type){case"BoxGeometry":case"BoxBufferGeometry":return g(n);case"CylinderGeometry":case"CylinderBufferGeometry":return function(t){const e=t.parameters;return{type:y.CYLINDER,params:{radiusTop:e.radiusTop,radiusBottom:e.radiusBottom,height:e.height,segments:e.radialSegments},orientation:(new i._f).setFromEuler(s.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(n);case"PlaneGeometry":case"PlaneBufferGeometry":return function(t){t.computeBoundingBox();const e=t.boundingBox;return{type:y.BOX,params:{x:(e.max.x-e.min.x)/2||.1,y:(e.max.y-e.min.y)/2||.1,z:(e.max.z-e.min.z)/2||.1}}}(n);case"SphereGeometry":case"SphereBufferGeometry":return function(t){return{type:y.SPHERE,params:{radius:t.parameters.radius}}}(n);case"TubeGeometry":case"BufferGeometry":return w(t);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',n.type),g(n)}}(t,e);if(!n)return null;const{type:r,params:a,offset:l,orientation:h}=n;let p;return p=r===y.BOX?function(t){const{x:e,y:n,z:s}=t;return new i.xu(new i.AO(e,n,s))}(a):r===y.CYLINDER?function(t){const{radiusTop:e,radiusBottom:n,height:s,segments:o}=t,r=new i.Ab(e,n,s,o);return r.radiusTop=n,r.radiusBottom=n,r.height=s,r.numSegments=o,r}(a):r===y.SPHERE?function(t){return new i.aL(t.radius)}(a):r===y.HULL?function(t){const{faces:e,vertices:n}=t,s=[];for(let t=0;t<n.length;t+=3)s.push(new i.AO(n[t],n[t+1],n[t+2]));return new i.YD({faces:e,vertices:s})}(a):function(t){const{vertices:e,indices:n}=t;return new i.np(e,n)}(a),{shape:p,offset:l,orientation:h}};function g(t){if(!u(t).length)return null;t.computeBoundingBox();const e=t.boundingBox;return{type:y.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function w(t){const e=t.clone();e.quaternion.set(0,0,0,1),e.updateMatrixWorld();const n=(new s.ZzF).setFromObject(e);if(!isFinite(n.min.lengthSq()))return null;const o=n.translate(e.position.negate()).getCenter(new s.Pa4);return{type:y.BOX,params:{x:(n.max.x-n.min.x)/2,y:(n.max.y-n.min.y)/2,z:(n.max.z-n.min.z)/2},offset:o.lengthSq()?new i.AO(o.x,o.y,o.z):void 0}}}}]);
//# sourceMappingURL=449.9ce85f60.js.map